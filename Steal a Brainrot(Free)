--[[
    Slender Hub - Unified Script (Free + Premium Features)
    Developed by Gemini for Slender
    Version 1.0: Integrated with unified key system, dynamic access levels.
]]

--//==============================[ SERVICES & DEPENDENCIES ]==============================//--
-- Loads the Rayfield library (reloading here ensures it's available in this script's environment)
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService") -- Added for more robust loop management

--//==============================[ ACCESS LEVEL INJECTION ]==============================//--
-- The key system sets _G.SlenderHubAccessLevel before loading this script.
local accessLevel = _G.SlenderHubAccessLevel or "Free" -- Default to Free if not set (fallback)
_G.SlenderHubAccessLevel = nil -- Clear global variable after use to avoid pollution

print("Slender Hub Unified Script loaded with access level: " .. accessLevel)

--//==============================[ REMOTE EVENT REFERENCES ]==============================//--
-- We use :WaitForChild() to ensure objects are loaded
local FishingMinigameClick = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RE/FishingRod.MinigameClick")
local FishingRodCast = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RE/FishingRod.Cast")
local PlotServiceSell = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RE/PlotService/Sell")

--//==============================[ CONTROL VARIABLES ]==============================//--

-- Control variables for the full auto-fishing cycle
local isFullAutoFishingEnabled = false
local currentDelayAfterCast = 6.0    -- Wait time after casting for the click minigame to appear
local currentClickDuration = 8.0     -- Total duration of clicks in the fishing minigame
local currentClickSpeedDelay = 0.1   -- Delay between EACH individual click during the minigame (click speed)

-- Control variables for Anti-AFK and Anti-Kick
local isAntiAFKEnabled = false
local isAntiKickEnabled = false

-- Control variables for Auto Sell
local isAutoSellEnabled = false
local selectedPlotId = 1             -- Default to Slot 1 for selling
local autoSellDelay = 3.0            -- 3 seconds delay as requested

--//==============================[ CORE FUNCTIONALITY LOOPS ]==============================//--

-- Main function for the automatic fishing cycle
local function performFullAutoFishingCycle()
    while isFullAutoFishingEnabled and RunService.Running do -- Added RunService.Running check for robustness
        -- 1. Cast the fishing rod
        if FishingRodCast then
            FishingRodCast:FireServer(0)
            Rayfield:Notify({
                Title = "üé£ Auto Fishing Active",
                Content = "Fishing rod cast! Waiting for minigame...",
                Duration = 2,
                Image = "fishing-rod",
            })
        else
            warn("Error: RE/FishingRod.Cast not found. Stopping Full Auto Fishing.")
            isFullAutoFishingEnabled = false
            break
        end

        task.wait(currentDelayAfterCast)

        if not isFullAutoFishingEnabled then break end 

        Rayfield:Notify({
            Title = "‚ö°Ô∏è Auto Fishing Active",
            Content = "Fishing minigame detected! Starting clicks.",
            Duration = 2,
            Image = "mouse-pointer",
        })

        -- 3. Start clicking in the minigame for the configured duration
        local clickStartTime = os.time()
        while isFullAutoFishingEnabled and RunService.Running and (os.time() - clickStartTime < currentClickDuration) do
            if FishingMinigameClick then
                FishingMinigameClick:FireServer()
            else
                warn("Error: RE/FishingRod.MinigameClick not found. Stopping Full Auto Fishing.")
                isFullAutoFishingEnabled = false
                break
            end
            task.wait(currentClickSpeedDelay)
        end

        if not isFullAutoFishingEnabled then break end
        Rayfield:Notify({
            Title = "‚úÖ Auto Fishing Active",
            Content = "Clicks completed. Waiting for next cast.",
            Duration = 2,
            Image = "check-circle",
        })
        task.wait(1.5)
    end

    if not RunService.Running then return end -- Avoid notification if game stopped
    Rayfield:Notify({
        Title = "‚ùå Auto Fishing Disabled",
        Content = "The automatic fishing cycle has been stopped.",
        Duration = 3,
        Image = "x-circle",
    })
end

-- Function for Anti-AFK (periodic jumping)
local function antiAFKLoop()
    while isAntiAFKEnabled and RunService.Running do
        local Character = LocalPlayer.Character
        local Humanoid = Character and Character:FindFirstChildOfClass("Humanoid")
        
        if Humanoid and (Humanoid.Health > 0) and (Humanoid.Sit == false) then
            Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            task.wait(0.1)
            Humanoid:ChangeState(Enum.HumanoidStateType.Running)
        end
        task.wait(15)
    end
end

-- Function for Anti-Kick (subtle camera movement)
local function antiKickLoop()
    while isAntiKickEnabled and RunService.Running do
        local Camera = Workspace.CurrentCamera
        if Camera then
            Camera.CFrame = Camera.CFrame * CFrame.Angles(0, math.rad(0.0001), 0) 
        end
        task.wait(5)
    end
end

-- Function for Auto Sell Brainhots
local function performAutoSellCycle()
    while isAutoSellEnabled and RunService.Running do
        if PlotServiceSell then
            PlotServiceSell:FireServer(selectedPlotId)
            Rayfield:Notify({
                Title = "üí∞ Auto Sell Active",
                Content = "Attempting to sell brainhots from slot " .. selectedPlotId .. "...",
                Duration = 1.5,
                Image = "dollar-sign",
            })
        else
            warn("Error: RE/PlotService/Sell not found. Stopping Auto Sell.")
            isAutoSellEnabled = false
            break
        end
        task.wait(autoSellDelay)
    end
    if not RunService.Running then return end
    Rayfield:Notify({
        Title = "üö´ Auto Sell Deactivated",
        Content = "Automatic selling has been stopped.",
        Duration = 3,
        Image = "x-circle",
    })
end

--//==============================[ RAYFIELD UI ]==============================//--

-- Create the main Rayfield window (name dynamically changes based on access level)
local Window = Rayfield:CreateWindow({
   Name = "Slender Hub [" .. accessLevel .. " Access]", -- Dynamic window name
   Icon = "activity",
   LoadingTitle = "Fisherman Deluxe",
   LoadingSubtitle = "by SlenderHub",
   Theme = "Default",
   ToggleUIKeybind = "K",
   DisableRayfieldPrompts = false,
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "BrainrotFishingPro",
      FileName = "Config"
   },
   Discord = {Enabled = false},
   KeySystem = false
})

-- Initial notification based on access level
Rayfield:Notify({
    Title = "Slender Hub Loaded!",
    Content = "Welcome! You have " .. accessLevel .. " access.",
    Duration = 5,
    Image = accessLevel == "Premium" and "star" or "key",
})

-- Create a tab for advanced fishing functions
local Tab = Window:CreateTab("Advanced Fishing", "anchor")

-- Section for full fishing cycle controls
local FullCycleSection = Tab:CreateSection("Full Fishing Cycle Controls")

-- Toggle to enable/disable the full fishing cycle
Tab:CreateToggle({
   Name = "Enable Full Auto Fish Cycle",
   CurrentValue = false,
   Flag = "FullAutoFishToggle",
   Callback = function(Value)
       isFullAutoFishingEnabled = Value
       if isFullAutoFishingEnabled then
           task.spawn(performFullAutoFishingCycle)
           Rayfield:Notify({
               Title = "Auto Fish Activated",
               Content = "The full automatic fishing cycle has been started! Adjust times to optimize.",
               Duration = 4,
               Image = "bell",
           })
       else
           -- When disabled, the 'while isFullAutoFishingEnabled' loop will terminate
           Rayfield:Notify({
                Title = "‚ùå Auto Fish Deactivated",
                Content = "The automatic fishing cycle has been stopped.",
                Duration = 3,
                Image = "x-circle",
            })
       end
   end,
})

-- Slider to adjust delay after casting (time for minigame to appear)
Tab:CreateSlider({
   Name = "Wait for Minigame (seconds)",
   Range = {4.0, 10.0},
   Increment = 0.5,
   Suffix = "s",
   CurrentValue = currentDelayAfterCast,
   Flag = "DelayAfterCastSlider",
   Callback = function(Value)
       currentDelayAfterCast = Value
   end,
})

-- Slider to adjust click duration in the minigame
Tab:CreateSlider({
   Name = "Click Duration (seconds)",
   Range = {5.0, 20.0},
   Increment = 0.5,
   Suffix = "s",
   CurrentValue = currentClickDuration,
   Flag = "ClickDurationSlider",
   Callback = function(Value)
       currentClickDuration = Value
   end,
})

-- Slider to adjust speed between individual clicks in the minigame
Tab:CreateSlider({
   Name = "Delay Between Clicks (seconds)",
   Range = {0.05, 1.0},
   Increment = 0.05,
   Suffix = "s",
   CurrentValue = currentClickSpeedDelay,
   Flag = "ClickSpeedDelaySlider",
   Callback = function(Value)
       currentClickSpeedDelay = Value
   end,
})


-- Create a new tab for Miscellaneous features
local MiscTab = Window:CreateTab("MISC", "settings")

-- Section for Anti-AFK and Anti-Kick features
local AntiFeaturesSection = MiscTab:CreateSection("Anti-Features")

-- Toggle for Anti-AFK
MiscTab:CreateToggle({
    Name = "Enable Anti-AFK (Periodic Jump)",
    CurrentValue = false,
    Flag = "AntiAFKToggle",
    Callback = function(Value)
        isAntiAFKEnabled = Value
        if isAntiAFKEnabled then
            task.spawn(antiAFKLoop)
            Rayfield:Notify({
                Title = "‚öôÔ∏è Anti-AFK Activated",
                Content = "Your character will jump periodically to prevent AFK.",
                Duration = 3,
                Image = "hourglass",
            })
        else
            Rayfield:Notify({
                Title = "üö´ Anti-AFK Deactivated",
                Content = "Anti-AFK has been stopped.",
                Duration = 2,
                Image = "x-circle",
            })
        end
    end,
})

-- Toggle for Anti-Kick (Subtle Camera Movement)
MiscTab:CreateToggle({
    Name = "Enable Anti-Kick (Input Activity)",
    CurrentValue = false,
    Flag = "AntiKickToggle",
    Callback = function(Value)
        isAntiKickEnabled = Value
        if isAntiKickEnabled then
            task.spawn(antiKickLoop)
            Rayfield:Notify({
                Title = "üõ°Ô∏è Anti-Kick Activated",
                Content = "Simulating input activity to prevent kicks due to inactivity.",
                Duration = 3,
                Image = "shield",
            })
        else
            Rayfield:Notify({
                Title = "‚õî Anti-Kick Deactivated",
                Content = "Anti-Kick has been stopped.",
                Duration = 2,
                Image = "slash",
            })
        end
    end,
})

-- New section for Auto Selling
local AutoSellSection = MiscTab:CreateSection("Auto Selling")

-- Prepare options for the dropdown (Slot 1 to Slot 30)
local plotOptions = {}
for i = 1, 30 do
    table.insert(plotOptions, "Slot " .. i)
end

-- Dropdown for selecting the brainhot slot to sell from
MiscTab:CreateDropdown({
    Name = "Select Brainhot Slot",
    Options = plotOptions,
    CurrentOption = {"Slot 1"},
    MultipleOptions = false,
    Flag = "AutoSellSlotDropdown",
    Callback = function(Options)
        local selectedString = Options[1]
        selectedPlotId = tonumber(string.match(selectedString, "Slot (%d+)")) or 1
        Rayfield:Notify({
            Title = "Slot Selected",
            Content = "Auto sell target set to slot " .. selectedPlotId .. ".",
            Duration = 2,
            Image = "check-circle",
        })
    end,
})

-- Toggle for Auto Sell Brainhots
MiscTab:CreateToggle({
    Name = "Enable Auto Sell Brainhots",
    CurrentValue = false,
    Flag = "AutoSellToggle",
    Callback = function(Value)
        isAutoSellEnabled = Value
        if isAutoSellEnabled then
            task.spawn(performAutoSellCycle)
            Rayfield:Notify({
                Title = "üí∞ Auto Sell Activated",
                Content = "Auto selling from slot " .. selectedPlotId .. " started with a " .. autoSellDelay .. "s delay.",
                Duration = 3,
                Image = "dollar-sign",
            })
        else
            -- The 'while isAutoSellEnabled' loop will naturally terminate.
            -- Its final notification is handled inside the 'performAutoSellCycle' function.
        end
    end,
})

--//==============================[ PREMIUM FEATURES (CONDITIONAL) ]==============================//--
if accessLevel == "Premium" then
    print("Activating Premium features for Slender Hub...")
    local PremiumTab = Window:CreateTab("Premium", "star") -- New tab for Premium features

    local ExclusiveFeaturesSection = PremiumTab:CreateSection("Exclusive Premium Features")

    ExclusiveFeaturesSection:CreateButton({
        Name = "Teleport to Safezone (Premium)",
        Callback = function()
            -- Placeholder for a premium teleport function
            local Character = LocalPlayer.Character
            if Character and Character:FindFirstChild("HumanoidRootPart") then
                Character.HumanoidRootPart.CFrame = CFrame.new(0, 100, 0) -- Example: Teleport to origin high up
                Rayfield:Notify({Title = "‚ú® Premium Feature", Content = "Teleported to Safezone!", Duration = 3})
            else
                Rayfield:Notify({Title = "‚ö†Ô∏è Error", Content = "Cannot teleport: Character not found.", Duration = 3})
            end
        end
    })

    ExclusiveFeaturesSection:CreateSlider({
        Name = "Insane WalkSpeed (Premium)",
        Range = {100, 500},
        Increment = 10,
        Suffix = " studs/s",
        CurrentValue = 100,
        Flag = "InsaneWalkSpeed",
        Callback = function(value)
            if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
                LocalPlayer.Character.Humanoid.WalkSpeed = value
            end
        end,
    })

    -- Add more premium-exclusive elements here as needed
    PremiumTab:CreateParagraph({
        Title = "Thank you for supporting Premium!",
        Content = "Enjoy these exclusive features and more to come!"
    })

else
    -- Optional: If not premium, you might want to show an upgrade tab/section
    local UpgradeTab = Window:CreateTab("Upgrade", "arrow-up-circle")
    UpgradeTab:CreateParagraph({
        Title = "Unlock Premium Features!",
        Content = "Get access to exclusive tools and support. Visit our Discord to learn more about Premium!"
    })
    UpgradeTab:CreateButton({
        Name = "Go to Premium Discord",
        Callback = function()
            setclipboard("https://discord.gg/JeJTsFgc") -- Your Discord link
            Rayfield:Notify({Title = "Link Copied!", Content = "Join our Discord for Premium!", Duration = 6})
        end
    })
end

print("‚úÖ Slender Hub Unified Script Fully Initialized.")

--[[
    SlenderHub - Pickaxe Simulator [V60.0 TITANIUM]
    Architect: ScriptForge AI (v3.5)
    
    üíé PREMIUM FEATURES (Activated with Key):
    + HYPER MINE: Heartbeat loop + Attribute Hack (Instant Break).
    + FLASH HATCH: Bypasses UI animation delays.
    + GIFT VACUUM: Instant teleport upon spawn (Event-based).
    + OMNI-FARM: Reacts to plant growth instantly.
    
    üÜì FREE FEATURES:
    + Standard Auto Mine, Auto Farm, Bulk Craft.
]]

-- [ 0. AUTHENTICATION & SETUP ] --
local HubName = "SlenderHub_V60"
if getgenv()[HubName] then warn("‚õî Hub j√° rodando!") return end
getgenv()[HubName] = true

-- ::: CONFIGURA√á√ÉO DE ACESSO :::
-- Mude para "PREMIUM_KEY" para liberar as fun√ß√µes God Mode
getgenv().SlenderKey = "PREMIUM_KEY" 

local IsPremium = (getgenv().SlenderKey == "PREMIUM_KEY")

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local VirtualInputManager = game:GetService("VirtualInputManager")
local LocalPlayer = Players.LocalPlayer

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- [ 1. INTERNAL DATA MIRROR ] --
local GameData = {
    Paper = nil,
    Tables = {Eggs={}, Rebirths={}, Upgrades={}, Farm={}},
    Remotes = {Funct = nil, Event = nil},
    MineClient = nil
}

local function Initialize()
    local success, _ = pcall(function()
        GameData.Paper = require(ReplicatedStorage:WaitForChild("Paper", 10))
        local T = ReplicatedStorage:WaitForChild("Tables", 5)
        if T then
            local ET = require(T:WaitForChild("Eggs"))
            for n,_ in pairs(ET) do table.insert(GameData.Tables.Eggs, n) end
            table.sort(GameData.Tables.Eggs)
            
            local RT = require(T:WaitForChild("Rebirths"))
            for _,v in pairs(RT) do table.insert(GameData.Tables.Rebirths, tostring(v)) end
            table.sort(GameData.Tables.Rebirths, function(a,b) return tonumber(a)<tonumber(b) end)
            table.insert(GameData.Tables.Rebirths, "Max")

            local UT = require(T:WaitForChild("Upgrades"))
            for n,_ in pairs(UT) do table.insert(GameData.Tables.Upgrades, n) end
            table.sort(GameData.Tables.Upgrades)
        end
        local P = ReplicatedStorage:FindFirstChild("Paper")
        if P and P:FindFirstChild("Remotes") then
            GameData.Remotes.Funct = P.Remotes:FindFirstChild("__remotefunction")
            GameData.Remotes.Event = P.Remotes:FindFirstChild("__remoteevent")
        end
    end)
    -- Hook MineClient for Premium Mining
    for _, v in pairs(getgc(true)) do
        if type(v) == "table" and rawget(v, "MineCurrentOre") then
            GameData.MineClient = v
            break
        end
    end
end
Initialize()

local function NetworkCall(type, method, ...)
    local remote = (type == "Invoke") and GameData.Remotes.Funct or GameData.Remotes.Event
    if GameData.Paper and GameData.Paper.Network then
        local call = (type == "Invoke") and GameData.Paper.Network.InvokeServer or GameData.Paper.Network.FireServer
        return call(method, ...)
    elseif remote then
        if type == "Invoke" then return remote:InvokeServer(method, ...) else remote:FireServer(method, ...) end
    end
end

-- [ 2. TASK ENGINE ] --
local TaskManager = {}
local Connections = {} -- Para eventos Premium (ChildAdded, etc)

local function StartTask(name, func)
    if TaskManager[name] then task.cancel(TaskManager[name]) end
    TaskManager[name] = task.spawn(func)
end

local function StopTask(name)
    if TaskManager[name] then task.cancel(TaskManager[name]) TaskManager[name] = nil end
end

-- Limpa conex√µes premium ao desligar toggle
local function StopConnection(name)
    if Connections[name] then Connections[name]:Disconnect() Connections[name] = nil end
end

-- [ 3. LOGIC CONTROLLERS ] --
local Flags = {
    Egg = "Basic Egg",
    HatchMode = "1",
    Rebirth = "1",
    Upg = {},
    Speed = 1
}

-- 3.1 MINING ENGINE
local function EnableMining(bool)
    StopTask("FreeMine")
    StopConnection("PremiumMine")
    
    if bool then
        if IsPremium then
            -- PREMIUM: Heartbeat Loop (60x/sec) + Direct Call
            Connections["PremiumMine"] = RunService.Heartbeat:Connect(function()
                if GameData.MineClient then
                    GameData.MineClient.MineCurrentOre() -- Spam direto
                end
            end)
            -- Ativa Speed Hack Nativo
            LocalPlayer:SetAttribute("SPEED_HACK", 100) 
        else
            -- FREE: Loop lento + Clique Simulado
            LocalPlayer:SetAttribute("SPEED_HACK", Flags.Speed)
            StartTask("FreeMine", function()
                while true do
                    if GameData.MineClient then
                        GameData.MineClient.MineCurrentOre()
                    end
                    task.wait(0.2) -- Delay artificial
                end
            end)
        end
        -- Garante que o AutoMine do jogo t√° ativo
        if GameData.Paper and not GameData.Paper.Stats.Get("AutoMine").Value then
            NetworkCall("Fire", "Toggle Setting", "AutoMine")
        end
    else
        LocalPlayer:SetAttribute("SPEED_HACK", nil)
    end
end

-- 3.2 HATCHING ENGINE
local function EnableHatch(bool)
    StopTask("Hatch")
    if bool then
        local delay = IsPremium and 0 or 1.5 -- Premium = 0 delay, Free = 1.5s delay
        StartTask("Hatch", function()
            while true do
                local amt = (Flags.HatchMode == "Max") and "Max" or tonumber(Flags.HatchMode)
                NetworkCall("Invoke", "Hatch Egg", Flags.Egg, amt)
                if not IsPremium then task.wait(delay) else RunService.Heartbeat:Wait() end
            end
        end)
    end
end

-- 3.3 EVENT VACUUM (PREMIUM EXCLUSIVE LOGIC)
local function EnableGiftVacuum(bool)
    StopTask("GiftLoop")
    StopConnection("GiftEvent")
    
    local function Claim(model)
        if model:IsA("Model") and model.PrimaryPart then
            LocalPlayer.Character:PivotTo(model.PrimaryPart.CFrame + Vector3.new(0,3,0))
            task.wait(IsPremium and 0.05 or 0.5) -- Premium teleporta mais r√°pido
            NetworkCall("Invoke", "Claim Gift", model.Name)
        end
    end

    if bool then
        if IsPremium then
            -- PREMIUM: Event Listener (Reage instantaneamente ao spawn)
            local Objs = Workspace:WaitForChild("Objects")
            Connections["GiftEvent"] = Objs.ChildAdded:Connect(function(child)
                task.wait() -- Espera renderizar
                Claim(child)
            end)
            -- Pega os que j√° existem
            for _,v in pairs(Objs:GetChildren()) do Claim(v) end
        else
            -- FREE: Loop lento
            StartTask("GiftLoop", function()
                while true do
                    local Objs = Workspace:FindFirstChild("Objects")
                    if Objs then
                        for _,v in pairs(Objs:GetChildren()) do Claim(v) end
                    end
                    task.wait(2)
                end
            end)
        end
    end
end

-- 3.4 FARM & CRAFT
local function FarmLogic()
    -- L√≥gica compartilhada, mas Premium roda em loop mais r√°pido na UI
    pcall(function()
        for _, p in pairs(Workspace.Worlds["Stud World"].Farm.Plants:GetChildren()) do
            if p:FindFirstChild("Fruits") and #p.Fruits:GetChildren() > 0 then
                NetworkCall("Invoke", "Harvest Fruit", "Stud World", p.Name)
            end
        end
    end)
    -- Plant Logic (Simplificado para o exemplo)
    local seeds = {"Christmas Tree", "Candy Cane", "Watermelon", "Apple"}
    for _, s in pairs(seeds) do NetworkCall("Invoke", "Plant", s) end
    NetworkCall("Invoke", "Upgrade Farm")
end

local function BulkCraft(tier)
    if not GameData.Paper then return end
    local pets = GameData.Paper.Stats.Get("Pets").Value
    local toCraft = {}
    local groups = {}
    -- Agrupamento otimizado
    for uuid, p in pairs(pets) do
        if not p.Equipped and not p.Locked and p.Tier == tier then
            local n = p.Name or p.Id
            if not groups[n] then groups[n] = {} end
            table.insert(groups[n], uuid)
        end
    end
    for _, uuids in pairs(groups) do
        if #uuids >= 5 then
            for i=1, math.floor(#uuids/5)*5 do table.insert(toCraft, uuids[i]) end
        end
    end
    if #toCraft > 0 then
        local act = (tier == 1) and "CraftAllGolden" or "CraftAllRainbow"
        NetworkCall("Invoke", "Pet", {Action = act, Pets = toCraft})
    end
end

-- [ 4. UI INTERFACE ] --
local Window = Rayfield:CreateWindow({
   Name = IsPremium and "SlenderHub | TITANIUM üíé" or "SlenderHub | Free Version",
   LoadingTitle = IsPremium and "Authenticating Premium..." or "Loading Free Scripts...",
   ConfigurationSaving = { Enabled = true, FileName = "SlenderHubV60" },
   KeySystem = false,
})

-- ==== TAB: MINING ==== --
local TabMine = Window:CreateTab("Mining ‚õèÔ∏è", 4483345998)

if IsPremium then
    TabMine:CreateSection("TITANIUM FEATURES")
    TabMine:CreateLabel("‚ö° Hyper Mining Ativado (0 Delay)")
else
    TabMine:CreateSection("Free Settings")
    TabMine:CreateSlider({
        Name = "Speed Hack",
        Range = {1, 20},
        Increment = 1,
        Suffix = "x",
        CurrentValue = 1,
        Callback = function(v) Flags.Speed = v end
    })
end

TabMine:CreateToggle({
    Name = IsPremium and "HYPER MINE (God Mode)" or "Auto Mine (Legit)",
    CurrentValue = false,
    Callback = function(v) EnableMining(v) end
})

TabMine:CreateToggle({
    Name = "Auto Buy Miner",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Miner", function() while true do NetworkCall("Invoke", "Buy Miner") task.wait(IsPremium and 0.5 or 2) end end)
        else StopTask("Miner") end
    end
})

-- ==== TAB: EGGS ==== --
local TabEggs = Window:CreateTab("Eggs ü•ö", 4483362458)

TabEggs:CreateDropdown({
    Name = "Select Egg",
    Options = GameData.Tables.Eggs,
    CurrentOption = {"Basic Egg"},
    Callback = function(O) Flags.Egg = O[1] end
})

TabEggs:CreateDropdown({
    Name = "Hatch Amount",
    Options = {"1", "3", "Max"},
    CurrentOption = {"1"},
    Callback = function(O) Flags.HatchMode = O[1] end
})

TabEggs:CreateToggle({
    Name = IsPremium and "FLASH HATCH (Insane Speed)" or "Auto Hatch (Slow)",
    CurrentValue = false,
    Callback = function(v) EnableHatch(v) end
})

-- ==== TAB: FARM & PETS ==== --
local TabFarm = Window:CreateTab("Farm/Pets üêæ", 4483362458)

TabFarm:CreateToggle({
    Name = "Omni-Farm (Plant & Harvest)",
    CurrentValue = false,
    Callback = function(v)
        if v then 
            StartTask("Farm", function() 
                while true do 
                    FarmLogic() 
                    -- Premium checa 5x mais r√°pido
                    task.wait(IsPremium and 0.5 or 3) 
                end 
            end)
        else StopTask("Farm") end
    end
})

TabFarm:CreateToggle({
    Name = "Auto Craft All (Gold & Rainbow)",
    CurrentValue = false,
    Callback = function(v)
        if v then
            StartTask("Craft", function()
                while true do
                    BulkCraft(1)
                    if IsPremium then task.wait(0.1) else task.wait(1) end
                    BulkCraft(2)
                    task.wait(IsPremium and 1 or 5)
                end
            end)
        else StopTask("Craft") end
    end
})

-- ==== TAB: EVENT ==== --
local TabEvent = Window:CreateTab("Event üéÑ", 4483362458)

TabEvent:CreateToggle({
    Name = IsPremium and "GIFT VACUUM (Instant Teleport)" or "Auto Farm Gifts",
    CurrentValue = false,
    Callback = function(v) EnableGiftVacuum(v) end
})

-- ==== TAB: UPGRADES ==== --
local TabUpg = Window:CreateTab("Upgrades üìà", 4483362458)

TabUpg:CreateDropdown({
    Name = "Rebirth Amount",
    Options = GameData.Tables.Rebirths,
    CurrentOption = {"1"},
    Callback = function(O) Flags.Rebirth = O[1] end
})

TabUpg:CreateToggle({
    Name = "Auto Rebirth",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Rebirth", function() while true do NetworkCall("Invoke", "Rebirth", (Flags.Rebirth=="Max" and "Max" or tonumber(Flags.Rebirth))) task.wait(2) end end)
        else StopTask("Rebirth") end
    end
})

TabUpg:CreateToggle({
    Name = "Auto Train",
    CurrentValue = false,
    Callback = function(v) NetworkCall("Fire", "Toggle Setting", "AutoTrain") end
})

Rayfield:LoadConfiguration()

-- Notifica√ß√£o de Status
Rayfield:Notify({
    Title = IsPremium and "TITANIUM ACCESS GRANTED" or "FREE VERSION LOADED",
    Content = IsPremium and "Todas as fun√ß√µes God Mode liberadas." or "Compre Premium para velocidade m√°xima.",
    Duration = 6,
    Image = 4483345998,
})

--[[
    SlenderHub - Pickaxe Simulator [V60.0 TITANIUM HYBRID]
    Architect: ScriptForge AI (v3.5)
    
    COMO USAR:
    Antes de executar, defina no seu executor:
    getgenv().SlenderHubAccessLevel = "Free"    -- Para Modo Gr√°tis (Legit)
    getgenv().SlenderHubAccessLevel = "Premium" -- Para Modo Premium (God/Rage)
]]

-- [ 0. SAFETY SINGLETON ] --
if getgenv().SlenderHubLoaded then 
    warn("‚õî SlenderHub j√° est√° rodando!")
    return 
end
getgenv().SlenderHubLoaded = true

-- [ 1. SISTEMA DE ACESSO (RESTORED) ] --
local AccessLevel = getgenv().SlenderHubAccessLevel or "Free" 
local IsPremium = (AccessLevel == "Premium")

-- Configura√ß√£o de Performance baseada no N√≠vel
local PerformanceSettings = {
    MiningSpeed = IsPremium and 50 or 2, -- 50x (God) vs 2x (Legit)
    LoopDelay = IsPremium and 0 or 0.25, -- 0s (Instant) vs 0.25s (Human)
    EventMode = IsPremium and "Event" or "Loop" -- Event (Instant) vs Loop (Slow)
}

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- [ 2. INTERNAL DATA & MIRROR ] --
local GameData = {
    Paper = nil,
    MineClient = nil,
    Remotes = { Funct = nil, Event = nil },
    Tables = {
        Eggs = {},
        Rebirths = {"1", "Max"},
        Upgrades = {},
        EventUpgrades = {}
    }
}

-- Inicializa√ß√£o Segura
local function Initialize()
    local success, err = pcall(function()
        -- 1. Load Paper Framework
        GameData.Paper = require(ReplicatedStorage:WaitForChild("Paper", 10))
        
        -- 2. Find Remotes
        local R = ReplicatedStorage.Paper:FindFirstChild("Remotes")
        if R then
            GameData.Remotes.Funct = R:FindFirstChild("__remotefunction")
            GameData.Remotes.Event = R:FindFirstChild("__remoteevent")
        end

        -- 3. Load MineClient (Required for Premium Mining)
        task.spawn(function()
            for _, v in pairs(getgc(true)) do
                if type(v) == "table" and rawget(v, "MineCurrentOre") then
                    GameData.MineClient = v
                    break
                end
            end
        end)

        -- 4. Load Tables Dynamically (Decompile Data)
        local T = ReplicatedStorage:WaitForChild("Tables", 5)
        if T then
            -- Eggs
            local ET = require(T:WaitForChild("Eggs"))
            local eggs = {}
            for n,_ in pairs(ET) do table.insert(eggs, n) end
            table.sort(eggs)
            GameData.Tables.Eggs = eggs

            -- Rebirths
            local RT = require(T:WaitForChild("Rebirths"))
            local rebs = {}
            for _,v in pairs(RT) do table.insert(rebs, tostring(v)) end
            table.sort(rebs, function(a,b) return tonumber(a) < tonumber(b) end)
            table.insert(rebs, "Max")
            GameData.Tables.Rebirths = rebs

            -- Upgrades
            local UT = require(T:WaitForChild("Upgrades"))
            local upgs = {}
            for n,_ in pairs(UT) do table.insert(upgs, n) end
            table.sort(upgs)
            GameData.Tables.Upgrades = upgs
        end
    end)
    if not success then warn("Init Warn: " .. tostring(err)) end
end
Initialize()

-- [ 3. UTILS & NETWORK ] --
local TaskManager = {}
local Connections = {} 

local function StopTask(name)
    if TaskManager[name] then task.cancel(TaskManager[name]) TaskManager[name] = nil end
    if Connections[name] then Connections[name]:Disconnect() Connections[name] = nil end
end

local function StartTask(name, func)
    StopTask(name)
    TaskManager[name] = task.spawn(func)
end

local function NetworkCall(type, method, ...)
    local remote = (type == "Invoke") and GameData.Remotes.Funct or GameData.Remotes.Event
    if GameData.Paper and GameData.Paper.Network then
        local call = (type == "Invoke") and GameData.Paper.Network.InvokeServer or GameData.Paper.Network.FireServer
        return call(method, ...)
    elseif remote then
        if type == "Invoke" then return remote:InvokeServer(method, ...) else remote:FireServer(method, ...) end
    end
end

-- [ 4. HYBRID LOGIC ENGINE ] --

-- 4.1 MINING ENGINE (Free vs Premium)
local function EnableMining(bool)
    StopTask("Mining")
    if bool then
        -- Native Speed Hack: 50x (Premium) vs 2x (Free)
        if LocalPlayer then LocalPlayer:SetAttribute("SPEED_HACK", PerformanceSettings.MiningSpeed) end
        
        -- Force AutoMine Setting
        NetworkCall("Fire", "Toggle Setting", "AutoMine")

        if IsPremium then
            -- PREMIUM: Heartbeat Loop (60x per second)
            Connections["Mining"] = RunService.Heartbeat:Connect(function()
                if GameData.MineClient then GameData.MineClient.MineCurrentOre() end
            end)
        else
            -- FREE: Standard Loop (Simula humano r√°pido)
            StartTask("Mining", function()
                while true do
                    if GameData.MineClient then GameData.MineClient.MineCurrentOre() end
                    task.wait(PerformanceSettings.LoopDelay)
                end
            end)
        end
    else
        if LocalPlayer then LocalPlayer:SetAttribute("SPEED_HACK", nil) end
    end
end

-- 4.2 GIFT VACUUM (Free vs Premium)
local function EnableGiftVacuum(bool)
    StopTask("Gifts")
    if bool then
        local GiftFolder = Workspace:WaitForChild("Objects", 5)
        if not GiftFolder then return end

        local function Collect(model)
            if model:IsA("Model") and model.PrimaryPart then
                -- Teleport
                LocalPlayer.Character:PivotTo(model.PrimaryPart.CFrame + Vector3.new(0,3,0))
                -- Free users wait slightly to avoid detection/kicks
                if not IsPremium then task.wait(0.25) end
                NetworkCall("Invoke", "Claim Gift", model.Name)
            end
        end

        if IsPremium then
            -- PREMIUM: Event Listener (Instant√¢neo ao spawnar)
            Connections["Gifts"] = GiftFolder.ChildAdded:Connect(Collect)
            for _, g in pairs(GiftFolder:GetChildren()) do Collect(g) end
        else
            -- FREE: Loop Scanner (Verifica a cada 2 segundos)
            StartTask("Gifts", function()
                while true do
                    for _, g in pairs(GiftFolder:GetChildren()) do Collect(g) end
                    task.wait(2) 
                end
            end)
        end
    end
end

-- 4.3 SMART FARM (Shared Logic)
local function FarmLogic()
    -- Harvest
    local World = Workspace.Worlds:FindFirstChild("Stud World") or Workspace.Worlds:FindFirstChild("Farm")
    if World and World:FindFirstChild("Farm") then
        for _, plant in pairs(World.Farm.Plants:GetChildren()) do
            if plant:FindFirstChild("Fruits") and #plant.Fruits:GetChildren() > 0 then
                NetworkCall("Invoke", "Harvest Fruit", "Stud World", plant.Name)
            end
        end
    end
    -- Plant (Max Slots Check)
    if GameData.Paper then
        local count = #GameData.Paper.Stats.Get("Plants"):GetChildren()
        local max = 4 + GameData.Paper.Stats.Get("FarmLevel").Value
        if count < max then
            local seeds = {"Christmas Tree", "Candy Cane", "Watermelon", "Apple", "Corn", "Carrot", "Strawberry"}
            for _, s in pairs(seeds) do NetworkCall("Invoke", "Plant", s) end
        end
    end
    NetworkCall("Invoke", "Upgrade Farm")
end

-- 4.4 BULK CRAFT (Optimized)
local function BulkCraft(tier)
    if not GameData.Paper then return end
    local pets = GameData.Paper.Stats.Get("Pets").Value
    local groups = {}
    for uuid, p in pairs(pets) do
        if not p.Equipped and not p.Locked and p.Tier == tier then
            local n = p.Name or p.Id
            if not groups[n] then groups[n] = {} end
            table.insert(groups[n], uuid)
        end
    end
    for _, uuids in pairs(groups) do
        if #uuids >= 5 then
            local act = (tier == 1) and "CraftAllGolden" or "CraftAllRainbow"
            NetworkCall("Invoke", "Pet", {Action = act, Pets = uuids})
        end
    end
end

-- [ 5. UI & FLAGS ] --
local Flags = {
    Egg = "Basic Egg",
    HatchMode = "1",
    Rebirth = "1",
    SelectedUpg = {}
}

local Window = Rayfield:CreateWindow({
   Name = IsPremium and "SlenderHub | TITANIUM V60 üíé" or "SlenderHub | Free V60 ‚ö†Ô∏è",
   LoadingTitle = IsPremium and "Premium Access Granted" or "Free Access Loaded",
   ConfigurationSaving = { Enabled = true, FileName = "SlenderHubV60" },
   KeySystem = false,
})

-- ==== TAB: MINE ==== --
local TabMine = Window:CreateTab("Mine ‚õèÔ∏è", 4483345998)

TabMine:CreateSection(IsPremium and "GOD MODE ACTIVE" or "Legit Mode Active")

TabMine:CreateToggle({
    Name = IsPremium and "HYPER MINE (Instant)" or "Auto Mine (Legit)",
    CurrentValue = false,
    Callback = function(v) EnableMining(v) end
})

if IsPremium then
    TabMine:CreateLabel("‚ö° Speed Hack set to 50x (Premium)")
else
    TabMine:CreateLabel("üê¢ Speed Hack set to 2x (Free Limit)")
end

TabMine:CreateToggle({
    Name = "Auto Buy Miner",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Miner", function() while true do NetworkCall("Invoke", "Buy Miner") task.wait(2) end end)
        else StopTask("Miner") end
    end
})

-- ==== TAB: EGGS ==== --
local TabEggs = Window:CreateTab("Eggs ü•ö", 4483362458)

TabEggs:CreateDropdown({
    Name = "Select Egg",
    Options = GameData.Tables.Eggs,
    CurrentOption = {"Basic Egg"},
    Callback = function(O) Flags.Egg = O[1] end
})

TabEggs:CreateDropdown({
    Name = "Hatch Amount",
    Options = {"1", "3", "Max"},
    CurrentOption = {"1"},
    Callback = function(O) Flags.HatchMode = O[1] end
})

TabEggs:CreateToggle({
    Name = IsPremium and "FLASH HATCH (No Delay)" or "Auto Hatch (Anim Delay)",
    CurrentValue = false,
    Callback = function(v)
        if v then
            StartTask("Hatch", function()
                while true do
                    local amt = (Flags.HatchMode=="Max" and "Max" or tonumber(Flags.HatchMode))
                    NetworkCall("Invoke", "Hatch Egg", Flags.Egg, amt)
                    -- Premium ignora anima√ß√£o
                    task.wait(IsPremium and 0.05 or 0.6)
                end
            end)
        else StopTask("Hatch") end
    end
})

-- ==== TAB: FARM/PETS ==== --
local TabFP = Window:CreateTab("Farm/Pets üêæ", 4483362458)

TabFP:CreateToggle({
    Name = "Auto Plant & Harvest",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Farm", function() while true do FarmLogic() task.wait(IsPremium and 1 or 3) end end)
        else StopTask("Farm") end
    end
})

TabFP:CreateToggle({
    Name = "Auto Craft All (Gold/Rainbow)",
    CurrentValue = false,
    Callback = function(v)
        if v then
            StartTask("Craft", function()
                while true do
                    BulkCraft(1) 
                    task.wait(0.2)
                    BulkCraft(2) 
                    task.wait(2)
                end
            end)
        else StopTask("Craft") end
    end
})

-- ==== TAB: UPGRADES ==== --
local TabUpg = Window:CreateTab("Upgrades üìà", 4483362458)

TabUpg:CreateDropdown({
    Name = "Rebirth Amount",
    Options = GameData.Tables.Rebirths,
    CurrentOption = {"1"},
    Callback = function(O) Flags.Rebirth = O[1] end
})

TabUpg:CreateToggle({
    Name = "Auto Rebirth",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Reb", function() while true do NetworkCall("Invoke", "Rebirth", (Flags.Rebirth=="Max" and "Max" or tonumber(Flags.Rebirth))) task.wait(1) end end)
        else StopTask("Reb") end
    end
})

TabUpg:CreateDropdown({
    Name = "Normal Upgrades",
    Options = GameData.Tables.Upgrades,
    CurrentOption = {"More Gems"},
    MultipleOptions = true,
    Callback = function(O) Flags.SelectedUpg = O end
})

TabUpg:CreateToggle({
    Name = "Auto Buy Upgrades",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("BuyUpg", function() while true do for _,u in pairs(Flags.SelectedUpg) do NetworkCall("Invoke", "Upgrade", u) end task.wait(2) end end)
        else StopTask("BuyUpg") end
    end
})

-- ==== TAB: EVENT ==== --
local TabEvent = Window:CreateTab("Event üéÑ", 4483362458)

TabEvent:CreateToggle({
    Name = IsPremium and "GIFT VACUUM (Instant)" or "Auto Farm Gifts (Slow)",
    CurrentValue = false,
    Callback = function(v) EnableGiftVacuum(v) end
})

if not IsPremium then
    TabEvent:CreateLabel("‚ö†Ô∏è Vacuum Mode is Premium Only (Using Slow Loop)")
end

TabEvent:CreateToggle({
    Name = "Auto Buy Merchant (Potions)",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Merch", function() while true do for _, item in pairs({"Luck Potion", "Speed Potion", "Snowflake Potion"}) do NetworkCall("Invoke", "Buy Event Merchant", item) end task.wait(3) end end)
        else StopTask("Merch") end
    end
})

Rayfield:LoadConfiguration()
Rayfield:Notify({
    Title = IsPremium and "TITANIUM ACCESS" or "FREE ACCESS",
    Content = IsPremium and "Todas as fun√ß√µes God Mode liberadas." or "Fun√ß√µes limitadas. Adquira Premium para mais.",
    Duration = 5,
    Image = 4483345998,
})

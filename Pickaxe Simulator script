--[[
    SlenderHub - Pickaxe Simulator [V44.0 HYBRID]
    Developed by: ScriptForge AI
    
    UPDATES:
    - FREE MODE: Restored Original Clicker Logic (VirtualInputManager).
    - PREMIUM MODE: Kept God Mode (MineClient Direct Call).
    - ALL FEATURES: Smart Craft, Auto Hatch, Event, Rebirth included.
]]

-- [ 0. SAFETY SINGLETON ] --
if getgenv().SlenderHubLoaded then 
    warn("SlenderHub j치 est치 rodando!")
    return 
end
getgenv().SlenderHubLoaded = true

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- [ 1. SISTEMA DE ACESSO ] --
local AccessLevel = getgenv().SlenderHubAccessLevel or "Free" 
local isPremium = (AccessLevel == "Premium")

-- Configura칞칚o de Velocidade Premium
local GodSpeedDelay = 0.03 -- 30ms

-- [ 2. CARREGAMENTO DE M칍DULOS (PREMIUM ONLY) ] --
local Paper, PaperSuccess = nil, false
local MineClientModule = nil 
local EggsTbl, PickaxesTbl, EventUpgradesTbl = nil, nil, nil

-- 2.1 Carregar Paper Framework
pcall(function()
    Paper = require(ReplicatedStorage:WaitForChild("Paper", 5))
    if Paper then PaperSuccess = true end
    
    local Tables = ReplicatedStorage:WaitForChild("Tables")
    EggsTbl = require(Tables:WaitForChild("Eggs"))
    PickaxesTbl = require(Tables:WaitForChild("Pickaxes"))
    EventUpgradesTbl = require(Tables:WaitForChild("EventUpgrades"))
end)

-- 2.2 Encontrar MineClient (Apenas para o God Mode)
for _, v in pairs(getgc(true)) do
    if type(v) == "table" then
        if rawget(v, "MineCurrentOre") and rawget(v, "RequestCurrentChunk") then
            MineClientModule = v
            break
        end
    end
end

-- [ 3. REDE (NETWORKING) ] --
local Remotes = ReplicatedStorage:FindFirstChild("Paper") and ReplicatedStorage.Paper:FindFirstChild("Remotes")
local RF = Remotes and Remotes:FindFirstChild("__remotefunction")
local RE = Remotes and Remotes:FindFirstChild("__remoteevent")

local function NetworkInvoke(method, ...)
    if PaperSuccess and Paper.Network then return Paper.Network.InvokeServer(method, ...)
    elseif RF then return RF:InvokeServer(method, ...) end
end

local function NetworkFire(method, ...)
    if PaperSuccess and Paper.Network and Paper.Network.FireServer then Paper.Network.FireServer(method, ...)
    elseif RE then RE:FireServer(method, ...) end
end

-- [ 4. SMART CRAFTING ] --
local function AttemptSmartCraft(actionType, requiredCount)
    if not PaperSuccess then return end
    local myPetsData = Paper.Stats.Get("Pets").Value
    local grouped = {}
    
    for uuid, pet in pairs(myPetsData) do
        if not pet.Equipped and not pet.Locked then
            local pName = pet.Name or pet.Id
            local isGolden = (pet.Tier == 2)
            local isRainbow = (pet.Tier == 3)
            if actionType == "CraftGolden" and not isGolden and not isRainbow then
                if not grouped[pName] then grouped[pName] = {} end
                table.insert(grouped[pName], uuid)
            elseif actionType == "CraftRainbow" and isGolden then
                if not grouped[pName] then grouped[pName] = {} end
                table.insert(grouped[pName], uuid)
            end
        end
    end
    
    for name, uuids in pairs(grouped) do
        if #uuids >= requiredCount then
            local petsToConsume = {}
            for i = 1, requiredCount do table.insert(petsToConsume, uuids[i]) end
            NetworkInvoke("Pet", {Action = actionType, Pets = petsToConsume})
            task.wait(0.2)
        end
    end
end

-- [ 5. DADOS E LISTAS ] --
local AllUpgrades = {
    "More Gems", "More Rebirths", "More Coins", "More Damage", 
    "Egg Luck", "Hatch Speed", "Pets Equipped", "Inventory Space", 
    "Golden Chance", "Rainbow Chance", "Walk Speed"
}
local MerchantItems = {"Luck Potion", "Speed Potion", "Damage Potion", "Coin Potion"}
local EggList = {}
if EggsTbl then
    for name, data in pairs(EggsTbl) do 
        if not data.Exclusive then table.insert(EggList, name) end 
    end
    table.sort(EggList)
end

-- [ 6. FLAGS ] --
getgenv().Flags = {
    AutoMineLegit = false,
    AutoMineGod = false,
    AutoTrain = false,
    AutoRebirth = false,
    RebirthMode = "1",
    AutoUpgrade = false,
    SelectedUpgrades = {},
    AutoMerchant = false,
    MerchantTargets = {"Luck Potion"},
    AutoHatch = false,
    HatchMode = 1,
    TargetEgg = nil,
    AutoGolden = false,
    AutoRainbow = false
}

-- [ 7. INTERFACE ] --
local Window = Rayfield:CreateWindow({
   Name = "SlenderHub | V44.0 Hybrid 丘덢잺",
   LoadingTitle = isPremium and "Premium Access 游눑" or "Free Access",
   ConfigurationSaving = { Enabled = true, FileName = "SlenderHubV44" },
   KeySystem = false,
})

-- ==== TAB: FARM ==== --
local TabFarm = Window:CreateTab("Farm 久勇", 4483345998)

TabFarm:CreateSection("Mining Modes")

-- [ OP칂츾O 1: CLASSIC LEGIT CLICKER (Original Script Logic) ] --
TabFarm:CreateToggle({
    Name = "Auto Mine (Legit Clicker)",
    CurrentValue = false,
    Flag = "AutoMineLegit",
    Callback = function(Value)
        getgenv().Flags.AutoMineLegit = Value
        
        -- Desativa Premium se ativar este
        if Value and getgenv().Flags.AutoMineGod then getgenv().Flags.AutoMineGod = false end

        if Value then
            task.spawn(function()
                while getgenv().Flags.AutoMineLegit do
                    -- L칩gica Original: VirtualInputManager no centro da tela
                    if Workspace.CurrentCamera then
                        local vp = Workspace.CurrentCamera.ViewportSize
                        local x, y = vp.X / 2, vp.Y / 2
                        
                        VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 1)
                        task.wait(0.05) -- Segura o clique um pouco (Simula칞칚o Humana)
                        VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 1)
                    end
                    
                    -- Delay Original (0.2s a 0.25s)
                    task.wait(0.2) 
                end
            end)
        end
    end
})

-- [ OP칂츾O 2: GOD MODE (Direct Function Call) ] --
TabFarm:CreateToggle({
    Name = "Auto Mine (God Mode) [Premium]",
    CurrentValue = false,
    Flag = "AutoMineGod",
    Callback = function(Value)
        if Value and not isPremium then
            Rayfield:Notify({Title = "Acesso Negado", Content = "Fun칞칚o exclusiva Premium!", Duration = 3})
            getgenv().Flags.AutoMineGod = false
            return
        end

        getgenv().Flags.AutoMineGod = Value
        if Value and getgenv().Flags.AutoMineLegit then getgenv().Flags.AutoMineLegit = false end

        if Value then
            if not MineClientModule then
                Rayfield:Notify({Title = "Erro", Content = "M칩dulo de minera칞칚o n칚o encontrado.", Duration = 4})
                return
            end

            task.spawn(function()
                while getgenv().Flags.AutoMineGod do
                    -- Chama a fun칞칚o interna 3x por loop (Velocidade Extrema)
                    for i = 1, 3 do 
                        MineClientModule.MineCurrentOre() 
                    end
                    task.wait(GodSpeedDelay)
                end
            end)
        end
    end
})

TabFarm:CreateSection("Training")

TabFarm:CreateToggle({
    Name = "Auto Train (Server-Side)",
    CurrentValue = false,
    Flag = "AutoTrain",
    Callback = function(Value)
        getgenv().Flags.AutoTrain = Value
        if Value then
            NetworkFire("Toggle Setting", "AutoTrain")
            task.spawn(function()
                while getgenv().Flags.AutoTrain do
                    NetworkInvoke("Train")
                    task.wait(2)
                end
            end)
        end
    end
})

-- ==== TAB: EGGS & PETS ==== --
local TabPets = Window:CreateTab("Pets 游", 4483362458)

TabPets:CreateSection("Hatching")

TabPets:CreateDropdown({
    Name = "Select Egg",
    Options = EggList,
    CurrentOption = {EggList[1] or "Basic Egg"},
    Flag = "TargetEgg",
    Callback = function(Option) getgenv().Flags.TargetEgg = Option[1] end
})

TabPets:CreateDropdown({
    Name = "Hatch Amount",
    Options = {"1", "3", "Max"},
    CurrentOption = {"1"},
    Flag = "HatchMode",
    Callback = function(Option) 
        local val = Option[1]
        getgenv().Flags.HatchMode = (val == "Max") and "Max" or tonumber(val)
    end
})

TabPets:CreateToggle({
    Name = "Auto Hatch",
    CurrentValue = false,
    Flag = "AutoHatch",
    Callback = function(Value)
        getgenv().Flags.AutoHatch = Value
        task.spawn(function()
            while getgenv().Flags.AutoHatch do
                if getgenv().Flags.TargetEgg then
                    NetworkInvoke("Hatch Egg", getgenv().Flags.TargetEgg, getgenv().Flags.HatchMode)
                end
                task.wait(0.2)
            end
        end)
    end
})

TabPets:CreateSection("Crafting")

TabPets:CreateToggle({
    Name = "Auto Craft Golden",
    CurrentValue = false,
    Flag = "AutoGolden",
    Callback = function(Value)
        getgenv().Flags.AutoGolden = Value
        task.spawn(function()
            while getgenv().Flags.AutoGolden do
                AttemptSmartCraft("CraftGolden", 5)
                task.wait(1.5)
            end
        end)
    end
})

TabPets:CreateToggle({
    Name = "Auto Craft Rainbow",
    CurrentValue = false,
    Flag = "AutoRainbow",
    Callback = function(Value)
        getgenv().Flags.AutoRainbow = Value
        task.spawn(function()
            while getgenv().Flags.AutoRainbow do
                AttemptSmartCraft("CraftRainbow", 5)
                task.wait(1.5)
            end
        end)
    end
})

-- ==== TAB: UPGRADES ==== --
local TabStats = Window:CreateTab("Stats 拘勇", 4483362458)

TabStats:CreateSection("Rebirth")

TabStats:CreateDropdown({
    Name = "Rebirth Mode",
    Options = {"1", "5", "20", "50", "100", "Max"},
    CurrentOption = {"1"},
    Flag = "RebirthMode",
    Callback = function(Option) getgenv().Flags.RebirthMode = Option[1] end
})

TabStats:CreateToggle({
    Name = "Auto Rebirth",
    CurrentValue = false,
    Flag = "AutoRebirth",
    Callback = function(Value)
        getgenv().Flags.AutoRebirth = Value
        task.spawn(function()
            while getgenv().Flags.AutoRebirth do
                local mode = getgenv().Flags.RebirthMode
                local arg = (mode == "Max") and "Max" or tonumber(mode)
                NetworkInvoke("Rebirth", arg)
                task.wait(1)
            end
        end)
    end
})

TabStats:CreateSection("Upgrades")

TabStats:CreateDropdown({
    Name = "Select Upgrades",
    Options = AllUpgrades,
    CurrentOption = {"More Gems"},
    MultipleOptions = true,
    Flag = "SelectedUpgrades",
    Callback = function(Options) getgenv().Flags.SelectedUpgrades = Options end
})

TabStats:CreateToggle({
    Name = "Auto Buy Upgrades",
    CurrentValue = false,
    Flag = "AutoUpgrade",
    Callback = function(Value)
        getgenv().Flags.AutoUpgrade = Value
        task.spawn(function()
            while getgenv().Flags.AutoUpgrade do
                for _, upg in pairs(getgenv().Flags.SelectedUpgrades) do
                    NetworkInvoke("Upgrade", upg)
                end
                task.wait(1)
            end
        end)
    end
})

-- ==== TAB: SHOP ==== --
local TabShop = Window:CreateTab("Shop 游", 4483362458)

TabShop:CreateDropdown({
    Name = "Merchant Targets",
    Options = MerchantItems,
    CurrentOption = {"Luck Potion"},
    MultipleOptions = true,
    Flag = "MerchantTargets",
    Callback = function(Options) getgenv().Flags.MerchantTargets = Options end
})

TabShop:CreateToggle({
    Name = "Auto Buy Merchant",
    CurrentValue = false,
    Flag = "AutoMerchant",
    Callback = function(Value)
        getgenv().Flags.AutoMerchant = Value
        task.spawn(function()
            while getgenv().Flags.AutoMerchant do
                if getgenv().Flags.MerchantTargets then
                    for _, item in pairs(getgenv().Flags.MerchantTargets) do
                        NetworkInvoke("Merchant Buy", item)
                    end
                end
                for i = 1, 3 do NetworkInvoke("Merchant Buy", i) end
                task.wait(2)
            end
        end)
    end
})

-- ==== TAB: EVENT ==== --
local TabEvent = Window:CreateTab("Event 游꾻", 4483362458)

TabEvent:CreateToggle({
    Name = "Auto Buy Event Pickaxe",
    CurrentValue = false,
    Flag = "AutoEventPick",
    Callback = function(Value)
        getgenv().Flags.AutoEventPick = Value
        task.spawn(function()
            while getgenv().Flags.AutoEventPick do
                NetworkInvoke("Buy Christmas Pickaxe")
                task.wait(1)
            end
        end)
    end
})

Rayfield:LoadConfiguration()
--[[
    SlenderHub - Pickaxe Simulator [Complete Premium]
    Version: 23.0
    Features: Auto Mine, Sell, Upgrade, Rebirth, Egg, Pets
    Credits: SlenderHub Team
]]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")
local VirtualUser = game:GetService("VirtualUser")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local RemotesFolder = ReplicatedStorage:WaitForChild("Paper"):WaitForChild("Remotes")
local RemoteEvent = RemotesFolder:WaitForChild("__remoteevent")
local RemoteFunction = RemotesFolder:WaitForChild("__remotefunction")

-- [ 1. PREMIUM CHECK ] --
local AccessLevel = getgenv().SlenderHubAccessLevel or "Free"
local isPremium = (AccessLevel == "Premium")

-- [ 2. DELAYS (SPEED CONFIG) ] --
local Delays = {
    Mine = isPremium and 0.0 or 0.25,
    Train = isPremium and 0.5 or 2.5,
    Egg = isPremium and 0.05 or 1.5,
    Action = isPremium and 0.1 or 1.0 -- Usado para Upgrade/Rebirth/Sell
}

-- [ 3. VARIABLES & LISTS ] --
local Flags = {
    AutoMine = false, TPMine = false, AutoSell = false,
    AutoEgg = false, AutoTrain = false, AutoUpgrade = false,
    AutoCraftGold = false, AutoCraftRainbow = false, AutoRebirth = false,
    TargetUpgrade = "More Damage", RebirthAmount = "1"
}

local EggSettings = { SelectedEgg = "Basic Egg", Amount = "Max" }

local UpgradeList = {
    "More Gems", "More Rebirths", "More Coins", "More Damage",
    "Egg Luck", "Hatch Speed", "Pets Equipped", "Inventory Space",
    "Golden Chance", "Rainbow Chance", "Walk Speed"
}

local RebirthTable = {1,5,20,50,100,250,500,1000,2500,5000,10000,25000,50000,100000,250000,500000,1000000}
local RebirthDropdown = {}; for i,v in ipairs(RebirthTable) do table.insert(RebirthDropdown, tostring(v)) end
table.insert(RebirthDropdown, "Max")

local EggList = {
    "Basic Egg", "Rare Egg", "Forest Egg", "Black Hole Egg", "UFO Egg", "Garden Egg",
    "Sand Egg", "Snow Egg", "Lava Egg", "Sunny Egg", "Cave Egg", "Sakura Egg",
    "Beach Egg", "Aqua Egg", "Music Egg", "Rocket Egg", "Aura Egg"
}

-- [ 4. UI SETUP ] --
local Success, Rayfield = pcall(function() return loadstring(game:HttpGet('https://sirius.menu/rayfield'))() end)
if not Success then Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/shlexware/Rayfield/main/source'))() end

local WindowName = isPremium and "SlenderHub | ðŸ’Ž PREMIUM" or "SlenderHub | Free Version"
local Window = Rayfield:CreateWindow({
    Name = WindowName,
    LoadingTitle = "SlenderHub V23",
    LoadingSubtitle = "Full Features Restored",
    ConfigurationSaving = { Enabled = true, FolderName = "SlenderHubV23", FileName = "ConfigV23" },
    KeySystem = false
})

-- ==================== TAB: FARM ====================
local TabFarm = Window:CreateTab("Farm", 4483362458)

-- >> MINING
TabFarm:CreateSection("Mining Operations")

local MineTitle = isPremium and "Auto Mine (TURBO âš¡)" or "Auto Mine"
TabFarm:CreateToggle({
    Name = MineTitle,
    CurrentValue = false,
    Flag = "AutoMine",
    Callback = function(Value)
        Flags.AutoMine = Value
        pcall(function() RemoteEvent:FireServer("Toggle Setting", "AutoMine") end)
        if Value then
            task.spawn(function()
                while Flags.AutoMine do
                    local vp = Workspace.CurrentCamera.ViewportSize
                    VirtualInputManager:SendMouseButtonEvent(vp.X/2, vp.Y/2, 0, true, game, 1)
                    VirtualInputManager:SendMouseButtonEvent(vp.X/2, vp.Y/2, 0, false, game, 1)
                    task.wait(Delays.Mine)
                end
            end)
        end
    end,
})

TabFarm:CreateToggle({
    Name = "TP Mine (Void Mode)",
    CurrentValue = false,
    Flag = "TPMine",
    Callback = function(Value)
        Flags.TPMine = Value
        if Value then
            task.spawn(function()
                while Flags.TPMine do
                    pcall(function()
                        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                            local hrp = LocalPlayer.Character.HumanoidRootPart
                            local closestOre, minDist = nil, 999
                            for _, ore in pairs(Workspace.Mine:GetChildren()) do
                                if ore:IsA("Model") then
                                    local orePos = ore:GetPivot().Position
                                    if (orePos - hrp.Position).Magnitude < 50 and orePos.Y < hrp.Position.Y then
                                        if (orePos - hrp.Position).Magnitude < minDist then minDist = (orePos - hrp.Position).Magnitude; closestOre = ore end
                                    end
                                end
                            end
                            if closestOre then hrp.CFrame = closestOre:GetPivot() + Vector3.new(0, 6, 0) end
                        end
                    end)
                    task.wait(0.1)
                end
            end)
        end
    end,
})

-- >> SELLING (RESTAURADO)
TabFarm:CreateSection("Economy")

TabFarm:CreateToggle({
    Name = "Auto Sell Ores",
    CurrentValue = false,
    Flag = "AutoSell",
    Callback = function(Value)
        Flags.AutoSell = Value
        if Value then
            task.spawn(function()
                while Flags.AutoSell do
                    pcall(function() RemoteFunction:InvokeServer("Sell All Ores") end)
                    task.wait(Delays.Action + 1) -- Um pouco mais lento que minerar
                end
            end)
        end
    end,
})

-- >> UPGRADES (RESTAURADO)
TabFarm:CreateSection("Upgrades")

TabFarm:CreateDropdown({
    Name = "Select Upgrade Target",
    Options = UpgradeList,
    CurrentOption = {"More Damage"},
    MultipleOptions = false,
    Flag = "TargetUpgrade",
    Callback = function(Option) Flags.TargetUpgrade = Option[1] end,
})

TabFarm:CreateToggle({
    Name = "Auto Buy Upgrade",
    CurrentValue = false,
    Flag = "AutoUpgrade",
    Callback = function(Value)
        Flags.AutoUpgrade = Value
        if Value then
            task.spawn(function()
                while Flags.AutoUpgrade do
                    pcall(function() RemoteEvent:FireServer("Upgrade", Flags.TargetUpgrade) end)
                    task.wait(Delays.Action)
                end
            end)
        end
    end,
})

-- ==================== TAB: STATS (Rebirth & Train) ====================
local TabStats = Window:CreateTab("Stats", 4483362458)

-- >> REBIRTH (RESTAURADO)
TabStats:CreateSection("Rebirth System")

TabStats:CreateDropdown({
    Name = "Rebirth Amount",
    Options = RebirthDropdown,
    CurrentOption = {"1"},
    MultipleOptions = false,
    Flag = "RebirthAmount",
    Callback = function(Option) Flags.RebirthAmount = Option[1] end,
})

TabStats:CreateToggle({
    Name = "Auto Rebirth",
    CurrentValue = false,
    Flag = "AutoRebirth",
    Callback = function(Value)
        Flags.AutoRebirth = Value
        if Value then
            task.spawn(function()
                while Flags.AutoRebirth do
                    pcall(function()
                        local index = nil
                        if Flags.RebirthAmount == "Max" then
                            index = "Max" -- Tenta enviar string Max
                        else
                            -- Encontra o Ã­ndice numÃ©rico na tabela (ex: 20 Rebirths = Index 3)
                            for i, v in ipairs(RebirthTable) do
                                if tostring(v) == Flags.RebirthAmount then index = i; break end
                            end
                        end
                        if index then RemoteFunction:InvokeServer("Rebirth", index) end
                    end)
                    task.wait(Delays.Action + 1)
                end
            end)
        end
    end,
})

-- >> TRAINING
TabStats:CreateSection("Training")

local TrainTitle = isPremium and "Auto Train (FAST)" or "Auto Train"
TabStats:CreateToggle({
    Name = TrainTitle,
    CurrentValue = false,
    Flag = "AutoTrain",
    Callback = function(Value)
        Flags.AutoTrain = Value
        pcall(function() RemoteEvent:FireServer("Toggle Setting", "AutoTrain") end)
        -- Monitoramento adicional caso precise reativar
    end,
})

-- ==================== TAB: EGGS ====================
local TabEgg = Window:CreateTab("Eggs", 4483362458)

TabEgg:CreateDropdown({
    Name = "Select Egg",
    Options = EggList,
    CurrentOption = {"Basic Egg"},
    MultipleOptions = false,
    Flag = "SelectedEgg",
    Callback = function(Option) EggSettings.SelectedEgg = Option[1] end,
})

TabEgg:CreateToggle({
    Name = "Auto Open Egg",
    CurrentValue = false,
    Flag = "AutoEgg",
    Callback = function(Value)
        Flags.AutoEgg = Value
        if Value then
            task.spawn(function()
                while Flags.AutoEgg do
                    local args = {"Hatch Egg", EggSettings.SelectedEgg, EggSettings.Amount}
                    pcall(function() RemoteFunction:InvokeServer(unpack(args)) end)
                    task.wait(Delays.Egg)
                end
            end)
        end
    end,
})

-- ==================== TAB: PETS ====================
local TabPets = Window:CreateTab("Pets", 4483362458)

local function CraftPets(action, targetTier)
    local petsFolder = nil
    if LocalPlayer:FindFirstChild("Stats") and LocalPlayer.Stats:FindFirstChild("Pets") then
        petsFolder = LocalPlayer.Stats.Pets
    end
    if not petsFolder then return end

    local groupedPets = {}
    for _, pet in pairs(petsFolder:GetChildren()) do
        local pName, pTier, pLocked = pet:GetAttribute("PetName"), pet:GetAttribute("Tier"), pet:GetAttribute("Locked")
        if pName and pTier == targetTier and not pLocked then
            if not groupedPets[pName] then groupedPets[pName] = {} end
            table.insert(groupedPets[pName], pet.Name)
        end
    end

    for petName, uuidList in pairs(groupedPets) do
        while #uuidList >= 8 do
            local batch = {}
            for i = 1, 8 do table.insert(batch, table.remove(uuidList)) end
            local args = {"Pet", {Action = action, Pets = batch}}
            pcall(function() RemoteFunction:InvokeServer(unpack(args)) end)
            task.wait(0.1)
        end
    end
end

TabPets:CreateToggle({
    Name = "Auto Craft Golden (Needs 8 Pets)",
    CurrentValue = false,
    Flag = "AutoCraftGold",
    Callback = function(Value)
        Flags.AutoCraftGold = Value
        if Value then
            task.spawn(function()
                while Flags.AutoCraftGold do
                    CraftPets("CraftGolden", 1) -- Tier 1 -> Golden
                    task.wait(2)
                end
            end)
        end
    end,
})

TabPets:CreateToggle({
    Name = "Auto Craft Rainbow (Needs 8 Gold)",
    CurrentValue = false,
    Flag = "AutoCraftRainbow",
    Callback = function(Value)
        Flags.AutoCraftRainbow = Value
        if Value then
            task.spawn(function()
                while Flags.AutoCraftRainbow do
                    CraftPets("CraftRainbow", 2) -- Tier 2 -> Rainbow
                    task.wait(2)
                end
            end)
        end
    end,
})

-- ==================== TAB: MISC ====================
local TabMisc = Window:CreateTab("Misc", 4483362458)

TabMisc:CreateButton({
    Name = "Map Cleaner (FPS Boost)",
    Callback = function()
        pcall(function()
            if Workspace:FindFirstChild("Eggs") then Workspace.Eggs:Destroy() end
            if Workspace:FindFirstChild("Passes") then Workspace.Passes:Destroy() end
            if Workspace:FindFirstChild("ExclusiveStands") then Workspace.ExclusiveStands:Destroy() end
        end)
        Rayfield:Notify({Title = "Cleaned", Content = "Visual lag removed.", Duration = 3})
    end,
})

-- Init Notify
Rayfield:Notify({
    Title = "SlenderHub Loaded",
    Content = "Version 23.0 (" .. AccessLevel .. ")",
    Duration = 5,
    Image = 4483362458,
})

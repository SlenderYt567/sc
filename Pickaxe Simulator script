--[[
    SlenderHub - Pickaxe Simulator [V60.1 TITANIUM COMPLETE]
    Architect: ScriptForge AI (v3.5)
    
    =========== [ INSTRU√á√ïES DE ACESSO ] ===========
    Defina o n√≠vel de acesso ANTES de rodar o script:
    
    getgenv().SlenderHubAccessLevel = "Free"    
    -- Limita minera√ß√£o a 2x, delay humano, loops lentos.
    
    getgenv().SlenderHubAccessLevel = "Premium" 
    -- Libera minera√ß√£o 100x, vacuum instant√¢neo, loops Heartbeat.
    ================================================
]]

-- [ 0. SAFETY SINGLETON ] --
if getgenv().SlenderHubLoaded then 
    warn("‚õî SlenderHub j√° est√° rodando!")
    return 
end
getgenv().SlenderHubLoaded = true

-- [ 1. CONFIGURA√á√ÉO DE ACESSO ] --
local AccessLevel = getgenv().SlenderHubAccessLevel or "Free" 
local IsPremium = (AccessLevel == "Premium")

-- Configura√ß√µes Din√¢micas Baseadas no Acesso
local Config = {
    SpeedLimit = IsPremium and 100 or 2, -- Premium: 100x | Free: 2x
    LoopDelay = IsPremium and 0.01 or 0.25, -- Delay dos loops gerais
    EventDelay = IsPremium and 0 or 1.5, -- Delay para pegar presentes
}

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- UI Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- [ 2. DATABASE INTERNA ] --
getgenv().Flags = {
    MiningSpeed = 1,
    Egg = "Basic Egg",
    HatchMode = "1",
    RebirthMode = "1",
    SelectedMerch = {},
    SelectedUpg = {}
}

local GameData = {
    Paper = nil,
    MineClient = nil,
    Remotes = { Funct = nil, Event = nil },
    Tables = { 
        Eggs = {}, 
        Rebirths = {"1", "Max"}, 
        Upgrades = {},
        EventItems = { -- Extra√≠do do Decompile
            "Luck Potion", "Speed Potion", "Snowflake Potion", "Festive Candy", 
            "Festive Bell", "Snowball", "Hatch Booster", "Holy Clover", 
            "Lucky Rainbow", "Candy Cane Seed", "Christmas Tree Seed"
        }
    }
}

-- [ 3. INICIALIZA√á√ÉO E HOOKS ] --
local function Initialize()
    local s, e = pcall(function()
        -- 3.1 Load Framework
        GameData.Paper = require(ReplicatedStorage:WaitForChild("Paper", 10))
        
        -- 3.2 Hook Remotes
        local R = ReplicatedStorage.Paper:FindFirstChild("Remotes")
        if R then
            GameData.Remotes.Funct = R:FindFirstChild("__remotefunction")
            GameData.Remotes.Event = R:FindFirstChild("__remoteevent")
        end

        -- 3.3 Hook MineClient (Crucial para o Loop de Minera√ß√£o)
        task.spawn(function()
            local attempts = 0
            while not GameData.MineClient and attempts < 20 do
                for _, v in pairs(getgc(true)) do
                    if type(v) == "table" and rawget(v, "MineCurrentOre") then
                        GameData.MineClient = v
                        break
                    end
                end
                attempts = attempts + 1
                task.wait(1)
            end
        end)

        -- 3.4 Carregar Tabelas do Jogo (Dropdowns)
        local T = ReplicatedStorage:WaitForChild("Tables", 5)
        if T then
            -- Eggs
            local ET = require(T:WaitForChild("Eggs"))
            for n,_ in pairs(ET) do table.insert(GameData.Tables.Eggs, n) end
            table.sort(GameData.Tables.Eggs)

            -- Rebirths
            local RT = require(T:WaitForChild("Rebirths"))
            local rebs = {}
            for _,v in pairs(RT) do table.insert(rebs, tostring(v)) end
            table.sort(rebs, function(a,b) return tonumber(a) < tonumber(b) end)
            table.insert(rebs, "Max")
            GameData.Tables.Rebirths = rebs

            -- Upgrades
            local UT = require(T:WaitForChild("Upgrades"))
            for n,_ in pairs(UT) do table.insert(GameData.Tables.Upgrades, n) end
            table.sort(GameData.Tables.Upgrades)
        end
    end)
    if not s then warn("Falha na Inicializa√ß√£o: " .. tostring(e)) end
end
Initialize()

-- [ 4. GERENCIADOR DE TAREFAS ] --
local TaskManager = {}
local Connections = {} 

local function StopTask(name)
    if TaskManager[name] then task.cancel(TaskManager[name]) TaskManager[name] = nil end
    if Connections[name] then Connections[name]:Disconnect() Connections[name] = nil end
end

local function StartTask(name, func)
    StopTask(name)
    TaskManager[name] = task.spawn(func)
end

local function NetworkCall(type, method, ...)
    local remote = (type == "Invoke") and GameData.Remotes.Funct or GameData.Remotes.Event
    if GameData.Paper and GameData.Paper.Network then
        local call = (type == "Invoke") and GameData.Paper.Network.InvokeServer or GameData.Paper.Network.FireServer
        return call(method, ...)
    elseif remote then
        if type == "Invoke" then return remote:InvokeServer(method, ...) else remote:FireServer(method, ...) end
    end
end

-- [ 5. L√ìGICA PRINCIPAL (CORE) ] --

-- 5.1 SISTEMA DE MINERA√á√ÉO (Nativo + Loop)
local function EnableMining(bool)
    StopTask("Mining")
    
    if bool then
        -- Aplica o Speed Hack Nativo (Exploit descoberto no AutoMine.lua)
        if LocalPlayer then 
            LocalPlayer:SetAttribute("SPEED_HACK", getgenv().Flags.MiningSpeed) 
        end
        
        -- Garante que o jogo sabe que estamos minerando
        NetworkCall("Fire", "Toggle Setting", "AutoMine")

        if IsPremium then
            -- PREMIUM: Usa Heartbeat (60x/segundo ou mais, sincronizado com f√≠sica)
            Connections["Mining"] = RunService.Heartbeat:Connect(function()
                if GameData.MineClient then GameData.MineClient.MineCurrentOre() end
            end)
        else
            -- FREE: Usa loop While simples com delay (Seguran√ßa anti-kick)
            StartTask("Mining", function()
                while true do
                    if GameData.MineClient then GameData.MineClient.MineCurrentOre() end
                    task.wait(0.2)
                end
            end)
        end
    else
        if LocalPlayer then LocalPlayer:SetAttribute("SPEED_HACK", nil) end
    end
end

-- 5.2 GIFT VACUUM (Evento de Natal)
local function EnableGiftVacuum(bool)
    StopTask("Gifts")
    if bool then
        local GiftFolder = Workspace:WaitForChild("Objects", 5)
        if not GiftFolder then return end

        local function Collect(model)
            if model:IsA("Model") and model.PrimaryPart then
                -- Teleporta acima do presente
                LocalPlayer.Character:PivotTo(model.PrimaryPart.CFrame + Vector3.new(0,3,0))
                -- Free tem delay para n√£o parecer bot
                if not IsPremium then task.wait(0.25) end
                NetworkCall("Invoke", "Claim Gift", model.Name)
            end
        end

        if IsPremium then
            -- PREMIUM: Event Listener (Instant√¢neo assim que spawna)
            Connections["Gifts"] = GiftFolder.ChildAdded:Connect(Collect)
            for _, g in pairs(GiftFolder:GetChildren()) do Collect(g) end
        else
            -- FREE: Loop Scanner (Verifica a pasta a cada X segundos)
            StartTask("Gifts", function()
                while true do
                    for _, g in pairs(GiftFolder:GetChildren()) do Collect(g) end
                    task.wait(2) 
                end
            end)
        end
    end
end

-- 5.3 FARM PLANT/HARVEST
local function FarmLogic()
    -- Colheita
    local W = Workspace.Worlds:FindFirstChild("Stud World") or Workspace.Worlds:FindFirstChild("Farm")
    if W and W:FindFirstChild("Farm") then
        for _, p in pairs(W.Farm.Plants:GetChildren()) do
            if p:FindFirstChild("Fruits") and #p.Fruits:GetChildren() > 0 then
                NetworkCall("Invoke", "Harvest Fruit", "Stud World", p.Name)
            end
        end
    end
    -- Plantio
    if GameData.Paper then
        local plants = GameData.Paper.Stats.Get("Plants"):GetChildren()
        local max = 4 + GameData.Paper.Stats.Get("FarmLevel").Value
        if #plants < max then
            for _,s in pairs({"Christmas Tree", "Candy Cane", "Watermelon", "Apple"}) do 
                NetworkCall("Invoke", "Plant", s) 
            end
        end
    end
    NetworkCall("Invoke", "Upgrade Farm")
end

-- 5.4 BULK CRAFTING
local function BulkCraft(tier)
    if not GameData.Paper then return end
    local pets = GameData.Paper.Stats.Get("Pets").Value
    local groups = {}
    for uuid, p in pairs(pets) do
        if not p.Equipped and not p.Locked and p.Tier == tier then
            local n = p.Name or p.Id
            if not groups[n] then groups[n] = {} end
            table.insert(groups[n], uuid)
        end
    end
    for _, uuids in pairs(groups) do
        if #uuids >= 5 then
            local act = (tier == 1) and "CraftAllGolden" or "CraftAllRainbow"
            NetworkCall("Invoke", "Pet", {Action = act, Pets = uuids})
        end
    end
end

-- [ 6. INTERFACE GR√ÅFICA (UI) ] --
local Window = Rayfield:CreateWindow({
   Name = IsPremium and "SlenderHub | TITANIUM V60.1 üíé" or "SlenderHub | FREE V60.1 ‚ö†Ô∏è",
   LoadingTitle = IsPremium and "Titanium Access Granted" or "Free Version Loaded",
   ConfigurationSaving = { Enabled = true, FileName = "SlenderHubV60" },
   KeySystem = false,
})

-- ==== ABA: MINE ==== --
local TabMine = Window:CreateTab("Mine ‚õèÔ∏è", 4483345998)

TabMine:CreateSection(IsPremium and "GOD MODE CONTROLS" or "LEGIT CONTROLS")

TabMine:CreateSlider({
    Name = "Mining Speed Multiplier",
    -- A L√ìGICA PEDIDA:
    -- Free: Range 1 a 2. Incremento 0.5 (Permite 1x, 1.5x, 2x)
    -- Premium: Range 1 a 100.
    Range = {1, Config.SpeedLimit},
    Increment = IsPremium and 1 or 0.5,
    Suffix = "x",
    CurrentValue = 1,
    Callback = function(Value)
        getgenv().Flags.MiningSpeed = Value
        -- Atualiza em tempo real
        if LocalPlayer and LocalPlayer:GetAttribute("SPEED_HACK") then
            LocalPlayer:SetAttribute("SPEED_HACK", Value)
        end
    end
})

TabMine:CreateToggle({
    Name = IsPremium and "Enable Hyper Mine (Heartbeat)" or "Enable Auto Mine (Standard)",
    CurrentValue = false,
    Callback = function(v) EnableMining(v) end
})

TabMine:CreateToggle({
    Name = "Auto Buy Miner",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Miner", function() while true do NetworkCall("Invoke", "Buy Miner") task.wait(2) end end)
        else StopTask("Miner") end
    end
})

TabMine:CreateToggle({
    Name = "Auto Enchant Pickaxe",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Ench", function() while true do NetworkCall("Invoke", "Enchant Pickaxe") task.wait(3) end end)
        else StopTask("Ench") end
    end
})

-- ==== ABA: EGGS ==== --
local TabEggs = Window:CreateTab("Eggs ü•ö", 4483362458)

TabEggs:CreateDropdown({
    Name = "Select Egg",
    Options = GameData.Tables.Eggs,
    CurrentOption = {"Basic Egg"},
    Callback = function(O) getgenv().Flags.Egg = O[1] end
})

TabEggs:CreateDropdown({
    Name = "Hatch Amount",
    Options = {"1", "3", "Max"},
    CurrentOption = {"1"},
    Callback = function(O) getgenv().Flags.HatchMode = O[1] end
})

TabEggs:CreateToggle({
    Name = IsPremium and "FLASH HATCH (No Delay)" or "Auto Hatch (Anim Delay)",
    CurrentValue = false,
    Callback = function(v)
        if v then
            StartTask("Hatch", function()
                while true do
                    local mode = getgenv().Flags.HatchMode
                    local amt = (mode == "Max" and "Max" or tonumber(mode))
                    NetworkCall("Invoke", "Hatch Egg", getgenv().Flags.Egg, amt)
                    -- Premium quase sem delay, Free espera anima√ß√£o
                    task.wait(IsPremium and 0.05 or 0.6)
                end
            end)
        else StopTask("Hatch") end
    end
})

-- ==== ABA: FARM/PETS ==== --
local TabFP = Window:CreateTab("Farm/Pets üêæ", 4483362458)

TabFP:CreateToggle({
    Name = "Auto Plant & Harvest & Upgrade",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Farm", function() while true do FarmLogic() task.wait(IsPremium and 1 or 3) end end)
        else StopTask("Farm") end
    end
})

TabFP:CreateToggle({
    Name = "Auto Craft All (Golden & Rainbow)",
    CurrentValue = false,
    Callback = function(v)
        if v then
            StartTask("Craft", function()
                while true do
                    BulkCraft(1) -- Gold
                    task.wait(0.2)
                    BulkCraft(2) -- Rainbow
                    task.wait(2)
                end
            end)
        else StopTask("Craft") end
    end
})

-- ==== ABA: UPGRADES ==== --
local TabUpg = Window:CreateTab("Upgrades üìà", 4483362458)

TabUpg:CreateDropdown({
    Name = "Rebirth Amount",
    Options = GameData.Tables.Rebirths,
    CurrentOption = {"1"},
    Callback = function(O) getgenv().Flags.RebirthMode = O[1] end
})

TabUpg:CreateToggle({
    Name = "Auto Rebirth",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Reb", function() 
            while true do 
                local r = getgenv().Flags.RebirthMode
                NetworkCall("Invoke", "Rebirth", (r=="Max" and "Max" or tonumber(r))) 
                task.wait(1) 
            end end)
        else StopTask("Reb") end
    end
})

TabUpg:CreateDropdown({
    Name = "Select Upgrades",
    Options = GameData.Tables.Upgrades,
    CurrentOption = {"More Gems"},
    MultipleOptions = true,
    Callback = function(O) getgenv().Flags.SelectedUpg = O end
})

TabUpg:CreateToggle({
    Name = "Auto Buy Upgrades",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("BuyUpg", function() while true do for _,u in pairs(getgenv().Flags.SelectedUpg) do NetworkCall("Invoke", "Upgrade", u) end task.wait(2) end end)
        else StopTask("BuyUpg") end
    end
})

-- ==== ABA: EVENTO ==== --
local TabEvent = Window:CreateTab("Event üéÑ", 4483362458)

TabEvent:CreateSection(IsPremium and "VACUUM MODE" or "SLOW SCAN MODE")

TabEvent:CreateToggle({
    Name = IsPremium and "GIFT VACUUM (Instant Teleport)" or "Auto Farm Gifts (Scan Loop)",
    CurrentValue = false,
    Callback = function(v) EnableGiftVacuum(v) end
})

TabEvent:CreateDropdown({
    Name = "Merchant Items",
    Options = GameData.Tables.EventItems,
    CurrentOption = {"Luck Potion"},
    MultipleOptions = true,
    Callback = function(O) getgenv().Flags.SelectedMerch = O end
})

TabEvent:CreateToggle({
    Name = "Auto Buy Merchant",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Merch", function() while true do for _, item in pairs(getgenv().Flags.SelectedMerch) do NetworkCall("Invoke", "Buy Event Merchant", item) end task.wait(3) end end)
        else StopTask("Merch") end
    end
})

TabEvent:CreateToggle({
    Name = "Auto Buy Event Pickaxe",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("EventPick", function() while true do NetworkCall("Invoke", "Buy Christmas Pickaxe") task.wait(1) end end)
        else StopTask("EventPick") end
    end
})

Rayfield:LoadConfiguration()
Rayfield:Notify({
    Title = IsPremium and "TITANIUM ACCESS" or "FREE ACCESS",
    Content = IsPremium and "Max Speed: 100x | Instant Vacuum" or "Max Speed: 2x | Safe Mode",
    Duration = 5,
    Image = 4483345998,
})

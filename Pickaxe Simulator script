--[[
    SlenderHub - Pickaxe Simulator [V60.0 TITANIUM EDITION]
    Architect: ScriptForge AI (v3.5)
    
    SYSTEM STATUS:
    [+] AUTH: Key System Integrated (Premium/Free Switch).
    [+] MINE: Native Speed Hack + Heartbeat Loop (Premium).
    [+] FARM: Auto Plant/Harvest/Upgrade (Smart Logic).
    [+] PETS: Bulk Craft All (Golden & Rainbow).
    [+] EVENT: Instant Gift Vacuum (ChildAdded Event).
    [+] DATA: Dynamic Table Loading (Eggs, Rebirths, Upgrades).
]]

-- [ 0. AUTHENTICATION & CONFIG ] --
local HubName = "SlenderHub_V60"
if getgenv()[HubName] then warn("‚õî Hub j√° est√° em execu√ß√£o!") return end
getgenv()[HubName] = true

-- ::: CHAVE DE ACESSO :::
-- Mude para "TITANIUM_KEY" para ativar o modo Premium
getgenv().SlenderKey = "TITANIUM_KEY" 

local IsPremium = (getgenv().SlenderKey == "TITANIUM_KEY")

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- [ 1. INTERNAL DATA & MIRROR ] --
local GameData = {
    Paper = nil,
    MineClient = nil,
    Remotes = { Funct = nil, Event = nil },
    Tables = {
        Eggs = {},
        Rebirths = {"1", "Max"}, -- Default fallback
        Upgrades = {},
        EventUpgrades = {},
        Shop = nil
    }
}

-- Inicializa√ß√£o Segura (Load Game Data)
local function Initialize()
    local success, err = pcall(function()
        -- 1. Load Paper Framework
        GameData.Paper = require(ReplicatedStorage:WaitForChild("Paper", 10))
        
        -- 2. Find Remotes
        local R = ReplicatedStorage.Paper:FindFirstChild("Remotes")
        if R then
            GameData.Remotes.Funct = R:FindFirstChild("__remotefunction")
            GameData.Remotes.Event = R:FindFirstChild("__remoteevent")
        end

        -- 3. Load MineClient (For God Mode)
        task.spawn(function()
            for _, v in pairs(getgc(true)) do
                if type(v) == "table" and rawget(v, "MineCurrentOre") then
                    GameData.MineClient = v
                    break
                end
            end
        end)

        -- 4. Load Tables Dynamically (Decompile Data)
        local T = ReplicatedStorage:WaitForChild("Tables", 5)
        if T then
            -- Eggs
            local ET = require(T:WaitForChild("Eggs"))
            local eggs = {}
            for n,_ in pairs(ET) do table.insert(eggs, n) end
            table.sort(eggs)
            GameData.Tables.Eggs = eggs

            -- Rebirths
            local RT = require(T:WaitForChild("Rebirths"))
            local rebs = {}
            for _,v in pairs(RT) do table.insert(rebs, tostring(v)) end
            table.sort(rebs, function(a,b) return tonumber(a) < tonumber(b) end)
            table.insert(rebs, "Max")
            GameData.Tables.Rebirths = rebs

            -- Upgrades (Split Normal/Event)
            local UT = require(T:WaitForChild("Upgrades"))
            local upgs = {}
            for n,_ in pairs(UT) do table.insert(upgs, n) end
            table.sort(upgs)
            GameData.Tables.Upgrades = upgs

            -- Event Upgrades (Manual List based on Decompile if file missing)
            GameData.Tables.EventUpgrades = {
                "More Event Damage", "More Candy Canes", "More Snowflakes", 
                "Present Luck", "Hatch Speed", "Candy Canes Boost"
            }
        end
    end)
    if not success then warn("Init Warn: " .. tostring(err)) end
end
Initialize()

-- [ 2. UTILS & NETWORK ] --
local TaskManager = {}
local Connections = {} -- For Premium Events

local function StopTask(name)
    if TaskManager[name] then task.cancel(TaskManager[name]) TaskManager[name] = nil end
    if Connections[name] then Connections[name]:Disconnect() Connections[name] = nil end
end

local function StartTask(name, func)
    StopTask(name)
    TaskManager[name] = task.spawn(func)
end

local function NetworkCall(type, method, ...)
    local remote = (type == "Invoke") and GameData.Remotes.Funct or GameData.Remotes.Event
    if GameData.Paper and GameData.Paper.Network then
        local call = (type == "Invoke") and GameData.Paper.Network.InvokeServer or GameData.Paper.Network.FireServer
        return call(method, ...)
    elseif remote then
        if type == "Invoke" then return remote:InvokeServer(method, ...) else remote:FireServer(method, ...) end
    end
end

-- [ 3. PREMIUM LOGIC ENGINE ] --

-- 3.1 HYPER MINE (Native Speed + Heartbeat)
local function EnableMining(bool)
    StopTask("Mining")
    if bool then
        -- Set Speed Attribute (Game Logic)
        local speedVal = IsPremium and 50 or 5 -- 50x for Premium, 5x for Free
        if LocalPlayer then LocalPlayer:SetAttribute("SPEED_HACK", speedVal) end
        
        -- Force AutoMine Setting
        NetworkCall("Fire", "Toggle Setting", "AutoMine")

        if IsPremium then
            -- PREMIUM: Executa a cada frame renderizado (~60 hits/segundo)
            Connections["Mining"] = RunService.Heartbeat:Connect(function()
                if GameData.MineClient then GameData.MineClient.MineCurrentOre() end
            end)
        else
            -- FREE: Loop tradicional com delay
            StartTask("Mining", function()
                while true do
                    if GameData.MineClient then GameData.MineClient.MineCurrentOre() end
                    task.wait(0.2)
                end
            end)
        end
    else
        if LocalPlayer then LocalPlayer:SetAttribute("SPEED_HACK", nil) end
    end
end

-- 3.2 GIFT VACUUM (Event Teleport)
local function EnableGiftVacuum(bool)
    StopTask("Gifts")
    if bool then
        local GiftFolder = Workspace:WaitForChild("Objects", 5)
        if not GiftFolder then return end

        local function Collect(model)
            if model:IsA("Model") and model.PrimaryPart then
                -- Teleport Instant√¢neo
                LocalPlayer.Character:PivotTo(model.PrimaryPart.CFrame + Vector3.new(0,3,0))
                -- No Premium, n√£o esperamos
                if not IsPremium then task.wait(0.2) end
                NetworkCall("Invoke", "Claim Gift", model.Name)
            end
        end

        if IsPremium then
            -- PREMIUM: Escuta o evento ChildAdded. Spawnou -> Pegou.
            Connections["Gifts"] = GiftFolder.ChildAdded:Connect(Collect)
            -- Coleta os que j√° existem
            for _, g in pairs(GiftFolder:GetChildren()) do Collect(g) end
        else
            -- FREE: Loop que verifica a pasta a cada 1.5s
            StartTask("Gifts", function()
                while true do
                    for _, g in pairs(GiftFolder:GetChildren()) do Collect(g) end
                    task.wait(1.5)
                end
            end)
        end
    end
end

-- 3.3 SMART FARM (Plant & Harvest)
local function FarmLogic()
    -- Harvest Loop
    local World = Workspace.Worlds:FindFirstChild("Stud World") or Workspace.Worlds:FindFirstChild("Farm")
    if World and World:FindFirstChild("Farm") then
        for _, plant in pairs(World.Farm.Plants:GetChildren()) do
            if plant:FindFirstChild("Fruits") and #plant.Fruits:GetChildren() > 0 then
                NetworkCall("Invoke", "Harvest Fruit", "Stud World", plant.Name)
            end
        end
    end

    -- Plant Logic (Calculates slots based on Decompile)
    if GameData.Paper then
        local count = #GameData.Paper.Stats.Get("Plants"):GetChildren()
        local max = 4 + GameData.Paper.Stats.Get("FarmLevel").Value
        if count < max then
            local seeds = {"Christmas Tree", "Candy Cane", "Watermelon", "Apple", "Corn", "Carrot", "Strawberry"}
            for _, s in pairs(seeds) do NetworkCall("Invoke", "Plant", s) end
        end
    end
    NetworkCall("Invoke", "Upgrade Farm")
end

-- 3.4 BULK CRAFT (Action: CraftAll...)
local function BulkCraft(tier)
    if not GameData.Paper then return end
    local pets = GameData.Paper.Stats.Get("Pets").Value
    local groups = {}
    for uuid, p in pairs(pets) do
        if not p.Equipped and not p.Locked and p.Tier == tier then
            local n = p.Name or p.Id
            if not groups[n] then groups[n] = {} end
            table.insert(groups[n], uuid)
        end
    end
    for _, uuids in pairs(groups) do
        if #uuids >= 5 then
            -- Envia apenas os IDs necess√°rios, a a√ß√£o "CraftAll" cuida do resto
            local act = (tier == 1) and "CraftAllGolden" or "CraftAllRainbow"
            NetworkCall("Invoke", "Pet", {Action = act, Pets = uuids})
        end
    end
end

-- [ 4. FLAGS & UI ] --
local Flags = {
    Egg = "Basic Egg",
    HatchMode = "1",
    Rebirth = "1",
    SelectedUpg = {},
    SelectedEventUpg = {}
}

local Window = Rayfield:CreateWindow({
   Name = IsPremium and "SlenderHub | TITANIUM V60 üíé" or "SlenderHub | V60 Free Version",
   LoadingTitle = IsPremium and "Authenticating Premium..." or "Loading Scripts...",
   ConfigurationSaving = { Enabled = true, FileName = "SlenderHubV60" },
   KeySystem = false,
})

-- ==== TAB: MINING ==== --
local TabMine = Window:CreateTab("Mine ‚õèÔ∏è", 4483345998)

TabMine:CreateSection(IsPremium and "TITANIUM MINING (GOD MODE)" or "Standard Mining")

TabMine:CreateToggle({
    Name = IsPremium and "HYPER MINE (Instant Break)" or "Auto Mine (Legit Speed)",
    CurrentValue = false,
    Callback = function(v) EnableMining(v) end
})

TabMine:CreateToggle({
    Name = "Auto Buy Miner",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Miner", function() while true do NetworkCall("Invoke", "Buy Miner") task.wait(2) end end)
        else StopTask("Miner") end
    end
})

TabMine:CreateToggle({
    Name = "Auto Enchant Pickaxe",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Ench", function() while true do NetworkCall("Invoke", "Enchant Pickaxe") task.wait(2) end end)
        else StopTask("Ench") end
    end
})

-- ==== TAB: EGGS ==== --
local TabEggs = Window:CreateTab("Eggs ü•ö", 4483362458)

TabEggs:CreateDropdown({
    Name = "Select Egg",
    Options = GameData.Tables.Eggs,
    CurrentOption = {"Basic Egg"},
    Callback = function(O) Flags.Egg = O[1] end
})

TabEggs:CreateDropdown({
    Name = "Mode",
    Options = {"1", "3", "Max"},
    CurrentOption = {"1"},
    Callback = function(O) Flags.HatchMode = O[1] end
})

TabEggs:CreateToggle({
    Name = IsPremium and "FLASH HATCH (0 Delay)" or "Auto Hatch",
    CurrentValue = false,
    Callback = function(v)
        if v then
            StartTask("Hatch", function()
                while true do
                    local amt = (Flags.HatchMode=="Max" and "Max" or tonumber(Flags.HatchMode))
                    NetworkCall("Invoke", "Hatch Egg", Flags.Egg, amt)
                    -- Premium n√£o espera anima√ß√£o
                    task.wait(IsPremium and 0.05 or 0.5)
                end
            end)
        else StopTask("Hatch") end
    end
})

-- ==== TAB: FARM & PETS ==== --
local TabFP = Window:CreateTab("Farm/Pets üêæ", 4483362458)

TabFP:CreateSection("Training")
TabFP:CreateToggle({
    Name = "Auto Train (Server Toggle)",
    CurrentValue = false,
    Callback = function(v) NetworkCall("Fire", "Toggle Setting", "AutoTrain") end
})

TabFP:CreateSection("Farming")
TabFP:CreateToggle({
    Name = "Auto Plant & Harvest & Upgrade",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Farm", function() while true do FarmLogic() task.wait(IsPremium and 1 or 3) end end)
        else StopTask("Farm") end
    end
})

TabFP:CreateSection("Crafting")
TabFP:CreateToggle({
    Name = "Auto Craft All (Golden & Rainbow)",
    CurrentValue = false,
    Callback = function(v)
        if v then
            StartTask("Craft", function()
                while true do
                    BulkCraft(1) -- Gold
                    task.wait(0.2)
                    BulkCraft(2) -- Rainbow
                    task.wait(2)
                end
            end)
        else StopTask("Craft") end
    end
})

-- ==== TAB: UPGRADES ==== --
local TabUpg = Window:CreateTab("Upgrades üìà", 4483362458)

TabUpg:CreateDropdown({
    Name = "Rebirth Amount",
    Options = GameData.Tables.Rebirths,
    CurrentOption = {"1"},
    Callback = function(O) Flags.Rebirth = O[1] end
})

TabUpg:CreateToggle({
    Name = "Auto Rebirth",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Reb", function() while true do NetworkCall("Invoke", "Rebirth", (Flags.Rebirth=="Max" and "Max" or tonumber(Flags.Rebirth))) task.wait(1) end end)
        else StopTask("Reb") end
    end
})

TabUpg:CreateSection("Shop Upgrades")
TabUpg:CreateDropdown({
    Name = "Normal Upgrades",
    Options = GameData.Tables.Upgrades,
    CurrentOption = {"More Gems"},
    MultipleOptions = true,
    Callback = function(O) Flags.SelectedUpg = O end
})

TabUpg:CreateToggle({
    Name = "Auto Buy Upgrades",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("BuyUpg", function() while true do for _,u in pairs(Flags.SelectedUpg) do NetworkCall("Invoke", "Upgrade", u) end task.wait(2) end end)
        else StopTask("BuyUpg") end
    end
})

-- ==== TAB: EVENT ==== --
local TabEvent = Window:CreateTab("Event üéÑ", 4483362458)

TabEvent:CreateToggle({
    Name = IsPremium and "GIFT VACUUM (Instant)" or "Auto Farm Gifts",
    CurrentValue = false,
    Callback = function(v) EnableGiftVacuum(v) end
})

TabEvent:CreateToggle({
    Name = "Auto Buy Merchant",
    CurrentValue = false,
    Callback = function(v)
        if v then StartTask("Merch", function() while true do for _, item in pairs({"Luck Potion", "Speed Potion", "Snowflake Potion"}) do NetworkCall("Invoke", "Buy Event Merchant", item) end task.wait(3) end end)
        else StopTask("Merch") end
    end
})

Rayfield:LoadConfiguration()
Rayfield:Notify({
    Title = IsPremium and "TITANIUM ACTIVATED" or "FREE MODE",
    Content = IsPremium and "Maximum performance enabled." or "Upgrade key for God Mode.",
    Duration = 5,
    Image = 4483345998,
})

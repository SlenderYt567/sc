--[[
    ScriptForge AI - Horse Race Architect
    Versão: 7.3 (Mobile UI Fix - No Icons/No Delays)
]]

-- 1. Carregar Rayfield
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- 2. Serviços
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer

-- 3. Função de Remote (Segura)
local function GetRemote(ServiceName, RemoteName, IsFunction)
    local Remote = nil
    pcall(function()
        local Knit = ReplicatedStorage.Packages._Index["sleitnick_knit@1.5.1"].knit.Services
        local Service = Knit:FindFirstChild(ServiceName)
        if Service then
            local Folder = Service:FindFirstChild(IsFunction and "RF" or "RE")
            if Folder then Remote = Folder:FindFirstChild(RemoteName) end
        end
    end)
    return Remote
end

-- 4. Variáveis de Controle
local Flags = {
    AutoWin = false, AutoTrain = false, AutoHatch = false, AutoBuy = false, AutoFuse = false,
    TrainWorld = "1", TrainMachine = "1",
    SelectedEgg = "Egg_1_1", VendingItem = "WPN_101"
}

-- 5. CRIAÇÃO DA UI (TUDO JUNTO PARA NÃO BUGAR NO MOBILE)
local Window = Rayfield:CreateWindow({
   Name = "Horse Race | ScriptForge V7.3",
   LoadingTitle = "Carregando...",
   LoadingSubtitle = "Correção Mobile",
   ConfigurationSaving = { Enabled = false },
   KeySystem = false
})

-- == ABA FARM ==
local TabFarm = Window:CreateTab("Farm") -- Sem ícone para evitar bug

TabFarm:CreateSection("Auto Win")
TabFarm:CreateToggle({
   Name = "Auto Win (Gate 16)",
   CurrentValue = false,
   Callback = function(Value)
        Flags.AutoWin = Value
        local Remote = GetRemote("FightService", "GetWinsEvent", false)
        local Vector = Vector3.new(1811.09, 782.79, -689544.81)
        task.spawn(function()
            while Flags.AutoWin and task.wait(0.1) do
                if Remote then pcall(function() Remote:FireServer("WinGate_16", Vector) end)
                else Remote = GetRemote("FightService", "GetWinsEvent", false) end
            end
        end)
   end,
})

TabFarm:CreateSection("Auto Train")
TabFarm:CreateDropdown({
    Name = "Mundo", Options = {"1","2","3","4","5"}, CurrentOption = {"1"},
    Callback = function(O) Flags.TrainWorld = O[1] end
})
TabFarm:CreateDropdown({
    Name = "Máquina", Options = {"1","2","3","4","5","6","7","8","9","10"}, CurrentOption = {"1"},
    Callback = function(O) Flags.TrainMachine = O[1] end
})
TabFarm:CreateToggle({
   Name = "Ativar Treino",
   CurrentValue = false,
   Callback = function(Value)
        Flags.AutoTrain = Value
        local Remote = GetRemote("TrainService", "RunTrain", false)
        task.spawn(function()
            while Flags.AutoTrain and task.wait() do
                if Remote then
                    pcall(function() Remote:FireServer("Treadmill_"..Flags.TrainWorld.."_"..Flags.TrainMachine) end)
                else Remote = GetRemote("TrainService", "RunTrain", false) end
            end
        end)
   end,
})

-- == ABA EGGS ==
local TabEggs = Window:CreateTab("Eggs")

local EggIDs = { "Egg_1_1", "Egg_1_2", "Egg_1_3", "Egg_1_4", "Egg_2_1", "Egg_2_2", "Egg_2_3", "Egg_2_4", "Egg_3_1", "Egg_3_2", "Egg_3_3", "Egg_3_4", "Egg_4_1", "Egg_4_2", "Egg_4_3", "Egg_Tower_1", "Egg_Christmas" }
TabEggs:CreateDropdown({
    Name = "Escolher Ovo", Options = EggIDs, CurrentOption = {"Egg_1_1"},
    Callback = function(O) Flags.SelectedEgg = O[1] end
})
TabEggs:CreateToggle({
   Name = "Auto Hatch (Fast)",
   CurrentValue = false,
   Callback = function(Value)
        Flags.AutoHatch = Value
        local Remote = GetRemote("EggHatchService", "Hatch", false)
        task.spawn(function()
            while Flags.AutoHatch do
                if Remote then pcall(function() Remote:FireServer(Flags.SelectedEgg, 1) end)
                else Remote = GetRemote("EggHatchService", "Hatch", false) end
                task.wait(0.25)
            end
        end)
   end,
})

-- == ABA FUSE ==
local TabFuse = Window:CreateTab("Fuse")

TabFuse:CreateButton({
    Name = "Fundir Tudo (Fuse All)",
    Callback = function()
        local Remote = GetRemote("FuseService", "FusePets", true)
        if not Remote then return end
        
        -- Leitura Simples de Pets
        local s, data = pcall(function() 
            return require(game:GetService("StarterPlayer").StarterPlayerScripts.Controllers.PlayerDataController):GetData().Pets 
        end)
        
        if s and data then
            local Groups = {}
            for uuid, pet in pairs(data) do
                if not pet.Locked and not pet.Equipped then
                    if not Groups[pet.PetID] then Groups[pet.PetID] = {} end
                    table.insert(Groups[pet.PetID], uuid)
                end
            end
            
            for id, list in pairs(Groups) do
                while #list >= 5 do
                    local batch = {}
                    for i=1,5 do table.insert(batch, table.remove(list)) end
                    pcall(function() Remote:InvokeServer(batch) end)
                    task.wait(0.1)
                end
            end
            Rayfield:Notify({Title="Fuse", Content="Processo finalizado!", Duration=2})
        end
    end,
})

-- == ABA SHOP ==
local TabShop = Window:CreateTab("Shop")
local VendingItems = { "WPN_101", "WPN_102", "Potion_DoubleWins", "Potion_SuperLucky", "KingSlime" }

TabShop:CreateDropdown({
    Name = "Item", Options = VendingItems, CurrentOption = {"WPN_101"},
    Callback = function(O) Flags.VendingItem = O[1] end
})
TabShop:CreateToggle({
   Name = "Auto Buy",
   CurrentValue = false,
   Callback = function(Value)
       Flags.AutoBuy = Value
       local Remote = GetRemote("PurchaseService", "PromptPurchase", false)
       task.spawn(function()
           while Flags.AutoBuy and task.wait(0.5) do
               if Remote then pcall(function() Remote:Fire(Flags.VendingItem) end)
               else Remote = GetRemote("PurchaseService", "PromptPurchase", false) end
           end
       end)
   end,
})

-- == ABA MISC ==
local TabMisc = Window:CreateTab("Misc")
TabMisc:CreateButton({
    Name = "Anti-AFK (Tela Preta)",
    Callback = function()
        RunService:Set3dRenderingEnabled(false)
        LocalPlayer.Idled:connect(function()
            VirtualUser:Button2Down(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
            wait(1)
            VirtualUser:Button2Up(Vector2.new(0,0),workspace.CurrentCamera.CFrame)
        end)
    end,
})
TabMisc:CreateButton({
    Name = "Tela Normal",
    Callback = function() RunService:Set3dRenderingEnabled(true) end
})

Rayfield:LoadConfiguration()
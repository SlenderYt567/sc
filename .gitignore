--!strict
--[[
    SlenderHub - CORE LOADER (Architect Edition V10)
    Focus: Authentication & Game Injection Only
    UI Library: SlenderWind V5 (Internal Standard)
]]

--//==============================[ 0. INICIALIZA√á√ÉO ]==============================//--
local Services = {
    HttpService = game:GetService("HttpService"),
    Players = game:GetService("Players"),
    MarketplaceService = game:GetService("MarketplaceService"),
    CoreGui = game:GetService("CoreGui")
}

local LocalPlayer = Services.Players.LocalPlayer
local CurrentPlaceId = game.PlaceId

-- Singleton (Evita m√∫ltiplas execu√ß√µes)
if getgenv().SlenderHubLoaded then
    warn("[SlenderHub] O Hub j√° est√° em execu√ß√£o.")
    return
end
getgenv().SlenderHubLoaded = true

--//==============================[ 1. CONFIGURA√á√ÉO ]==============================//--
local Config = {
    Folder = "SlenderHub_Auth",
    File = "KeyData_" .. LocalPlayer.UserId .. ".json",
    VeLink_Check = "https://velink.to/api/public/check/key",
    Free_Key_Link = "https://velink.to/u/678807",
    Shop_Link = "https://www.slenderhub.shop/",
    Theme = { Accent = Color3.fromRGB(0, 255, 128) } -- Slender Green
}

-- Mapa de Jogos Suportados
local GAMES_MAP = {
    [93787311916283] = "https://raw.githubusercontent.com/SlenderYt567/sc/refs/heads/main/Horse%20Race",
    [82013336390273] = "https://raw.githubusercontent.com/SlenderYt567/sc/main/Pickaxe%20Simulator%20script",
    [107807115409153] = "https://raw.githubusercontent.com/SlenderYt567/sc/main/Bee%20Tappers%20Script",
    [109983668079237] = "https://raw.githubusercontent.com/SlenderYt567/sc/main/Steal%20a%20Brainrot(Free)",
    [76558904092080] = "https://raw.githubusercontent.com/SlenderYt567/sc/main/The%20Forge%20Script",
    [75992362647444] = "https://raw.githubusercontent.com/SlenderYt567/sc/main/Tap%20simulator",
    [4924922222] = "https://raw.githubusercontent.com/SlenderYt567/sc/refs/heads/main/Brookhaven%20script"
}

-- IDs Premium do VeLink
local VELINK_IDS = {
    ["ed6453e6-5259-49b4-8779-05b866831dc2"] = {Type = "Premium", Duration = 604800}, -- 7 Dias
    ["2c69fdcf-f8e1-4c1a-9270-f36d9545ebce"] = {Type = "Premium", Duration = 2592000} -- 30 Dias
}

-- Keys de Desenvolvedor/Lifetime
local LIFETIME_KEYS = {
    ["LifeTimeF4K9L2P7V8JDHUtY"] = true,
    ["SlenderDevKey"] = true
}

--//==============================[ 2. SISTEMA DE KEY (BACKEND) ]==============================//--
local AuthSystem = {}
AuthSystem.IsAuthenticated = false

function AuthSystem.FormatTime(seconds)
    if seconds == math.huge then return "Lifetime" end
    local days = math.floor(seconds / 86400)
    local hours = math.floor((seconds % 86400) / 3600)
    return string.format("%dd %02dh", days, hours)
end

function AuthSystem.Save(key, type, duration)
    if not isfolder(Config.Folder) then makefolder(Config.Folder) end
    local data = {Key = key, Type = type, Time = os.time(), Duration = duration}
    writefile(Config.Folder .. "/" .. Config.File, Services.HttpService:JSONEncode(data))
    AuthSystem.IsAuthenticated = true
end

function AuthSystem.Load()
    local path = Config.Folder .. "/" .. Config.File
    if not isfile(path) then return nil end
    
    local success, result = pcall(function() 
        return Services.HttpService:JSONDecode(readfile(path)) 
    end)
    
    if not success or not result.Time then return nil end
    
    local elapsed = os.time() - result.Time
    if elapsed > result.Duration then 
        delfile(path) -- Key expirada
        return nil 
    end
    
    AuthSystem.IsAuthenticated = true
    return result, (result.Duration - elapsed)
end

function AuthSystem.Verify(inputKey)
    -- 1. Check Hardcoded Keys
    if LIFETIME_KEYS[inputKey] then return "Dev/Lifetime", math.huge end
    
    -- 2. Check HTTP Request Capability
    local requestFunc = (syn and syn.request) or (http and http.request) or (http_request) or (request)
    if not requestFunc then return "Executor Unsupported", 0 end

    -- 3. Check VeLink API
    local url = string.format("%s?key=%s", Config.VeLink_Check, inputKey)
    local response = requestFunc({Url = url, Method = "GET"})

    if response and response.StatusCode == 200 then
        local success, data = pcall(function() return Services.HttpService:JSONDecode(response.Body) end)
        if success and data and data.expired == false then
            local tier = VELINK_IDS[tostring(data.unlockerId)]
            if tier then return tier.Type, tier.Duration end
            return "Free", 86400 -- Padr√£o 24h
        end
    end
    return nil
end

--//==============================[ 3. INTERFACE (SLENDERWIND) ]==============================//--
local SlenderWind = loadstring(game:HttpGet("https://raw.githubusercontent.com/SlenderYt567/sc/refs/heads/main/SlenderWindV5.lua"))()

local Window = SlenderWind.Window({
    Name = "SlenderHub | Loader V10",
    KeySystem = false, -- Usamos nossa pr√≥pria l√≥gica de key
    Theme = Config.Theme
})

-- Vari√°veis de Estado da UI
local KeyInputVal = ""
local GameName = "Desconhecido"
local IsSupported = GAMES_MAP[CurrentPlaceId] ~= nil

pcall(function() 
    GameName = Services.MarketplaceService:GetProductInfo(CurrentPlaceId).Name 
end)

-- [ABA 1] AUTENTICA√á√ÉO
local AuthTab = Window:Tab("Key System")

AuthTab:Paragraph("Status do Acesso", "Verifique sua key para liberar o Loader.")

AuthTab:Input("Insira sua Key", "Cole a key aqui...", "AuthKeyInput", "Key do VeLink", function(val)
    KeyInputVal = val
end)

AuthTab:Button("üîé Verificar Key", "Validar acesso", function()
    if KeyInputVal == "" then 
        Window:Notify("Erro", "Cole uma key primeiro!", 2)
        return 
    end
    
    Window:Notify("Sistema", "Verificando...", 2)
    local type, duration = AuthSystem.Verify(KeyInputVal)
    
    if type then
        AuthSystem.Save(KeyInputVal, type, duration)
        Window:Notify("Sucesso", "Acesso Liberado: " .. type, 5)
        AuthTab:Label("Status: Autenticado (" .. type .. ")")
    else
        Window:Notify("Erro", "Key Inv√°lida ou Expirada", 3)
    end
end)

AuthTab:Section("Obter Acesso")

AuthTab:Button("üîë Pegar Key Free (24h)", "Copia o link", function()
    setclipboard(Config.Free_Key_Link)
    Window:Notify("Copiado", "Link copiado para a √°rea de transfer√™ncia", 2)
end)

AuthTab:Button("üíé Comprar Premium", "Acesso Vital√≠cio", function()
    setclipboard(Config.Shop_Link)
    Window:Notify("Loja", "Link da loja copiado", 2)
end)

-- [ABA 2] GAME LOADER
local LoaderTab = Window:Tab("Game Loader")

LoaderTab:Paragraph("Jogo Atual", GameName .. "\n(ID: " .. CurrentPlaceId .. ")")

if IsSupported then
    LoaderTab:Label("‚úÖ Jogo Suportado")
    
    LoaderTab:Button("üöÄ INJETAR SCRIPT", "Carregar Hub do Jogo", function()
        if not AuthSystem.IsAuthenticated then
            Window:Notify("Acesso Negado", "Voc√™ precisa verificar a Key na aba anterior.", 3)
            return
        end

        Window:Notify("Loader", "Injetando Script...", 3)
        
        task.spawn(function()
            local scriptUrl = GAMES_MAP[CurrentPlaceId]
            local success, err = pcall(function()
                loadstring(game:HttpGet(scriptUrl))()
            end)
            
            if not success then
                warn("[SlenderHub] Erro ao carregar: " .. tostring(err))
                Window:Notify("Erro", "Falha ao baixar script (Veja F9)", 5)
            end
        end)
    end)
else
    LoaderTab:Label("‚ö† Jogo N√£o Suportado")
    LoaderTab:Paragraph("Aviso", "Este jogo n√£o est√° na lista oficial do SlenderHub.")
end

LoaderTab:Button("üóëÔ∏è Resetar Key Salva", "Limpar dados locais", function()
    if isfile(Config.Folder .. "/" .. Config.File) then
        delfile(Config.Folder .. "/" .. Config.File)
        AuthSystem.IsAuthenticated = false
        Window:Notify("Sistema", "Key removida. Reinicie o script.", 3)
    end
end)

--//==============================[ 4. AUTO-LOGIN ]==============================//--
task.spawn(function()
    local savedData, remaining = AuthSystem.Load()
    if savedData then
        Window:Notify("Bem-vindo", "Auto-Login: " .. AuthSystem.FormatTime(remaining), 5)
        AuthTab:Label("Status: Autenticado (" .. savedData.Type .. ")")
    else
        Window:Notify("Aten√ß√£o", "Por favor, insira sua Key.", 5)
    end
end)

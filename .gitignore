--!strict
-- SlenderHub | Tap Simulator Architecture V60.5
-- Developed by Senior Lead Architect

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- // Singleton Safety //
if getgenv().SlenderHubLoaded then 
    Rayfield:Notify({Title = "System", Content = "SlenderHub is already running.", Duration = 3})
    return 
end
getgenv().SlenderHubLoaded = true

-- // Services //
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer

-- // Advanced Remote Scanner //
-- O jogo usa nomes aleatórios (GUIDs) para pastas de eventos. Vamos encontrar dinamicamente.
local ObfuscatedEventFolder = nil
local ClickRemote = nil

for _, folder in pairs(ReplicatedStorage:GetChildren()) do
    -- Procura por pastas com nomes longos tipo GUID e que tenham uma pasta "Events" dentro
    if folder:IsA("Folder") and string.len(folder.Name) > 20 and folder:FindFirstChild("Events") then
        ObfuscatedEventFolder = folder
        -- O remote de clique geralmente tem nome vazio "" ou nomes genéricos dentro dessa pasta
        ClickRemote = folder.Events:FindFirstChild("") or folder.Events:FindFirstChild("Tap") or folder.Events:FindFirstChild("Click")
        break
    end
end

-- // Network Wrapper (Knit/Modular Bypass) //
local NetworkRemoteEvent = ReplicatedStorage:FindFirstChild("Network", true) 
local NetworkRemoteFunction = ReplicatedStorage:FindFirstChild("Network", true)

-- Fallback search
if not NetworkRemoteEvent then
    for _, v in pairs(ReplicatedStorage:GetDescendants()) do
        if v:IsA("RemoteEvent") and (v.Name == "Network" or v.Name == "RemoteEvent") then
            NetworkRemoteEvent = v
        end
        if v:IsA("RemoteFunction") and (v.Name == "Network" or v.Name == "RemoteFunction") then
            NetworkRemoteFunction = v
        end
    end
end

local function NetworkInvoke(name, ...)
    if NetworkRemoteFunction then
        return NetworkRemoteFunction:InvokeServer(name, ...)
    end
    return nil
end

local function NetworkFire(name, ...)
    if NetworkRemoteEvent then
        NetworkRemoteEvent:FireServer(name, ...)
    end
end

-- // Data Extraction //
local EggList = {}
if Workspace:FindFirstChild("Eggs") then
    for _, v in pairs(Workspace.Eggs:GetChildren()) do
        table.insert(EggList, v.Name)
    end
    table.sort(EggList)
end

-- // Global Flags //
getgenv().Flags = {
    AutoTap = false,
    AutoDig = false,
    AutoHatch = false,
    SelectedEgg = "Basic",
    HatchMode = 1,
    AutoCraftGolden = false,
    AutoCraftDiamond = false, -- Diamond é o equivalente a Rainbow neste jogo
    AutoRebirth = false,
    AutoSpin = false,
    AutoPotions = false
}

-- // UI Construction //
local Window = Rayfield:CreateWindow({
    Name = "SlenderHub | Tap Simulator [V60.5]",
    LoadingTitle = "Bypassing Systems...",
    ConfigurationSaving = {Enabled = true, FileName = "SlenderTapSim_V60_5"},
    KeySystem = false,
})

-- // TABS //
local MainTab = Window:CreateTab("Main", "mouse-pointer-2")
local PetTab = Window:CreateTab("Pets", "egg")
local FarmTab = Window:CreateTab("Farming", "shovel")
local MiscTab = Window:CreateTab("Misc", "settings-2")

-- // MAIN TAB //

MainTab:CreateSection("Clicking")

MainTab:CreateToggle({
    Name = "Auto Tap (Hybrid)",
    CurrentValue = false,
    Flag = "AutoTap",
    Callback = function(Value)
        getgenv().Flags.AutoTap = Value
        if Value then
            task.spawn(function()
                while getgenv().Flags.AutoTap do
                    -- Método 1: Remote Obfuscado (O que você enviou)
                    if ClickRemote then
                        ClickRemote:FireServer(true, false)
                    end
                    
                    -- Método 2: Virtual User (Garante que funcione se o remote mudar)
                    VirtualUser:CaptureController()
                    VirtualUser:ClickButton1(Vector2.new(999, 999))
                    
                    -- Método 3: Network Padrão
                    NetworkFire("Tap")
                    
                    task.wait() -- Velocidade máxima permitida pelo RunService
                end
            end)
        end
    end,
})

MainTab:CreateToggle({
    Name = "Auto Rebirth",
    CurrentValue = false,
    Flag = "AutoRebirth",
    Callback = function(Value)
        getgenv().Flags.AutoRebirth = Value
        if Value then
            task.spawn(function()
                while getgenv().Flags.AutoRebirth do
                    NetworkInvoke("Rebirth", 1)
                    task.wait(0.5)
                end
            end)
        end
    end,
})

-- // PET TAB //

PetTab:CreateSection("Hatching")

PetTab:CreateDropdown({
    Name = "Select Egg",
    Options = EggList,
    CurrentOption = {"Basic"},
    MultipleOptions = false,
    Flag = "SelectedEgg",
    Callback = function(Option)
        getgenv().Flags.SelectedEgg = Option[1]
    end,
})

PetTab:CreateDropdown({
    Name = "Hatch Amount",
    Options = {"1", "3", "8"},
    CurrentOption = {"1"},
    MultipleOptions = false,
    Callback = function(Option)
        getgenv().Flags.HatchMode = tonumber(Option[1])
    end,
})

PetTab:CreateToggle({
    Name = "Auto Hatch (Instant)",
    CurrentValue = false,
    Flag = "AutoHatch",
    Callback = function(Value)
        getgenv().Flags.AutoHatch = Value
        if Value then
            task.spawn(function()
                while getgenv().Flags.AutoHatch do
                    -- Chama o servidor direto, ignorando animação
                    NetworkInvoke("OpenEgg", getgenv().Flags.SelectedEgg, getgenv().Flags.HatchMode, {})
                    task.wait(0.1)
                end
            end)
        end
    end,
})

PetTab:CreateSection("Crafting Automation")

-- Função auxiliar para Crafting
local function CraftPets(tierTarget)
    pcall(function()
        local Replication = require(ReplicatedStorage.Game.Replication)
        local Pets = Replication.Data.Pets
        local Groups = {}

        -- Agrupa pets por Nome e Tier
        for id, petData in pairs(Pets) do
            if not petData.Locked and not petData.Equipped then
                local key = petData.Name .. "_" .. petData.Tier
                if not Groups[key] then Groups[key] = {Tier = petData.Tier, Ids = {}} end
                table.insert(Groups[key].Ids, id)
            end
        end

        -- Verifica se tem o suficiente para craftar
        for _, group in pairs(Groups) do
            -- Lógica: Normal -> Golden
            if tierTarget == "Golden" and group.Tier == "Normal" and #group.Ids >= 5 then
                local batch = {}
                for i = 1, 5 do table.insert(batch, group.Ids[i]) end
                NetworkInvoke("Craft", "Golden", batch)
            end
            
            -- Lógica: Golden -> Diamond (Rainbow)
            -- O módulo 'Crafting' chama de Diamond, mas o usuário conhece como Rainbow
            if tierTarget == "Diamond" and group.Tier == "Golden" and #group.Ids >= 5 then
                local batch = {}
                for i = 1, 5 do table.insert(batch, group.Ids[i]) end
                NetworkInvoke("Craft", "Diamond", batch)
            end
        end
    end)
end

PetTab:CreateToggle({
    Name = "Auto Craft Golden",
    CurrentValue = false,
    Flag = "AutoCraftGolden",
    Callback = function(Value)
        getgenv().Flags.AutoCraftGolden = Value
        if Value then
            task.spawn(function()
                while getgenv().Flags.AutoCraftGolden do
                    CraftPets("Golden")
                    task.wait(1)
                end
            end)
        end
    end,
})

PetTab:CreateToggle({
    Name = "Auto Craft Rainbow (Diamond)",
    CurrentValue = false,
    Flag = "AutoCraftDiamond",
    Callback = function(Value)
        getgenv().Flags.AutoCraftDiamond = Value
        if Value then
            task.spawn(function()
                while getgenv().Flags.AutoCraftDiamond do
                    CraftPets("Diamond")
                    task.wait(1)
                end
            end)
        end
    end,
})

-- // FARMING TAB //

FarmTab:CreateSection("Minigames")

FarmTab:CreateToggle({
    Name = "Auto Dig (Instant Win)",
    CurrentValue = false,
    Flag = "AutoDig",
    Callback = function(Value)
        getgenv().Flags.AutoDig = Value
        if Value then
            task.spawn(function()
                while getgenv().Flags.AutoDig do
                    local start = NetworkInvoke("StartMinigame", "DigGame")
                    if start then
                        task.wait(0.1)
                        NetworkInvoke("FinishMinigame", "DigGame")
                    end
                    task.wait(0.5)
                end
            end)
        end
    end,
})

FarmTab:CreateSection("Items")

FarmTab:CreateToggle({
    Name = "Auto Use Potions",
    CurrentValue = false,
    Flag = "AutoPotions",
    Callback = function(Value)
        getgenv().Flags.AutoPotions = Value
        if Value then
            task.spawn(function()
                while getgenv().Flags.AutoPotions do
                    pcall(function()
                        local Replication = require(ReplicatedStorage.Game.Replication)
                        for name, amount in pairs(Replication.Data.Boosts) do
                            if amount > 0 then
                                NetworkInvoke("UseBoost", name)
                            end
                        end
                    end)
                    task.wait(5) -- Verifica a cada 5s
                end
            end)
        end
    end,
})

-- // MISC TAB //

MiscTab:CreateSection("Gamepasses")

MiscTab:CreateButton({
    Name = "Unlock Gamepasses (Client Visual)",
    Callback = function()
        pcall(function()
            local Replication = require(ReplicatedStorage.Game.Replication)
            local Marketplace = require(ReplicatedStorage.Game.Marketplace)
            
            if Replication.Data then
                if not Replication.Data.Gamepasses then Replication.Data.Gamepasses = {} end
                
                -- Itera sobre todos os gamepasses do módulo Marketplace e ativa
                for gpName, _ in pairs(Marketplace.Gamepasses) do
                    Replication.Data.Gamepasses[gpName] = true
                end
                
                Rayfield:Notify({Title = "Success", Content = "Gamepasses set to TRUE locally.", Duration = 3})
            end
        end)
    end,
})

MiscTab:CreateSection("Rewards")

MiscTab:CreateToggle({
    Name = "Auto Spin Wheels",
    CurrentValue = false,
    Flag = "AutoSpin",
    Callback = function(Value)
        getgenv().Flags.AutoSpin = Value
        if Value then
            task.spawn(function()
                while getgenv().Flags.AutoSpin do
                    NetworkInvoke("SpinWheel", "FestiveSpinWheel")
                    NetworkInvoke("RedeemSpin", "FestiveSpinWheel")
                    NetworkInvoke("SpinWheel", "VoidSpinWheel")
                    NetworkInvoke("RedeemSpin", "VoidSpinWheel")
                    task.wait(5)
                end
            end)
        end
    end,
})

MiscTab:CreateButton({
    Name = "Unlock All Portals",
    Callback = function()
        if Workspace:FindFirstChild("Zones") and Workspace.Zones:FindFirstChild("Portals") then
            for _, portal in pairs(Workspace.Zones.Portals:GetChildren()) do
                NetworkInvoke("BuyPortal", portal.Name)
                task.wait(0.1)
            end
        end
    end,
})

Rayfield:LoadConfiguration()

--========================================================
-- [Roblox Studio Expert] - Remote & Dex Code Dumper
--========================================================
-- Este script foi projetado para facilitar a extração de
-- Remotes (RemoteEvents/RemoteFunctions) e código-fonte
-- de Scripts, LocalScripts e ModuleScripts.
-- Funciona tanto em ambiente exploit quanto no Studio.
--========================================================

local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local StarterGui = game:GetService("StarterGui")

-- Define o local onde a GUI vai ficar (CoreGui se suportado, senão PlayerGui)
local guiParent
if pcall(function() return CoreGui.Name end) then
    guiParent = CoreGui
else
    local player = Players.LocalPlayer
    if player then
        guiParent = player:WaitForChild("PlayerGui")
    else
        guiParent = StarterGui
    end
end

-- Limpa a GUI antiga se existir
if guiParent:FindFirstChild("AgenteRobloxDumper") then
    guiParent.AgenteRobloxDumper:Destroy()
end

--========================================================
-- Função para copiar para o teclado
--========================================================
local function copyToClipboard(text)
    if setclipboard then
        setclipboard(text)
    else
        -- Fallback: Imprime no console (F9) ou Output
        warn("=[ COPIADO DEVIDO A FALTA DE SETCLIPBOARD ]=")
        print(text)
        warn("==============================================")
    end
end

--========================================================
-- Função para obter o caminho absoluto de um objeto
--========================================================
local function getObjectPath(obj)
    local path = obj.Name
    if not string.match(path, "^[%w_]+$") then
        path = '["' .. path .. '"]'
    end

    local currentObj = obj.Parent
    while currentObj and currentObj ~= game do
        local parentName = currentObj.Name
        if not string.match(parentName, "^[%w_]+$") then
            parentName = '["' .. parentName .. '"]'
        end
        path = parentName .. "." .. path
        currentObj = currentObj.Parent
    end
    return "game." .. path
end

--========================================================
-- Interface Gráfica (GUI)
--========================================================
local mainGui = Instance.new("ScreenGui")
mainGui.Name = "AgenteRobloxDumper"
mainGui.ResetOnSpawn = false
mainGui.Parent = guiParent

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 400, 0, 500)
mainFrame.Position = UDim2.new(0.5, -200, 0.5, -250)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = mainGui

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, 0, 0, 40)
titleLabel.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
titleLabel.TextColor3 = Color3.fromRGB(0, 200, 255)
titleLabel.Text = " Agente Roblox - Remote & Script Dumper"
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextSize = 16
titleLabel.BorderSizePixel = 0
titleLabel.Parent = mainFrame
titleLabel.TextXAlignment = Enum.TextXAlignment.Left

-- Adiciona botão de fechar
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0, 5)
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
closeBtn.BorderSizePixel = 0
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 14
closeBtn.Parent = titleLabel

closeBtn.MouseButton1Click:Connect(function()
    mainGui:Destroy()
end)

local scrollingFrame = Instance.new("ScrollingFrame")
scrollingFrame.Size = UDim2.new(1, -20, 1, -60)
scrollingFrame.Position = UDim2.new(0, 10, 0, 50)
scrollingFrame.BackgroundTransparency = 1
scrollingFrame.ScrollBarThickness = 6
scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollingFrame.UIListLayout = Instance.new("UIListLayout")
scrollingFrame.UIListLayout.Padding = UDim.new(0, 5)
scrollingFrame.UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
scrollingFrame.Parent = mainFrame

local function createCard(name, details, copyData, color)
    local card = Instance.new("Frame")
    card.Size = UDim2.new(1, -10, 0, 45)
    card.BackgroundColor3 = color
    card.BorderSizePixel = 0
    card.Parent = scrollingFrame

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, -80, 0, 25)
    nameLabel.Position = UDim2.new(0, 5, 0, 2)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = name
    nameLabel.TextColor3 = Color3.fromRGB(240, 240, 240)
    nameLabel.Font = Enum.Font.GothamSemibold
    nameLabel.TextSize = 14
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.TextTruncate = Enum.TextTruncate.AtEnd
    nameLabel.Parent = card

    local detailsLabel = Instance.new("TextLabel")
    detailsLabel.Size = UDim2.new(1, -80, 0, 15)
    detailsLabel.Position = UDim2.new(0, 5, 0, 25)
    detailsLabel.BackgroundTransparency = 1
    detailsLabel.Text = details
    detailsLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    detailsLabel.Font = Enum.Font.Gotham
    detailsLabel.TextSize = 11
    detailsLabel.TextXAlignment = Enum.TextXAlignment.Left
    detailsLabel.TextTruncate = Enum.TextTruncate.AtEnd
    detailsLabel.Parent = card

    local copyBtn = Instance.new("TextButton")
    copyBtn.Size = UDim2.new(0, 70, 0, 35)
    copyBtn.Position = UDim2.new(1, -75, 0, 5)
    copyBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    copyBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    copyBtn.Text = "Copiar"
    copyBtn.Font = Enum.Font.GothamBold
    copyBtn.TextSize = 12
    copyBtn.Parent = card

    copyBtn.MouseButton1Click:Connect(function()
        copyToClipboard(copyData)
        copyBtn.Text = "Copiado!"
        copyBtn.BackgroundColor3 = Color3.fromRGB(40, 180, 80)
        task.wait(1.5)
        copyBtn.Text = "Copiar"
        copyBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    end)
    
    scrollingFrame.CanvasSize = UDim2.new(0, 0, 0, #scrollingFrame:GetChildren() * 50)
end

--========================================================
-- Coletando dados (Remotes)
--========================================================
local function loadRemotes()
    for _, obj in pairs(game:GetDescendants()) do
        if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
            local path = getObjectPath(obj)
            local isEvent = obj:IsA("RemoteEvent")
            
            local copyTemplate = string.format(
                "-- [%s] Obtenção do Remote\nlocal %s = %s\n\n-- Como usar:\n%s",
                obj.ClassName,
                obj.Name,
                path,
                isEvent and string.format("%s:FireServer(args)", obj.Name) or string.format("local result = %s:InvokeServer(args)", obj.Name)
            )
            
            createCard(
                "[Remote] " .. obj.Name, 
                "Caminho: " .. path, 
                copyTemplate, 
                isEvent and Color3.fromRGB(40, 40, 60) or Color3.fromRGB(60, 40, 60)
            )
        end
    end
end

--========================================================
-- Coletando dados (Scripts Dex)
--========================================================
local function loadScripts()
    for _, obj in pairs(game:GetDescendants()) do
        if obj:IsA("LocalScript") or obj:IsA("ModuleScript") then
            pcall(function()
                local sourceStr = ""
                -- Exploits tem 'decompile', no Studio tem .Source
                if typeof(decompile) == "function" then
                    sourceStr = decompile(obj)
                elseif obj.Source then
                    sourceStr = obj.Source
                end
                
                if sourceStr and string.len(sourceStr) > 0 then
                    local path = getObjectPath(obj)
                    local copyTemplate = string.format(
                        "-- [DEX] Fonte do Script %s (%s)\n-- Caminho: %s\n\n%s",
                        obj.Name, obj.ClassName, path, sourceStr
                    )
                    
                    createCard(
                        "[Script] " .. obj.Name,
                        "Tipo: " .. obj.ClassName,
                        copyTemplate,
                        obj:IsA("ModuleScript") and Color3.fromRGB(40, 60, 40) or Color3.fromRGB(60, 60, 40)
                    )
                end
            end)
        end
    end
end

--========================================================
-- Inicialização
--========================================================
loadRemotes()
loadScripts()

print("[Agente Roblox] Script carregado com sucesso. A UI deve aparecer na tela.")

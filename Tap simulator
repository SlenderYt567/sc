--[[
    SlenderHub | V2.3 - Tap Simulator (Premium + Fixed Crafting)
    Architect: Senior Lead Developer
    Framework: Rayfield Interface Suite
    
    [CHANGELOG]:
    - Restored Premium Tab (God Mode, Nuclear Hatch)
    - Fixed Auto Craft (Golden/Rainbow/Void/Diamond/Galaxy)
    - Full Egg List
]]

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- // 1. SYSTEM CHECK \\ --
-- Mude para "Premium" abaixo se quiser liberar tudo direto
local AccessLevel = getgenv().SlenderHubAccessLevel or "Free" 
local IsPremium = (AccessLevel == "Premium")

-- // 2. CORE SERVICES \\ --
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CollectionService = game:GetService("CollectionService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local LocalPlayer = Players.LocalPlayer

-- // 3. SECURITY BYPASS \\ --
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    if getnamecallmethod() == "FireServer" and self.Name == "GameAnalyticsError" then return nil end
    return oldNamecall(self, ...)
end)

-- // 4. MODULE INJECTION & DATA \\ --
local M = {}
local AllEggs = {
    "Basic", "Acorn", "Safari", "Forest", "Snowman", "Cactus", "Poison", 
    "Holy", "Sakura", "Elemental", "Magma", "Candy", "Atlantis", "Space", 
    "Moonflower", "Starry", "Cryo", "Infernal", "Divine",
    "5M Event", "Christmas Event", "New Years Event", "Void Event",
    "Chronos Egg", "Evil Xmas Egg", "Cyborg Egg",
    "Volcanic", "Frozen", "Temple", "Tropical", "Angelic", "Samurai"
}
local DataCache = { Eggs = AllEggs, Portals = {}, Upgrades = {} }

local function InjectModules()
    local s, e = pcall(function()
        M.Net = require(ReplicatedStorage.Modules.Network)
        M.Rep = require(ReplicatedStorage.Game.Replication)
        pcall(function() M.Eggs = require(ReplicatedStorage.Game.Eggs) end)
        pcall(function() M.Portals = require(ReplicatedStorage.Game.Portals) end)
        pcall(function() M.GemShop = require(ReplicatedStorage.Game.GemShop) end)
        
        if M.Portals then
            for n,_ in pairs(M.Portals) do table.insert(DataCache.Portals, n) end
            table.sort(DataCache.Portals)
        end
        if M.GemShop then
            for n,v in pairs(M.GemShop) do if not v.Hidden then table.insert(DataCache.Upgrades, n) end end
            table.sort(DataCache.Upgrades)
        end
    end)
    if not s then warn("SlenderHub: Module Injection Failed") end
end
InjectModules()

-- // 5. HELPER FUNCTIONS \\ --
local function UnlockGamepasses()
    if M.Rep and M.Rep.Data then
        local GP = M.Rep.Data.Gamepasses or {}
        GP["x3Egg"] = true; GP["x8Egg"] = true; GP["FasterEgg"] = true
        GP["AutoClicker"] = true; GP["Luck"] = true
        M.Rep.Data.Gamepasses = GP
    end
end
task.spawn(UnlockGamepasses)

-- // 6. GLOBAL FLAGS \\ --
getgenv().Flags = {
    -- Free Flags
    AutoTap = false, AutoRebirth = false, RebirthAmt = 1,
    AutoHatch = false, Egg = "Basic", HatchAmt = 1,
    AutoDig = false, AutoBoss = false,
    AutoQuests = false, AutoRank = false, AutoSpin = false,
    AutoUpgrade = false, SelectedUpgrade = "",
    Sniper = false, AutoPotions = false,
    DeleteFilter = {["Common"]=false, ["Uncommon"]=false, ["Rare"]=false},
    AutoCraft = false,
    
    -- Premium Flags
    GodTap = false, NuclearHatch = false
}

-- // 7. UI CONSTRUCTION \\ --
local Window = Rayfield:CreateWindow({
   Name = "SlenderHub | V2.3 [" .. AccessLevel .. "]",
   LoadingTitle = "Initializing Premium Core...",
   LoadingSubtitle = "Tap Simulator",
   ConfigurationSaving = { Enabled = true, FileName = "SlenderTapV2" },
   KeySystem = false,
})

-- ==================================================================
-- [TAB] ðŸ‘‘ PREMIUM (RESTORED)
-- ==================================================================
local TabPrem = Window:CreateTab("Premium", "crown")

if IsPremium then
    TabPrem:CreateSection("GOD MODE (Packet Spam)")
    
    TabPrem:CreateToggle({
        Name = "GOD TAP (50x Speed)",
        CurrentValue = false,
        Flag = "GodTap",
        Callback = function(V)
            getgenv().Flags.GodTap = V
            if V then
                task.spawn(function()
                    local Con
                    Con = RunService.Heartbeat:Connect(function()
                        if not getgenv().Flags.GodTap then Con:Disconnect() return end
                        -- Extreme Speed: 50 requests per frame
                        for i = 1, 50 do 
                            M.Net:FireServer("Tap", true, false, true) 
                        end
                    end)
                end)
            end
        end
    })

    TabPrem:CreateToggle({
        Name = "NUCLEAR HATCH (Multi-Thread)",
        CurrentValue = false,
        Flag = "NuclearHatch",
        Callback = function(V)
            getgenv().Flags.NuclearHatch = V
            if V then
                -- Launches 4 parallel threads to spam hatch requests
                for i=1, 4 do
                    task.spawn(function()
                        while getgenv().Flags.NuclearHatch do
                            local filter = {}
                            for r, on in pairs(getgenv().Flags.DeleteFilter) do if on then filter[r]=true end end
                            M.Net:InvokeServer("OpenEgg", getgenv().Flags.Egg, getgenv().Flags.HatchAmt, filter)
                            task.wait() -- Minimal wait
                        end
                    end)
                end
            end
        end
    })

    TabPrem:CreateSection("INSTANT ACTIONS")

    TabPrem:CreateButton({
        Name = "âš¡ Instant Craft Inventory",
        Callback = function()
            if M.Rep.Data and M.Rep.Data.Pets then
                local groups = {}
                for id, p in pairs(M.Rep.Data.Pets) do
                    local k = p.Name .. (p.Tier or "Normal")
                    if not groups[k] then groups[k] = {} end
                    table.insert(groups[k], id)
                end
                for _, ids in pairs(groups) do
                    while #ids >= 5 do
                        local batch = {table.remove(ids), table.remove(ids), table.remove(ids), table.remove(ids), table.remove(ids)}
                        task.spawn(function() M.Net:InvokeServer("CraftPets", batch) end)
                    end
                end
                Rayfield:Notify({Title="Premium", Content="Mass Craft Sent!", Duration=2})
            end
        end
    })

    TabPrem:CreateButton({
        Name = "ðŸ’Ž Force Buy All Portals",
        Callback = function()
            for _, pName in ipairs(DataCache.Portals) do
                task.spawn(function() M.Net:InvokeServer("BuyPortal", pName) end)
            end
            Rayfield:Notify({Title="Premium", Content="Buy Requests Sent!", Duration=2})
        end
    })

else
    TabPrem:CreateParagraph({Title = "Access Denied", Content = "Upgrade to Premium Key to unlock:\n\nâ€¢ GOD TAP (50x Faster)\nâ€¢ NUCLEAR HATCH (No Animation/Delay)\nâ€¢ INSTANT CRAFT (Whole Inventory)\nâ€¢ FORCE UNLOCK ALL"})
    TabPrem:CreateButton({
        Name = "Get Premium Key",
        Callback = function()
            setclipboard("https://www.slenderhub.shop/")
            Rayfield:Notify({Title="Link Copied", Content="Visit our shop!", Duration=3})
        end
    })
end

-- ==================================================================
-- [TAB] FARM
-- ==================================================================
local TabFarm = Window:CreateTab("Farm", "sword")

TabFarm:CreateSection("Main Loop")

TabFarm:CreateToggle({
   Name = "Auto Tap (Normal)",
   CurrentValue = false,
   Flag = "AutoTap", 
   Callback = function(V)
        getgenv().Flags.AutoTap = V
        if V then
            task.spawn(function()
                while getgenv().Flags.AutoTap do
                    -- Only run if GodTap is OFF to avoid conflict
                    if not getgenv().Flags.GodTap then
                        for i=1, 5 do M.Net:FireServer("Tap", true, false, true) end
                    end
                    task.wait(0.1)
                end
            end)
        end
   end,
})

TabFarm:CreateToggle({
   Name = "Auto Rebirth",
   CurrentValue = false,
   Flag = "AutoRebirth", 
   Callback = function(V)
        getgenv().Flags.AutoRebirth = V
        task.spawn(function()
            while getgenv().Flags.AutoRebirth do
                M.Net:InvokeServer("Rebirth", 1, getgenv().Flags.RebirthAmt)
                task.wait(0.5)
            end
        end)
   end,
})

TabFarm:CreateSection("Minigames")

TabFarm:CreateToggle({
   Name = "Auto Dig",
   CurrentValue = false,
   Flag = "AutoDig", 
   Callback = function(V)
        getgenv().Flags.AutoDig = V
        task.spawn(function()
            while getgenv().Flags.AutoDig do
                pcall(function() M.Net:InvokeServer("StartMinigame", "DigGame") end)
                task.wait(0.5)
                pcall(function() M.Net:InvokeServer("FinishMinigame", "DigGame") end)
                task.wait(1)
            end
        end)
   end,
})

-- ==================================================================
-- [TAB] PETS (UPDATED CRAFTING)
-- ==================================================================
local TabPets = Window:CreateTab("Pets", "cat")

TabPets:CreateSection("Hatching")

TabPets:CreateDropdown({
   Name = "Select Egg",
   Options = DataCache.Eggs,
   CurrentOption = {"Basic"},
   Callback = function(O) getgenv().Flags.Egg = O[1] end,
})

TabPets:CreateDropdown({
   Name = "Hatch Mode",
   Options = {"1", "3", "8"},
   CurrentOption = {"1"},
   Callback = function(O) 
       getgenv().Flags.HatchAmt = tonumber(O[1])
       UnlockGamepasses()
   end,
})

TabPets:CreateToggle({
   Name = "Auto Hatch (Normal)",
   CurrentValue = false,
   Flag = "AutoHatch", 
   Callback = function(V)
        getgenv().Flags.AutoHatch = V
        if V then
            task.spawn(function()
                while getgenv().Flags.AutoHatch do
                    if not getgenv().Flags.NuclearHatch then
                        local filter = {}
                        for r, on in pairs(getgenv().Flags.DeleteFilter) do if on then filter[r]=true end end
                        M.Net:InvokeServer("OpenEgg", getgenv().Flags.Egg, getgenv().Flags.HatchAmt, filter)
                    end
                    task.wait(getgenv().Flags.HatchAmt == 8 and 0.3 or 0.1)
                end
            end)
        end
   end,
})

TabPets:CreateSection("Auto Delete")
for _, r in ipairs({"Common", "Uncommon", "Rare", "Epic", "Legendary"}) do
    TabPets:CreateToggle({
        Name = "Delete " .. r,
        CurrentValue = false,
        Callback = function(V) getgenv().Flags.DeleteFilter[r] = V end
    })
end

TabPets:CreateSection("Universal Crafting (Optimized)")

TabPets:CreateToggle({
    Name = "Auto Craft (Gold/Rainbow/Void)",
    CurrentValue = false,
    Flag = "AutoCraft",
    Callback = function(V)
        getgenv().Flags.AutoCraft = V
        
        -- LISTA EXPANDIDA COM NOMES DESCOBERTOS NO MÃ“DULO PETSTATS
        local RainbowRemotes = {"StartRainbow", "CraftRainbow", "RainbowMachine", "CraftDiamond", "StartDiamond"}
        local VoidRemotes = {"StartVoid", "CraftVoid", "VoidMachine", "CraftGalaxy", "StartGalaxy"}
        
        task.spawn(function()
            while getgenv().Flags.AutoCraft do
                if M.Rep.Data and M.Rep.Data.Pets then
                    
                    local function FireBruteForce(remoteList, batchIDs)
                        for _, name in ipairs(remoteList) do
                            task.spawn(function()
                                pcall(function() M.Net:InvokeServer(name, batchIDs) end)
                            end)
                        end
                    end

                    -- 1. AUTO GOLDEN (5 Pets -> 1 Golden)
                    local goldenGroups = {}
                    for id, p in pairs(M.Rep.Data.Pets) do
                        if (p.Tier == "Normal" or p.Tier == nil) and not p.Locked and not p.Equipped then
                            if not goldenGroups[p.Name] then goldenGroups[p.Name] = {} end
                            table.insert(goldenGroups[p.Name], id)
                        end
                    end
                    
                    for _, ids in pairs(goldenGroups) do
                        while #ids >= 5 do
                            local batch = {table.remove(ids), table.remove(ids), table.remove(ids), table.remove(ids), table.remove(ids)}
                            pcall(function() M.Net:InvokeServer("CraftPets", batch) end)
                            task.wait(0.05)
                        end
                    end

                    -- 2. AUTO RAINBOW (3 Pets -> 1 Rainbow)
                    local rainbowGroups = {}
                    for id, p in pairs(M.Rep.Data.Pets) do
                        if p.Tier == "Golden" and not p.Locked and not p.Equipped then
                            if not rainbowGroups[p.Name] then rainbowGroups[p.Name] = {} end
                            table.insert(rainbowGroups[p.Name], id)
                        end
                    end

                    for _, ids in pairs(rainbowGroups) do
                        while #ids >= 3 do
                            local batch = {table.remove(ids), table.remove(ids), table.remove(ids)}
                            FireBruteForce(RainbowRemotes, batch)
                            task.wait(0.1)
                        end
                    end

                    -- 3. AUTO VOID (3 Pets -> 1 Void)
                    local voidGroups = {}
                    for id, p in pairs(M.Rep.Data.Pets) do
                        if (p.Tier == "Rainbow" or p.Tier == "Diamond") and not p.Locked and not p.Equipped then
                            if not voidGroups[p.Name] then voidGroups[p.Name] = {} end
                            table.insert(voidGroups[p.Name], id)
                        end
                    end

                    for _, ids in pairs(voidGroups) do
                        while #ids >= 3 do
                            local batch = {table.remove(ids), table.remove(ids), table.remove(ids)}
                            FireBruteForce(VoidRemotes, batch)
                            task.wait(0.1)
                        end
                    end
                    
                end
                task.wait(2)
            end
        end)
    end
})

-- ==================================================================
-- [TAB] WORLD
-- ==================================================================
local TabWorld = Window:CreateTab("World", "globe")

TabWorld:CreateSection("Teleports")
for _, p in ipairs(DataCache.Portals) do
    TabWorld:CreateButton({
        Name = "TP to " .. p,
        Callback = function()
            M.Net:InvokeServer("TeleportZone", p)
        end
    })
end

TabWorld:CreateSection("Automation")

TabWorld:CreateToggle({
   Name = "Infinity Chest Sniper",
   CurrentValue = false,
   Flag = "Sniper", 
   Callback = function(V)
        getgenv().Flags.Sniper = V
        task.spawn(function()
            while getgenv().Flags.Sniper do
                local target
                for _, o in ipairs(CollectionService:GetTagged("Breakable")) do
                    if o.Name == "InfinityChest" and o:FindFirstChild("ClickDetector") then target = o break end
                end
                if target then
                    LocalPlayer.Character:PivotTo(target:GetPivot())
                    fireclickdetector(target.ClickDetector)
                end
                task.wait(0.5)
            end
        end)
   end,
})

TabWorld:CreateToggle({
    Name = "Auto Use Potions",
    CurrentValue = false,
    Flag = "AutoPotions",
    Callback = function(V)
        getgenv().Flags.AutoPotions = V
        task.spawn(function()
            while getgenv().Flags.AutoPotions do
                if M.Rep.Data and M.Rep.Data.Items then
                    for id, item in pairs(M.Rep.Data.Items) do
                        if string.find(item.Name or "", "Potion") or string.find(item.Name or "", "Boost") then
                            M.Net:InvokeServer("UseItem", id)
                        end
                    end
                end
                task.wait(5)
            end
        end)
    end
})

Rayfield:LoadConfiguration()

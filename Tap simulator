--[[
    SlenderHub | V2.9 - Tap Simulator (Dynamic Egg Loader)
    Architect: Senior Lead Developer
    Framework: Rayfield Interface Suite
    
    [CHANGELOG]:
    - Added Dynamic Egg Scraper (Loads ALL game eggs automatically)
    - Confirmed "Void Event" support
    - Auto Void Spin included
    - Fixed Void Crafting (Instant)
]]

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- // 1. SYSTEM CHECK \\ --
if getgenv().SlenderHubLoaded then 
    Rayfield:Notify({Title="System", Content="Script jÃ¡ estÃ¡ rodando!", Duration=3})
    return 
end
getgenv().SlenderHubLoaded = true

local AccessLevel = getgenv().SlenderHubAccessLevel or "Free" 
local IsPremium = (AccessLevel == "Premium")

-- // 2. CORE SERVICES \\ --
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- // 3. SECURITY BYPASS \\ --
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    if getnamecallmethod() == "FireServer" and self.Name == "GameAnalyticsError" then return nil end
    return oldNamecall(self, ...)
end)

-- // 4. MODULE INJECTION & DATA \\ --
local M = {}
-- Lista de backup caso o scraper falhe
local BackupEggs = {
    "Basic", "Void Event", "5M Event", "Christmas Event", "New Years Event", 
    "Chronos Egg", "Evil Xmas Egg", "Cyborg Egg", "Volcanic", "Frozen", 
    "Temple", "Tropical", "Angelic", "Samurai", "Void"
}
local DataCache = { Eggs = BackupEggs, Portals = {} }

local function InjectModules()
    local s, e = pcall(function()
        M.Net = require(ReplicatedStorage.Modules.Network)
        M.Rep = require(ReplicatedStorage.Game.Replication)
        pcall(function() M.Eggs = require(ReplicatedStorage.Game.Eggs) end)
        pcall(function() M.Portals = require(ReplicatedStorage.Game.Portals) end)
        
        -- [ARCHITECT UPDATE] Dynamic Egg Scraper
        if M.Eggs then
            local foundEggs = {}
            for eggName, _ in pairs(M.Eggs) do
                table.insert(foundEggs, eggName)
            end
            table.sort(foundEggs) -- Organiza alfabeticamente
            DataCache.Eggs = foundEggs
            print("SlenderHub: " .. #foundEggs .. " eggs loaded dynamically.")
        end

        if M.Portals then
            for n,_ in pairs(M.Portals) do table.insert(DataCache.Portals, n) end
            table.sort(DataCache.Portals)
        end
    end)
    if not s then warn("SlenderHub: Module Injection Failed") end
end
InjectModules()

-- // 5. HELPER FUNCTIONS \\ --
local function UnlockGamepasses()
    if M.Rep and M.Rep.Data then
        local GP = M.Rep.Data.Gamepasses or {}
        GP["x3Egg"] = true; GP["x8Egg"] = true; GP["FasterEgg"] = true
        GP["AutoClicker"] = true; GP["Luck"] = true
        M.Rep.Data.Gamepasses = GP
    end
end
task.spawn(UnlockGamepasses)

-- // 6. GLOBAL FLAGS \\ --
getgenv().Flags = {
    AutoTap = false, AutoRebirth = false, RebirthAmt = 1,
    AutoHatch = false, Egg = "Basic", HatchAmt = 1,
    AutoDig = false, AutoVoidSpin = false,
    AutoGolden = false, AutoRainbow = false, AutoVoid = false,
    Sniper = false, AutoPotions = false,
    DeleteFilter = {["Common"]=false, ["Uncommon"]=false, ["Rare"]=false},
    GodTap = false, NuclearHatch = false
}

-- // 7. UI CONSTRUCTION \\ --
local Window = Rayfield:CreateWindow({
   Name = "SlenderHub | V2.9 [" .. AccessLevel .. "]",
   LoadingTitle = "Loading Dynamic Assets...",
   LoadingSubtitle = "Tap Simulator",
   ConfigurationSaving = { Enabled = true, FileName = "SlenderTapV29" },
   KeySystem = false,
})

-- ==================================================================
-- [TAB] ðŸ‘‘ PREMIUM
-- ==================================================================
local TabPrem = Window:CreateTab("Premium", "crown")

if IsPremium then
    TabPrem:CreateSection("GOD MODE")
    
    TabPrem:CreateToggle({
        Name = "GOD TAP (Safe Mode)",
        CurrentValue = false,
        Flag = "GodTap",
        Callback = function(V)
            getgenv().Flags.GodTap = V
            if V then
                task.spawn(function()
                    while getgenv().Flags.GodTap do
                        for i = 1, 20 do 
                            M.Net:FireServer("Tap", true, false, true) 
                        end
                        task.wait(0.05)
                    end
                end)
            end
        end
    })

    TabPrem:CreateToggle({
        Name = "NUCLEAR HATCH (Fast)",
        CurrentValue = false,
        Flag = "NuclearHatch",
        Callback = function(V)
            getgenv().Flags.NuclearHatch = V
            if V then
                for i=1, 3 do 
                    task.spawn(function()
                        while getgenv().Flags.NuclearHatch do
                            local filter = {}
                            for r, on in pairs(getgenv().Flags.DeleteFilter) do if on then filter[r]=true end end
                            M.Net:InvokeServer("OpenEgg", getgenv().Flags.Egg, getgenv().Flags.HatchAmt, filter)
                            task.wait()
                        end
                    end)
                end
            end
        end
    })
else
    TabPrem:CreateParagraph({Title = "Access Denied", Content = "Upgrade to Premium for GOD TAP & NUCLEAR HATCH."})
end

-- ==================================================================
-- [TAB] FARM
-- ==================================================================
local TabFarm = Window:CreateTab("Farm", "sword")

TabFarm:CreateSection("Main Loop")

TabFarm:CreateToggle({
   Name = "Auto Tap (Normal)",
   CurrentValue = false,
   Flag = "AutoTap", 
   Callback = function(V)
        getgenv().Flags.AutoTap = V
        if V then
            task.spawn(function()
                while getgenv().Flags.AutoTap do
                    if not getgenv().Flags.GodTap then
                        for i=1, 5 do M.Net:FireServer("Tap", true, false, true) end
                    end
                    task.wait(0.1)
                end
            end)
        end
   end,
})

TabFarm:CreateToggle({
   Name = "Auto Rebirth",
   CurrentValue = false,
   Flag = "AutoRebirth", 
   Callback = function(V)
        getgenv().Flags.AutoRebirth = V
        task.spawn(function()
            while getgenv().Flags.AutoRebirth do
                M.Net:InvokeServer("Rebirth", 1, getgenv().Flags.RebirthAmt)
                task.wait(0.5)
            end
        end)
   end,
})

TabFarm:CreateSection("Minigames & Events")

TabFarm:CreateToggle({
   Name = "Auto Dig (Instant Win)",
   CurrentValue = false,
   Flag = "AutoDig", 
   Callback = function(V)
        getgenv().Flags.AutoDig = V
        task.spawn(function()
            while getgenv().Flags.AutoDig do
                pcall(function() 
                    M.Net:InvokeServer("StartMinigame", "DigGame") 
                    task.wait(0.2)
                    M.Net:InvokeServer("FinishMinigame", "DigGame")
                end)
                task.wait(1)
            end
        end)
   end,
})

TabFarm:CreateToggle({
   Name = "Auto Void Spin",
   CurrentValue = false,
   Flag = "AutoVoidSpin", 
   Callback = function(V)
        getgenv().Flags.AutoVoidSpin = V
        task.spawn(function()
            while getgenv().Flags.AutoVoidSpin do
                pcall(function() 
                    M.Net:InvokeServer("VoidSpinWheel") 
                end)
                task.wait(2)
            end
        end)
   end,
})

-- ==================================================================
-- [TAB] PETS & CRAFTING
-- ==================================================================
local TabPets = Window:CreateTab("Pets", "cat")

TabPets:CreateSection("Hatching")

TabPets:CreateDropdown({
   Name = "Select Egg",
   Options = DataCache.Eggs,
   CurrentOption = {"Basic"},
   Callback = function(O) getgenv().Flags.Egg = O[1] end,
})

TabPets:CreateDropdown({
   Name = "Hatch Mode",
   Options = {"1", "3", "8"},
   CurrentOption = {"1"},
   Callback = function(O) 
       getgenv().Flags.HatchAmt = tonumber(O[1])
       UnlockGamepasses()
   end,
})

TabPets:CreateToggle({
   Name = "Auto Hatch",
   CurrentValue = false,
   Flag = "AutoHatch", 
   Callback = function(V)
        getgenv().Flags.AutoHatch = V
        if V then
            task.spawn(function()
                while getgenv().Flags.AutoHatch do
                    if not getgenv().Flags.NuclearHatch then
                        local filter = {}
                        for r, on in pairs(getgenv().Flags.DeleteFilter) do if on then filter[r]=true end end
                        M.Net:InvokeServer("OpenEgg", getgenv().Flags.Egg, getgenv().Flags.HatchAmt, filter)
                    end
                    task.wait(getgenv().Flags.HatchAmt == 8 and 0.3 or 0.1)
                end
            end)
        end
   end,
})

TabPets:CreateSection("Smart Crafting")

-- AUTO GOLDEN (Instant - 5 Pets)
TabPets:CreateToggle({
    Name = "Auto Craft Golden (Instant)",
    CurrentValue = false,
    Flag = "AutoGolden",
    Callback = function(V)
        getgenv().Flags.AutoGolden = V
        task.spawn(function()
            while getgenv().Flags.AutoGolden do
                if M.Rep.Data and M.Rep.Data.Pets then
                    local groups = {}
                    for id, p in pairs(M.Rep.Data.Pets) do
                        if (p.Tier == "Normal" or p.Tier == nil) and not p.Locked and not p.Equipped then
                            if not groups[p.Name] then groups[p.Name] = {} end
                            table.insert(groups[p.Name], id)
                        end
                    end
                    for _, ids in pairs(groups) do
                        while #ids >= 5 do
                            local batch = {table.remove(ids), table.remove(ids), table.remove(ids), table.remove(ids), table.remove(ids)}
                            pcall(function() M.Net:InvokeServer("CraftPets", batch) end)
                            task.wait(0.05)
                        end
                    end
                end
                task.wait(1)
            end
        end)
    end
})

-- AUTO RAINBOW (Machine - 5 Pets for Speed)
TabPets:CreateToggle({
    Name = "Auto Craft Rainbow (Machine)",
    CurrentValue = false,
    Flag = "AutoRainbow",
    Callback = function(V)
        getgenv().Flags.AutoRainbow = V
        task.spawn(function()
            while getgenv().Flags.AutoRainbow do
                -- 1. Auto Claim
                if M.Rep.Data.CraftingPets and M.Rep.Data.CraftingPets.Rainbow then
                    for id, data in pairs(M.Rep.Data.CraftingPets.Rainbow) do
                        if data.EndTime <= Workspace:GetServerTimeNow() then
                            M.Net:InvokeServer("ClaimRainbow", id)
                        end
                    end
                end

                -- 2. Verificar Slots
                local activeCrafts = 0
                if M.Rep.Data.CraftingPets and M.Rep.Data.CraftingPets.Rainbow then
                    for _ in pairs(M.Rep.Data.CraftingPets.Rainbow) do activeCrafts = activeCrafts + 1 end
                end

                -- 3. Iniciar Craft
                if activeCrafts < 3 and M.Rep.Data and M.Rep.Data.Pets then
                    local groups = {}
                    for id, p in pairs(M.Rep.Data.Pets) do
                        if p.Tier == "Golden" and not p.Locked and not p.Equipped then
                            if not groups[p.Name] then groups[p.Name] = {} end
                            table.insert(groups[p.Name], id)
                        end
                    end
                    for _, ids in pairs(groups) do
                        if activeCrafts >= 3 then break end
                        if #ids >= 5 then
                            local batch = {ids[1], ids[2], ids[3], ids[4], ids[5]}
                            local s, e = pcall(function() M.Net:InvokeServer("StartRainbow", batch) end)
                            if s then activeCrafts = activeCrafts + 1; task.wait(0.5) end
                        end
                    end
                end
                task.wait(2)
            end
        end)
    end
})

-- AUTO VOID (Instant - 3 Pets)
TabPets:CreateToggle({
    Name = "Auto Craft Void (Instant)",
    CurrentValue = false,
    Flag = "AutoVoid",
    Callback = function(V)
        getgenv().Flags.AutoVoid = V
        task.spawn(function()
            while getgenv().Flags.AutoVoid do
                if M.Rep.Data and M.Rep.Data.Pets then
                    local groups = {}
                    for id, p in pairs(M.Rep.Data.Pets) do
                        if p.Tier == "Rainbow" and not p.Locked and not p.Equipped then
                            if not groups[p.Name] then groups[p.Name] = {} end
                            table.insert(groups[p.Name], id)
                        end
                    end
                    for _, ids in pairs(groups) do
                        while #ids >= 3 do
                            local batch = {table.remove(ids), table.remove(ids), table.remove(ids)}
                            pcall(function() M.Net:InvokeServer("StartVoid", batch) end) 
                            pcall(function() M.Net:InvokeServer("CraftVoid", batch) end)
                            task.wait(0.1)
                        end
                    end
                end
                task.wait(1)
            end
        end)
    end
})

-- ==================================================================
-- [TAB] WORLD
-- ==================================================================
local TabWorld = Window:CreateTab("World", "globe")

TabWorld:CreateSection("Teleports")
for _, p in ipairs(DataCache.Portals) do
    TabWorld:CreateButton({
        Name = "TP to " .. p,
        Callback = function()
            M.Net:InvokeServer("TeleportZone", p)
        end
    })
end

TabWorld:CreateSection("Automation")

TabWorld:CreateToggle({
   Name = "Infinity Chest Sniper",
   CurrentValue = false,
   Flag = "Sniper", 
   Callback = function(V)
        getgenv().Flags.Sniper = V
        task.spawn(function()
            while getgenv().Flags.Sniper do
                local target
                for _, o in ipairs(CollectionService:GetTagged("Breakable")) do
                    if o.Name == "InfinityChest" and o:FindFirstChild("ClickDetector") then target = o break end
                end
                if target then
                    LocalPlayer.Character:PivotTo(target:GetPivot())
                    fireclickdetector(target.ClickDetector)
                end
                task.wait(0.5)
            end
        end)
   end,
})

TabWorld:CreateToggle({
    Name = "Auto Use Potions",
    CurrentValue = false,
    Flag = "AutoPotions",
    Callback = function(V)
        getgenv().Flags.AutoPotions = V
        task.spawn(function()
            while getgenv().Flags.AutoPotions do
                if M.Rep.Data and M.Rep.Data.Items then
                    for id, item in pairs(M.Rep.Data.Items) do
                        if string.find(item.Name or "", "Potion") or string.find(item.Name or "", "Boost") then
                            M.Net:InvokeServer("UseItem", id)
                        end
                    end
                end
                task.wait(5)
            end
        end)
    end
})

Rayfield:LoadConfiguration()

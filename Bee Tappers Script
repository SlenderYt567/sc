--!strict
-- SlenderHub - Bee Tappers (Mobile & PC)
-- Features: Bypass V2 + Smart Merchant + Turbo Hatch + Webhook + Optimized Farm

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local Workspace = game:GetService("Workspace")
local StarterGui = game:GetService("StarterGui")

local LocalPlayer = Players.LocalPlayer

print("ðŸ›¡ï¸ [SlenderHub]: Initializing System...")

-- [ 1. BYPASS & PROTECTION SYSTEM ] --
task.spawn(function()
    local badGlobals = {"syn", "secure_load", "KRNL_LOADED", "is_sirhurt_closure", "electron", "fluxus", "Arceus", "Exploit"}
    for _, v in pairs(badGlobals) do
        if rawget(_G, v) then rawset(_G, v, nil) end
    end
end)

local mt = getrawmetatable(game)
local old_namecall = mt.__namecall
local old_newindex = mt.__newindex
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod():lower()
    local args = {...}
    -- Anti-Kick & Anti-Ban Hooks
    if self == LocalPlayer and (method == "kick" or method == "destroy") then return nil end
    if method == "fireserver" and tostring(self) == "AntiCheatEvent" then return nil end
    -- Anti-Scan (Protects UI)
    if method == "preloadasync" and tostring(self) == "ContentProvider" then return nil end
    return old_namecall(self, unpack(args))
end)

mt.__newindex = newcclosure(function(self, key, value)
    if self == LocalPlayer and tostring(key) == "Parent" and value == nil then return nil end
    return old_newindex(self, key, value)
end)
setreadonly(mt, true)

-- [ 2. UI LIBRARY: RAYFIELD ] --
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Bee Tappers | SlenderHub",
    Icon = "moon", -- Changed to Moon icon for Slender theme
    LoadingTitle = "SlenderHub",
    LoadingSubtitle = "Loading Scripts...",
    Theme = "Default", -- You can change to 'DarkBlue' or 'Serenity' if preferred
    ToggleUIKeybind = Enum.KeyCode.RightControl, -- Mobile Support
    ConfigurationSaving = {Enabled = true, FolderName = "SlenderHub_Bee", FileName = "Config"}
})

local FarmTab = Window:CreateTab("Farm", "hammer")
local EggTab = Window:CreateTab("Eggs", "egg")
local MiscTab = Window:CreateTab("Misc", "settings")

-- [ 3. VARIABLES & CONNECTIONS ] --
local Flags = {
    AutoClick = false, AutoHatch = false, AutoTicket = false, 
    AutoOrb = false, AutoMerchant = false, AntiAFK = false,
    ClickDelay = 0.1, HatchDelay = 0.05,
    
    -- Merchant Filters
    BuyTier1 = false, -- Trash (Fruits)
    BuyTier2 = true,  -- Mid (Royal Jelly)
    BuyTier3 = true   -- Rare (Moon Orb/Mythic Jelly)
}
local SelectedEggCode: string? = nil

local Events = ReplicatedStorage:WaitForChild("Events", 5)
local ShareHatchesEvent = Events and Events:WaitForChild("ShareHatches", 5)
local RemoteFunctionEvent = Events and Events:WaitForChild("RemoteFunction", 5)

-- Data Dumper (For Webhook)
local EggDataFuncs = nil
task.spawn(function()
    local Modules = ReplicatedStorage:WaitForChild("Modules", 5)
    local EggsMod = Modules and Modules:FindFirstChild("Eggs")
    if EggsMod then pcall(function() EggDataFuncs = require(EggsMod) end) end
end)

-- Webhook Configuration
local WEBHOOK_URL = "https://discord.com/api/webhooks/1441172911145750731/1f8e3lY7YUs8h9ERatyvJ6Of92Qby825Cz-AKwSCuoobCVmxPgygeki9dx8gDFB6yP4P"
local MIN_RARITY_TO_PING = 6 

local function SendDiscordMessage(petName, rarityId, petImageId)
    local request = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request) or request
    if not request then return end
    
    local RarityData = {
        [5] = {Name = "Legendary", Color = 16766720},
        [6] = {Name = "Mythical",  Color = 16737279},
        [7] = {Name = "Secret",    Color = 16711684},
        [8] = {Name = "Almighty",  Color = 4605551},
        [9] = {Name = "Godlike",   Color = 0},
        [10] = {Name = "Exclusive",Color = 13500622}
    }
    local rInfo = RarityData[rarityId] or {Name = "Rarity " .. tostring(rarityId), Color = 16777215}

    local embed = {
        ["title"] = "ðŸ‘‘ SLENDERHUB DROP: " .. string.upper(rInfo.Name) .. "!",
        ["description"] = "**Pet:** " .. tostring(petName) .. "\n**Rarity:** " .. tostring(rInfo.Name) .. " (" .. tostring(rarityId) .. ")",
        ["color"] = rInfo.Color,
        ["thumbnail"] = { ["url"] = "https://www.roblox.com/asset-thumbnail/image?assetId=" .. tostring(petImageId) .. "&width=420&height=420&format=png" },
        ["footer"] = { ["text"] = "SlenderHub Premium" }
    }
    local content = ""
    if rarityId >= 8 then content = "@everyone GODLIKE DROP!" end

    request({
        Url = WEBHOOK_URL, Method = "POST", Headers = {["Content-Type"] = "application/json"},
        Body = HttpService:JSONEncode({["content"] = content, ["embeds"] = {embed}, ["username"] = "SlenderHub Bot"})
    })
end

-- [ 4. TAB: FARM ] --

FarmTab:CreateSection("Main Farming")

FarmTab:CreateToggle({
    Name = "Auto Click",
    CurrentValue = false,
    Flag = "AutoClick",
    Callback = function(Value)
        Flags.AutoClick = Value
        if Value and ShareHatchesEvent then
            task.spawn(function()
                while Flags.AutoClick do
                    pcall(function() ShareHatchesEvent:FireServer("Click", "") end)
                    task.wait(Flags.ClickDelay)
                end
            end)
        end
    end,
})

FarmTab:CreateSlider({
    Name = "Click Speed (Seconds)", Range = {0, 1}, Increment = 0.01, Suffix = "s", CurrentValue = 0.1, Flag = "ClickSpeed",
    Callback = function(Value) Flags.ClickDelay = Value end
})

FarmTab:CreateToggle({
    Name = "Auto Collect Orbs (Optimized)",
    CurrentValue = false,
    Flag = "AutoOrb",
    Callback = function(Value)
        Flags.AutoOrb = Value
        if Value and ShareHatchesEvent then
            task.spawn(function()
                while Flags.AutoOrb do
                    local orbIds, parts = {}, {}
                    local OrbsFolder = Workspace:FindFirstChild("Orbs")
                    if OrbsFolder then
                        for _, obj in ipairs(OrbsFolder:GetChildren()) do
                            if obj:GetAttribute("CanCollect") == true then
                                table.insert(orbIds, obj.Name); table.insert(parts, obj)
                            end
                        end
                    end
                    if #orbIds > 0 then
                        local s, json = pcall(HttpService.JSONEncode, HttpService, orbIds)
                        if s then
                            local prefix = (#orbIds == 1) and "(" or "O"
                            pcall(function() ShareHatchesEvent:FireServer("ClaimOrb", "j\000\000\000" .. prefix .. json) end)
                            for _, p in ipairs(parts) do pcall(function() p:Destroy() end) end
                        end
                    end
                    task.wait(0.5)
                end
            end)
        end
    end,
})

FarmTab:CreateToggle({
    Name = "Auto Ticket (Wealth Clock)",
    CurrentValue = false,
    Flag = "AutoTicket",
    Callback = function(Value)
        Flags.AutoTicket = Value
        if Value then
            task.spawn(function()
                local interactCallback = nil
                local part = nil
                pcall(function()
                    local t = Workspace:WaitForChild("Scripted", 5):WaitForChild("WealthClock", 5):WaitForChild("Touch", 5)
                    interactCallback = t:WaitForChild("InteractCallback", 5); part = t
                end)
                if not interactCallback then return end
                while Flags.AutoTicket do
                    if interactCallback and part then pcall(function() interactCallback:FireServer(part) end) end
                    task.wait(1.1)
                end
            end)
        end
    end,
})

FarmTab:CreateSection("Smart Merchant")

FarmTab:CreateToggle({
    Name = "Auto Buy (Enable Logic)",
    CurrentValue = false,
    Flag = "AutoMerchant",
    Callback = function(Value)
        Flags.AutoMerchant = Value
        if Value and RemoteFunctionEvent then
            task.spawn(function()
                while Flags.AutoMerchant do
                    local s, state = pcall(function() return RemoteFunctionEvent:InvokeServer("Merchant_GetState") end)
                    if s and state and state.Active then
                        for i = 1, 3 do
                            local slot = state.Slots[i]
                            if slot and (slot.Left or 0) > 0 then
                                -- SlenderHub Logic
                                local shouldBuy = false
                                if i == 1 and Flags.BuyTier1 then shouldBuy = true end 
                                if i == 2 and Flags.BuyTier2 then shouldBuy = true end 
                                if i == 3 and Flags.BuyTier3 then shouldBuy = true end 
                                
                                if shouldBuy then
                                    pcall(function() RemoteFunctionEvent:InvokeServer("Merchant_Buy", i) end)
                                end
                            end
                        end
                    end
                    task.wait(2)
                end
            end)
        end
    end,
})

FarmTab:CreateToggle({
    Name = "Buy Tier 1 (Fruits/Potions)",
    CurrentValue = false,
    Callback = function(Val) Flags.BuyTier1 = Val end
})

FarmTab:CreateToggle({
    Name = "Buy Tier 2 (Royal Jelly)",
    CurrentValue = true,
    Callback = function(Val) Flags.BuyTier2 = Val end
})

FarmTab:CreateToggle({
    Name = "Buy Tier 3 (Moon Orb/Mythic Jelly)",
    CurrentValue = true,
    Callback = function(Val) Flags.BuyTier3 = Val end
})

-- [ 5. TAB: EGGS ] --

local EGG_CODES = {
    ["Basics Triple"]   = "s\000\000\000\005Basics\000\000\000\006Triple",
    ["Twinkles Triple"] = "s\000\000\000\aTwinkles\000\000\000\006Triple",
    ["Farms Triple"]    = "s\000\000\000\004Farms\000\000\000\006Triple",
    ["Mushys Triple"]   = "s\000\000\000\005Mushys\000\000\000\006Triple",
    ["Flowers Triple"]  = "s\000\000\000\006Flowers\000\000\000\006Triple",
    ["Castles Triple"]  = "s\000\000\000\006Castles\000\000\000\006Triple",
    ["Fanarts Triple"]  = "s\000\000\000\006Fanarts\000\000\000\006Triple",
    ["Brainrots Triple"]= "s\000\000\000\bBrainrots\000\000\000\006Triple",
    ["100ks Triple"]    = "s\000\000\000\004100ks\000\000\000\006Triple"
}

local options = {}
for k,_ in pairs(EGG_CODES) do table.insert(options, k) end
table.sort(options)
SelectedEggCode = EGG_CODES[options[1]]

EggTab:CreateDropdown({
    Name = "Select Egg (Triple Hatch)",
    Options = options,
    CurrentOption = {options[1]},
    Callback = function(opt) SelectedEggCode = EGG_CODES[opt[1]] end
})

EggTab:CreateToggle({
    Name = "Auto Hatch (Turbo)",
    CurrentValue = false,
    Flag = "AutoHatch",
    Callback = function(Value)
        Flags.AutoHatch = Value
        if Value and RemoteFunctionEvent then
            task.spawn(function()
                while Flags.AutoHatch do
                    if SelectedEggCode then
                        task.spawn(function()
                            local s, r = pcall(function() return RemoteFunctionEvent:InvokeServer("Hatch", SelectedEggCode) end)
                            if s and r and EggDataFuncs then
                                local list = {}
                                if r.petId then table.insert(list, r) end
                                for _,v in pairs(r) do if type(v)=="table" and v.petId then table.insert(list, v) end end
                                for _, item in ipairs(list) do
                                    local data = EggDataFuncs.getIDData(item.petId)
                                    if data and data.rarity and tonumber(data.rarity) >= MIN_RARITY_TO_PING then
                                        SendDiscordMessage(data.name, tonumber(data.rarity), data.imageId)
                                    end
                                end
                            end
                        end)
                    end
                    task.wait(Flags.HatchDelay)
                end
            end)
        end
    end,
})

EggTab:CreateSlider({
    Name = "Hatch Delay (Seconds)", Range = {0, 2}, Increment = 0.01, Suffix = "s", CurrentValue = 0.05, Flag = "HatchSpeed",
    Callback = function(Value) Flags.HatchDelay = Value end
})

-- [ 6. TAB: MISC ] --
MiscTab:CreateToggle({
    Name = "Anti AFK",
    CurrentValue = false,
    Flag = "AntiAFK",
    Callback = function(Value)
        Flags.AntiAFK = Value
        if Value then
            task.spawn(function()
                while Flags.AntiAFK do
                    VirtualUser:CaptureController()
                    VirtualUser:ClickButton2(Vector2.new())
                    task.wait(60)
                end
            end)
        end
    end,
})

Rayfield:Notify({Title = "SlenderHub Loaded", Content = "Welcome back, User!", Duration = 3})

--!strict
-- SlenderHub - Bee Tappers V22 (MERCHANT SELECTOR)
-- Features: Universal Key System + Premium + Manual Tier Selection for Merchant

-- [ 1. ACESSO & VARIÃVEIS ] --
local AccessLevel = getgenv().SlenderHubAccessLevel or "Free"
local isPremium = (AccessLevel == "Premium")
print("ðŸ›¡ï¸ [SlenderHub]: Initializing V22...")

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")
local VirtualUser = game:GetService("VirtualUser")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- [ 2. ANTI-BAN FORTRESS V3 ] --
task.spawn(function()
    local badGlobals = {"syn", "secure_load", "KRNL_LOADED", "is_sirhurt_closure", "electron", "fluxus", "Arceus", "Exploit"}
    for _, v in pairs(badGlobals) do if rawget(_G, v) then rawset(_G, v, nil) end end
end)

local mt = getrawmetatable(game)
local old_namecall = mt.__namecall
local old_newindex = mt.__newindex
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod():lower()
    local args = {...}
    if self == LocalPlayer and (method == "kick" or method == "destroy") then return nil end
    if method == "fireserver" and tostring(self) == "AntiCheatEvent" then return nil end
    if method == "preloadasync" and tostring(self) == "ContentProvider" then return nil end
    return old_namecall(self, unpack(args))
end)

mt.__newindex = newcclosure(function(self, key, value)
    if self == LocalPlayer and tostring(key) == "Parent" and value == nil then return nil end
    return old_newindex(self, key, value)
end)
setreadonly(mt, true)

-- [ 3. UI LIBRARY ] --
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local WindowName = isPremium and "Bee Tappers | ðŸ’Ž PREMIUM" or "Bee Tappers | FREE Version"
local Window = Rayfield:CreateWindow({
    Name = WindowName,
    Icon = isPremium and "crown" or "moon",
    LoadingTitle = "SlenderHub " .. AccessLevel,
    LoadingSubtitle = "Merchant Selector Added",
    Theme = isPremium and "Amethyst" or "Default",
    ToggleUIKeybind = Enum.KeyCode.RightControl,
    ConfigurationSaving = {Enabled = true, FolderName = "SlenderHub_Bee_"..AccessLevel, FileName = "Config"}
})

local FarmTab = Window:CreateTab("Farm", "hammer")
local EggTab = Window:CreateTab("Eggs", "egg")
local MiscTab = Window:CreateTab("Misc", "settings")
local PremiumTab = Window:CreateTab("ðŸ’Ž Premium", "diamond")

-- [ 4. GAME DATA ] --
local Flags = {
    AutoClick = false, AutoHatch = false, AutoTicket = false, 
    AutoOrb = false, AutoMerchant = false, AntiAFK = false,
    AutoSpin = false, AutoReward = false,
    ClickDelay = isPremium and 0 or 0.8,
    HatchDelay = isPremium and 0 or 0.8
}
local SelectedEggCode: string? = nil
local SelectedMerchantTierArg: string? = nil -- Novo

local Events = ReplicatedStorage:WaitForChild("Events", 5)
local ShareHatchesEvent = Events and Events:WaitForChild("ShareHatches", 5)
local RemoteFunctionEvent = Events and Events:WaitForChild("RemoteFunction", 5)

local EggDataFuncs = nil
task.spawn(function()
    local Modules = ReplicatedStorage:WaitForChild("Modules", 5)
    local EggsMod = Modules and Modules:FindFirstChild("Eggs")
    if EggsMod then pcall(function() EggDataFuncs = require(EggsMod) end) end
end)

local RAW_WEBHOOK = "https://discord.com/api/webhooks/1441172911145750731/1f8e3lY7YUs8h9ERatyvJ6Of92Qby825Cz-AKwSCuoobCVmxPgygeki9dx8gDFB6yP4P"
local function GetProxyUrl(url) return url:gsub("discord.com", "webhook.lewisakura.moe") end
local FINAL_URL = GetProxyUrl(RAW_WEBHOOK)
local MIN_RARITY_TO_PING = 6 

local function SendDiscordMessage(petName, rarityId, petImageId)
    local request = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request) or request
    if not request then return end
    
    local RarityData = {
        [5] = {Name = "Legendary", Color = 16766720},
        [6] = {Name = "Mythical",  Color = 16737279},
        [7] = {Name = "Secret",    Color = 16711684},
        [8] = {Name = "Almighty",  Color = 4605551},
        [9] = {Name = "Godlike",   Color = 0},
        [10] = {Name = "Exclusive",Color = 13500622}
    }
    local rInfo = RarityData[rarityId] or {Name = "Rarity " .. tostring(rarityId), Color = 16777215}
    local userType = isPremium and "ðŸ’Ž PREMIUM User" or "Free User"

    local embed = {
        ["title"] = "ðŸ‘‘ SLENDERHUB DROP: " .. string.upper(rInfo.Name) .. "!",
        ["description"] = "**User:** " .. userType .. "\n**Pet:** " .. tostring(petName) .. "\n**Rarity:** " .. tostring(rInfo.Name) .. " (" .. tostring(rarityId) .. ")",
        ["color"] = rInfo.Color,
        ["thumbnail"] = { ["url"] = "https://www.roblox.com/asset-thumbnail/image?assetId=" .. tostring(petImageId) .. "&width=420&height=420&format=png" },
        ["footer"] = { ["text"] = "SlenderHub" }
    }
    local content = ""
    if rarityId >= 8 then content = "@everyone GODLIKE DROP!" end

    request({
        Url = FINAL_URL, Method = "POST", Headers = {["Content-Type"] = "application/json"},
        Body = HttpService:JSONEncode({["content"] = content, ["embeds"] = {embed}, ["username"] = "SlenderHub Bot"})
    })
end

-- [ 5. FUNÃ‡ÃƒO ANTI-LAG ] --
local function RemoveEggAnimations()
    local Assets = ReplicatedStorage:FindFirstChild("Assets")
    if Assets then
        local VFX = Assets:FindFirstChild("VFX")
        if VFX then VFX:Destroy() end
    end
    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
    local Overlay = PlayerGui:WaitForChild("HatchInfoOverlay", 5)
    if Overlay then Overlay:Destroy() end
    PlayerGui.ChildAdded:Connect(function(child) if child.Name == "HatchInfoOverlay" then task.wait(); child:Destroy() end end)
    Rayfield:Notify({Title = "Performance", Content = "Egg Animations Removed!", Duration = 3})
end

-- [ 6. FARM TAB ] --
FarmTab:CreateSection("Main Farming")
local clickTitle = isPremium and "Auto Click (INSANE SPEED âš¡)" or "Auto Click (0.8s Delay)"
FarmTab:CreateToggle({Name = clickTitle, CurrentValue = false, Flag = "AutoClick", Callback = function(Value) Flags.AutoClick = Value; if Value and ShareHatchesEvent then task.spawn(function() while Flags.AutoClick do pcall(function() ShareHatchesEvent:FireServer("Click", "") end); if isPremium then game:GetService("RunService").Heartbeat:Wait() else task.wait(0.8) end end end) end end})
if isPremium then FarmTab:CreateSlider({Name = "Click Speed (0 = Max)", Range = {0, 1}, Increment = 0.01, Suffix = "s", CurrentValue = 0, Flag = "ClickSpeed", Callback = function(Value) Flags.ClickDelay = Value end}) end
FarmTab:CreateToggle({Name = "Auto Collect Orbs", CurrentValue = false, Flag = "AutoOrb", Callback = function(Value) Flags.AutoOrb = Value; if Value and ShareHatchesEvent then task.spawn(function() while Flags.AutoOrb do local ids,p={},{} for _,o in ipairs(Workspace.Orbs:GetChildren()) do if o:GetAttribute("CanCollect") then table.insert(ids,o.Name); table.insert(p,o) end end; if #ids>0 then pcall(function() ShareHatchesEvent:FireServer("ClaimOrb", "j\000\000\000" .. (#ids==1 and "(" or "O") .. HttpService:JSONEncode(ids)) end); for _,v in ipairs(p) do pcall(function() v:Destroy() end) end end; task.wait(isPremium and 0.1 or 0.5) end end) end end})
FarmTab:CreateToggle({Name = "Auto Ticket", CurrentValue = false, Flag = "AutoTicket", Callback = function(Value) Flags.AutoTicket = Value; if Value then task.spawn(function() local t=Workspace:WaitForChild("Scripted"):WaitForChild("WealthClock"):WaitForChild("Touch"); local ic=t:WaitForChild("InteractCallback"); while Flags.AutoTicket do pcall(function() ic:FireServer(t) end); task.wait(1.1) end end) end end})

-- [ MERCHANT SELECTOR - ATUALIZADO ] --
FarmTab:CreateSection("Merchant Selector")

-- Tabela com os cÃ³digos exatos fornecidos
local MERCHANT_TIERS = {
    ["Tier 1 (Low/Fruit)"]  = "n?\240\000\000\000\000\000\000",
    ["Tier 2 (Mid/Jelly)"]  = "n@\000\000\000\000\000\000\000",
    ["Tier 3 (High/Mythic)"] = "n@\b\000\000\000\000\000\000"
}

local merchOptions = {}
for k,_ in pairs(MERCHANT_TIERS) do table.insert(merchOptions, k) end
table.sort(merchOptions)
SelectedMerchantTierArg = MERCHANT_TIERS[merchOptions[3]] -- Default Tier 3

FarmTab:CreateDropdown({
    Name = "Select Tier to Buy",
    Options = merchOptions,
    CurrentOption = {merchOptions[3]}, -- Default: Tier 3
    Callback = function(option)
        SelectedMerchantTierArg = MERCHANT_TIERS[option[1]]
    end
})

FarmTab:CreateToggle({
    Name = "Auto Buy Selected Tier",
    CurrentValue = false,
    Flag = "AutoMerchant",
    Callback = function(Value)
        Flags.AutoMerchant = Value
        if Value and RemoteFunctionEvent then
            task.spawn(function()
                while Flags.AutoMerchant do
                    if SelectedMerchantTierArg then
                        -- Envia o argumento exato selecionado no Dropdown
                        pcall(function() 
                            RemoteFunctionEvent:InvokeServer("Merchant_Buy", SelectedMerchantTierArg) 
                        end)
                    end
                    task.wait(2) -- Delay para evitar crash ou kick
                end
            end)
        end
    end,
})

-- [ 7. EGGS TAB ] --
local EGG_CODES = {
    ["Basics Triple"]   = "s\000\000\000\005Basics\000\000\000\006Triple",
    ["Twinkles Triple"] = "s\000\000\000\aTwinkles\000\000\000\006Triple",
    ["Farms Triple"]    = "s\000\000\000\004Farms\000\000\000\006Triple",
    ["Mushys Triple"]   = "s\000\000\000\005Mushys\000\000\000\006Triple",
    ["Flowers Triple"]  = "s\000\000\000\006Flowers\000\000\000\006Triple",
    ["Castles Triple"]  = "s\000\000\000\006Castles\000\000\000\006Triple",
    ["Fanarts Triple"]  = "s\000\000\000\006Fanarts\000\000\000\006Triple",
    ["Brainrots Triple"]= "s\000\000\000\bBrainrots\000\000\000\006Triple",
    ["100ks Triple"]    = "s\000\000\000\004100ks\000\000\000\006Triple"
}
local options = {} for k,_ in pairs(EGG_CODES) do table.insert(options, k) end; table.sort(options); SelectedEggCode = EGG_CODES[options[1]]
EggTab:CreateDropdown({Name = "Select Egg", Options = options, CurrentOption = {options[1]}, Callback = function(opt) SelectedEggCode = EGG_CODES[opt[1]] end})
local hatchTitle = isPremium and "Auto Hatch (TURBO MODE ðŸ”¥)" or "Auto Hatch (0.8s Delay)"
EggTab:CreateToggle({Name = hatchTitle, CurrentValue = false, Flag = "AutoHatch", Callback = function(Value) Flags.AutoHatch = Value; if Value then task.spawn(function() while Flags.AutoHatch do if SelectedEggCode then task.spawn(function() local s,r=pcall(function() return RemoteFunctionEvent:InvokeServer("Hatch", SelectedEggCode) end); if s and r and EggDataFuncs then local l={}; if r.petId then table.insert(l,r) else for _,v in pairs(r) do if type(v)=="table" and v.petId then table.insert(l,v) end end end; for _,i in ipairs(l) do local d=EggDataFuncs.getIDData(i.petId); if d and tonumber(d.rarity)>=MIN_RARITY_TO_PING then SendDiscordMessage(d.name, tonumber(d.rarity), d.imageId) end end end end) end; task.wait(isPremium and Flags.HatchDelay or 0.8) end end) end end})
if isPremium then EggTab:CreateSlider({Name = "Hatch Delay (0 = Max)", Range = {0, 1}, Increment = 0.01, Suffix = "s", CurrentValue = 0, Flag = "HatchSpeed", Callback = function(Value) Flags.HatchDelay = Value end}) end
EggTab:CreateSection("Anti-Lag")
EggTab:CreateButton({Name = "ðŸš« Remove Hatch Animations (Boost FPS)", Callback = function() RemoveEggAnimations() end})

-- [ 8. PREMIUM TAB ] --
if isPremium then
    PremiumTab:CreateSection("Premium Activated")
    PremiumTab:CreateLabel("âœ… Lifetime/Monthly Access")
    PremiumTab:CreateParagraph({Title = "Benefits", Content = "- 0 Delay Auto Click\n- 0 Delay Auto Hatch\n- Faster Farm"})
else
    PremiumTab:CreateSection("Access Locked")
    PremiumTab:CreateParagraph({Title = "Premium Only", Content = "Unlock INSANE speeds and remove limits!"})
    PremiumTab:CreateButton({
        Name = "Copy Store Link",
        Callback = function() 
            setclipboard("https://www.slenderhub.shop/") 
            Rayfield:Notify({Title = "Copied", Content = "Link copied to clipboard", Duration = 2})
        end
    })
end

-- [ 9. MISC TAB ] --
MiscTab:CreateSection("Free Rewards")
MiscTab:CreateToggle({Name = "Auto Spin Wheel", CurrentValue = false, Flag = "AutoSpin", Callback = function(Value) Flags.AutoSpin = Value; if Value then task.spawn(function() while Flags.AutoSpin do pcall(function() RemoteFunctionEvent:InvokeServer("SpinRequest", "n?\240\000\000\000\000\000\000") end); task.wait(5) end end) end end})
MiscTab:CreateToggle({Name = "Auto Daily Rewards", CurrentValue = false, Flag = "AutoReward", Callback = function(Value) Flags.AutoReward = Value; if Value then task.spawn(function() while Flags.AutoReward do for i=1,12 do local p=(i<10) and "\a" or "\b"; pcall(function() ShareHatchesEvent:FireServer("CollectDailyReward", "s\000\000\000"..p.."Reward"..i) end); task.wait(0.5) end; task.wait(60) end end) end end})

MiscTab:CreateSection("Key System")
MiscTab:CreateButton({
    Name = "ðŸ”‘ Reset Key / Logout",
    Callback = function()
        local fileName = "KeyData_" .. LocalPlayer.UserId .. ".json"
        local fullPath = "SlenderHub_Universal/" .. fileName
        if isfile(fullPath) then delfile(fullPath) Rayfield:Notify({Title = "Success", Content = "Key reset! Rejoin game.", Duration = 5}) else Rayfield:Notify({Title = "Info", Content = "No key found to reset.", Duration = 3}) end
    end,
})

MiscTab:CreateSection("Util")
MiscTab:CreateToggle({Name = "Anti AFK", CurrentValue = false, Flag = "AntiAFK", Callback = function(Value) Flags.AntiAFK = Value; if Value then task.spawn(function() while Flags.AntiAFK do VirtualUser:CaptureController(); VirtualUser:ClickButton2(Vector2.new()); task.wait(60) end end) end end})

Rayfield:Notify({Title = "SlenderHub", Content = "Merchant Updated!", Duration = 5})

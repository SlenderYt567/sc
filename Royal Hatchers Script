-- Espera o jogo carregar
repeat task.wait() until game:IsLoaded()

-- Serviços do Roblox
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Remotes = ReplicatedStorage:WaitForChild("Remotes")
local Functions = Remotes:WaitForChild("Functions")
local Events = Remotes:WaitForChild("Events") -- Adicionado para eventos de collectibles

-- Tabelas de Dados extraídas da sua Dex (ATUALIZADAS)
local AllEggs = {
    "Common Egg", "Spotted Egg", "Rocky Egg", "Mushroom Egg", "Leaf Egg", 
    "Arctic Egg", "Icy Egg", "Release Egg", "Lovely Egg", "Valentines Egg", 
    "100K Egg", "Desert Egg", "Fiery Egg", "Magma Egg", "500K Egg",
    "Crystal Egg", "Floral Egg", "Mystical Egg", "Season 1 Egg", 
    "Bounty Pets", "Exclusive Pets"
}

local AllUpgrades = {
    "Coins1", "EggHatch1", "Gems1", "HatchSpeed1", "Coins2", "Luck1", 
    "Shiny1", "HatchSpeed2", "Coins3", "Gems2", "Luck2", "Shiny2", 
    "Hatcher1", "Shiny3", "Coins4", "Luck3", "EggHatch2", "Shiny4",
    "Coins5", "Luck4", "EggHatch3", "HiddenLuck", "HiddenShinyLuck", "HiddenHatchSpeed"
}

-- Variáveis de Controle
local getgenv = getgenv or function() return _G end
getgenv().AutoClick = false
getgenv().AutoEgg = false
getgenv().SelectedEgg = "Common Egg"
getgenv().EggAmount = 100
getgenv().AutoMerchant = false
getgenv().AutoCollect = false
getgenv().AutoUpgrade = false
getgenv().SelectedUpgrade = "Coins1"
getgenv().AntiAFKMovement = false
getgenv().AutoCreateClan = false
getgenv().ClanNameToCreate = "SlenderHub Clan" -- Default clan name
getgenv().AutoAcceptInvites = false
getgenv().AutoLeaveClan = false

-- Anti-AFK padrão (desabilita o evento de ociosidade do jogador)
for _, con in pairs(getconnections(LocalPlayer.Idled)) do
    con:Disable()
end

--========================================================--
--                  CARREGANDO RAYFIELD UI                --
--========================================================--
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "SlenderHub | Royal Hatchers",
    LoadingTitle = "SlenderHub Loading...",
    LoadingSubtitle = "by Slender",
    ConfigurationSaving = {
        Enabled = false,
        FolderName = nil,
        FileName = "SlenderHub"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink",
        RememberJoins = true
    },
    KeySystem = false
})

--================= TABS =================--
local TabFarming = Window:CreateTab("Farming", 4483362458)
local TabEggs = Window:CreateTab("Eggs", 4483362458)
local TabShop = Window:CreateTab("Shop & Upgrades", 4483362458)
local TabClans = Window:CreateTab("Clans", 4483362458) -- Novo Tab para Clans
local TabPlayer = Window:CreateTab("Player", 4483362458)

--================= FARMING TAB =================--
TabFarming:CreateToggle({
    Name = "Auto Click",
    CurrentValue = false,
    Flag = "ToggleAutoClick",
    Callback = function(Value)
        getgenv().AutoClick = Value
        task.spawn(function()
            while getgenv().AutoClick do
                pcall(function()
                    Functions.Click:InvokeServer()
                end)
                task.wait() -- Sem delay para máxima velocidade
            end
        end)
    end
})

-- Implementação melhorada do Auto Collectibles
local collectibleIdsToCollect = {}

-- Escuta o evento LoadCollectibles para popular a lista de IDs
Events.LoadCollectibles.OnClientEvent:Connect(function(collectiblesData)
    for _, data in pairs(collectiblesData) do
        table.insert(collectibleIdsToCollect, data.ID)
    end
end)

TabFarming:CreateToggle({
    Name = "Auto Collectibles (Gems/Drops)",
    CurrentValue = false,
    Flag = "ToggleAutoCollect",
    Callback = function(Value)
        getgenv().AutoCollect = Value
        task.spawn(function()
            while getgenv().AutoCollect do
                pcall(function()
                    -- Itera sobre os IDs conhecidos e tenta coletá-los
                    for i = #collectibleIdsToCollect, 1, -1 do
                        local collectibleID = collectibleIdsToCollect[i]
                        Functions.CollectCollectible:InvokeServer(collectibleID)
                        table.remove(collectibleIdsToCollect, i) -- Remove da lista local após a tentativa de coleta
                    end
                end)
                task.wait(0.1) -- Pequeno delay para evitar spam excessivo
            end
        end)
    end
})

--================= EGGS TAB =================--
TabEggs:CreateDropdown({
    Name = "Select Egg",
    Options = AllEggs, -- Lista atualizada
    CurrentOption = {"Common Egg"},
    MultipleOptions = false,
    Flag = "DropdownEgg",
    Callback = function(Option)
        getgenv().SelectedEgg = Option[1]
    end
})

TabEggs:CreateSlider({
    Name = "Amount to Open",
    Range = {1, 100},
    Increment = 1,
    Suffix = " Eggs",
    CurrentValue = 100,
    Flag = "SliderEggAmount",
    Callback = function(Value)
        getgenv().EggAmount = Value
    end
})

TabEggs:CreateToggle({
    Name = "Auto Hatch",
    CurrentValue = false,
    Flag = "ToggleAutoHatch",
    Callback = function(Value)
        getgenv().AutoEgg = Value
        task.spawn(function()
            while getgenv().AutoEgg do
                pcall(function()
                    local eggFolder = Workspace:FindFirstChild("_") and Workspace._:FindFirstChild("Eggs")
                    if eggFolder and eggFolder:FindFirstChild(getgenv().SelectedEgg) then
                        local args = {
                            eggFolder[getgenv().SelectedEgg],
                            getgenv().EggAmount
                        }
                        -- Usar table.unpack para compatibilidade moderna
                        Functions.BuyEgg:InvokeServer(table.unpack(args))
                    end
                end)
                task.wait(0.05) -- Pequeno delay para segurança
            end
        end)
    end
})

--================= SHOP & UPGRADES TAB =================--
TabShop:CreateToggle({
    Name = "Auto Buy Merchant (All Items)",
    CurrentValue = false,
    Flag = "ToggleMerchant",
    Callback = function(Value)
        getgenv().AutoMerchant = Value
        task.spawn(function()
            while getgenv().AutoMerchant do
                pcall(function()
                    -- Compra todos os 15 slots baseados no MerchantData
                    for i = 1, 15 do
                        Functions.BuyMerchant:InvokeServer("Merchant", i)
                    end
                end)
                task.wait(2) -- Delay de 2s para não dar spam excessivo no server
            end
        end)
    end
})

TabShop:CreateDropdown({
    Name = "Select Upgrade",
    Options = AllUpgrades, -- Lista atualizada
    CurrentOption = {"Coins1"},
    MultipleOptions = false,
    Flag = "DropdownUpgrade",
    Callback = function(Option)
        getgenv().SelectedUpgrade = Option[1]
    end
})

TabShop:CreateToggle({
    Name = "Auto Buy Upgrade",
    CurrentValue = false,
    Flag = "ToggleUpgrade",
    Callback = function(Value)
        getgenv().AutoUpgrade = Value
        task.spawn(function()
            while getgenv().AutoUpgrade do
                pcall(function()
                    Functions.BuyUpgrade:InvokeServer(getgenv().SelectedUpgrade)
                end)
                task.wait(1)
            end
        end)
    end
})

--================= CLANS TAB =================--
local ClanRemote = Remotes:WaitForChild("Functions"):WaitForChild("ClanInvoke")

TabClans:CreateInput({
    Name = "Clan Name to Create",
    Placeholder = "Enter clan name",
    CurrentValue = "SlenderHub Clan",
    Flag = "ClanNameInput",
    Callback = function(Value)
        getgenv().ClanNameToCreate = Value
    end
})

TabClans:CreateToggle({
    Name = "Auto Create Clan",
    CurrentValue = false,
    Flag = "ToggleAutoCreateClan",
    Callback = function(Value)
        getgenv().AutoCreateClan = Value
        if Value then
            task.spawn(function()
                while getgenv().AutoCreateClan and not LocalPlayer:GetAttribute("Clan") do
                    pcall(function()
                        -- Tenta criar o clã com o nome definido
                        local success = ClanRemote:InvokeServer("CreateClan", getgenv().ClanNameToCreate)
                        if success == true then
                            warn("Successfully created clan:", getgenv().ClanNameToCreate)
                            getgenv().AutoCreateClan = false -- Desativa após criar com sucesso
                        elseif type(success) == "string" then
                            warn("Failed to create clan:", success)
                        end
                    end)
                    task.wait(5) -- Espera um pouco antes de tentar novamente
                end
            end)
        end
    end
})

TabClans:CreateToggle({
    Name = "Auto Accept Clan Invites",
    CurrentValue = false,
    Flag = "ToggleAutoAcceptInvites",
    Callback = function(Value)
        getgenv().AutoAcceptInvites = Value
        if Value then
            Events.UpdateClans.OnClientEvent:Connect(function(eventType, data)
                if getgenv().AutoAcceptInvites and eventType == "InvitesUpdate" and data then
                    for _, clanName in pairs(data) do
                        pcall(function()
                            local success = ClanRemote:InvokeServer("JoinClan", clanName)
                            if success == true then
                                warn("Successfully joined clan:", clanName)
                            elseif type(success) == "string" then
                                warn("Failed to join clan:", success)
                            end
                        end)
                        task.wait(0.5) -- Pequeno delay entre aceitar convites
                    end
                end
            end)
        end
    end
})

TabClans:CreateToggle({
    Name = "Auto Leave/Delete Clan",
    CurrentValue = false,
    Flag = "ToggleAutoLeaveClan",
    Callback = function(Value)
        getgenv().AutoLeaveClan = Value
        if Value then
            task.spawn(function()
                while getgenv().AutoLeaveClan do
                    task.wait(1)
                    if LocalPlayer:GetAttribute("Clan") then
                        pcall(function()
                            local success = ClanRemote:InvokeServer("LeaveClan")
                            if success == true then
                                warn("Successfully left/deleted clan.")
                            elseif type(success) == "string" then
                                warn("Failed to leave/delete clan:", success)
                            end
                        end)
                    end
                end
            end)
        end
    end
})

--================= PLAYER TAB =================--
TabPlayer:CreateSlider({
    Name = "WalkSpeed",
    Range = {16, 200},
    Increment = 1,
    Suffix = " WS",
    CurrentValue = 16,
    Flag = "SliderWS",
    Callback = function(Value)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = Value
        end
    end
})

TabPlayer:CreateSlider({
    Name = "JumpPower",
    Range = {50, 300},
    Increment = 1,
    Suffix = " JP",
    CurrentValue = 50,
    Flag = "SliderJP",
    Callback = function(Value)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.JumpPower = Value
            LocalPlayer.Character.Humanoid.UseJumpPower = true
        end
    end
})

TabPlayer:CreateToggle({
    Name = "Anti-AFK (Jump a cada 5 minutos)",
    CurrentValue = false,
    Flag = "ToggleAntiAFK",
    Callback = function(Value)
        getgenv().AntiAFKMovement = Value
        if Value then
            task.spawn(function()
                while getgenv().AntiAFKMovement do
                    task.wait(300) -- Espera 5 minutos (300 segundos)
                    if getgenv().AntiAFKMovement then -- Verifica novamente caso o toggle tenha sido desativado durante a espera
                        local char = LocalPlayer.Character
                        local hum = char and char:FindFirstChildOfClass("Humanoid")
                        if hum and hum.Health > 0 then
                            -- Simula um pequeno pulo para manter a atividade
                            hum.Jump = true
                            task.wait(0.1) -- Mantém o pulo por um breve momento
                            hum.Jump = false
                        end
                    end
                end
            end)
        end
    end
})

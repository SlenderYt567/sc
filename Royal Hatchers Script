-- Espera o jogo carregar
repeat task.wait() until game:IsLoaded()

-- Serviços do Roblox
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService") -- Added for potential future use

local LocalPlayer = Players.LocalPlayer
local Remotes = ReplicatedStorage:WaitForChild("Remotes")
local Functions = Remotes:WaitForChild("Functions")

-- Tabelas de Dados extraídas da sua Dex
local EggsList = {
"Common Egg", "Spotted Egg", "Rocky Egg", "Mushroom Egg", "Leaf Egg",
"Arctic Egg", "Icy Egg", "Release Egg", "Lovely Egg", "Valentines Egg",
"100K Egg", "Desert Egg", "Fiery Egg", "Magma Egg", "500K Egg"
}

local UpgradesList = {
"Coins1", "EggHatch1", "Gems1", "HatchSpeed1", "Coins2", "Luck1",
"Shiny1", "HatchSpeed2", "Coins3", "Gems2", "Luck2", "Shiny2",
"Hatcher1", "Shiny3", "Coins4", "Luck3", "EggHatch2", "HiddenLuck",
"HiddenShinyLuck", "HiddenHatchSpeed"
}

-- Variáveis de Controle Global (usando _G para compatibilidade)
_G.AutoClick = false
_G.AutoEgg = false
_G.SelectedEgg = "Common Egg"
_G.EggAmount = 100
_G.AutoMerchant = false
_G.AutoCollect = false
_G.AutoUpgrade = false
_G.SelectedUpgrade = "Coins1"
_G.AntiAFKMovement = false
_G.WalkSpeed = 16
_G.JumpPower = 50

-- Anti-AFK padrão (desabilita o evento de ociosidade do jogador)
for _, con in pairs(getconnections(LocalPlayer.Idled)) do
    con:Disable()
end

-- Função para atualizar WalkSpeed/JumpPower no personagem atual e futuros
local function UpdatePlayerStats()
    local character = LocalPlayer.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = _G.WalkSpeed
            humanoid.JumpPower = _G.JumpPower
            humanoid.UseJumpPower = true
        end
    end
end

-- Conecta a um evento para aplicar WalkSpeed/JumpPower quando o personagem for adicionado
LocalPlayer.CharacterAdded:Connect(function(character)
    character:WaitForChild("Humanoid").WalkSpeed = _G.WalkSpeed
    character:WaitForChild("Humanoid").JumpPower = _G.JumpPower
    character:WaitForChild("Humanoid").UseJumpPower = true
end)

--========================================================--
--                  CARREGANDO SLENDERWIND UI             --
--========================================================--
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/SlenderYt567/sc/refs/heads/main/SlenderWind.lua"))()
local Window = Library.Window({ Name = "SlenderHub | Royal Hatchers", KeySystem = false })

--================= TABS =================--
local TabFarming = Window:NewTab("Farming")
local TabEggs = Window:NewTab("Eggs")
local TabShop = Window:NewTab("Shop & Upgrades")
local TabPlayer = Window:NewTab("Player")

--================= FARMING TAB =================--
local FarmingSection = TabFarming:NewSection("Auto Farming")

FarmingSection:NewToggle("Auto Click", false, function(Value)
    _G.AutoClick = Value
    if Value then
        task.spawn(function()
            while _G.AutoClick and LocalPlayer.Character do
                pcall(function()
                    Functions.Click:InvokeServer()
                end)
                task.wait(0.05) -- Pequeno delay para evitar spam excessivo no server
            end
        end)
    end
end)

FarmingSection:NewToggle("Auto Collectibles (Gems/Drops)", false, function(Value)
    _G.AutoCollect = Value
    if Value then
        task.spawn(function()
            -- Tenta encontrar o RemoteEvent para coleta (assumindo nomes comuns)
            local collectRemote = ReplicatedStorage:FindFirstChild("Collect") or ReplicatedStorage:FindFirstChild("Pickup")
            
            if not collectRemote then
                warn("SlenderHub: Collect remote not found. Auto Collectibles may not work.")
            end

            while _G.AutoCollect and LocalPlayer.Character do
                pcall(function()
                    local colFolder = Workspace:FindFirstChild("_") and Workspace._:FindFirstChild("CollectiblesClient")
                    local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")

                    if colFolder and hrp then
                        for _, item in pairs(colFolder:GetChildren()) do
                            if item:IsA("BasePart") and item.Parent == colFolder then -- Ensure it's a valid collectible
                                -- Attempt to fire a remote for collection
                                if collectRemote and collectRemote:IsA("RemoteEvent") then
                                    -- Assumes the remote takes the item instance or its name/id
                                    collectRemote:FireServer(item) 
                                elseif collectRemote and collectRemote:IsA("RemoteFunction") then
                                    collectRemote:InvokeServer(item)
                                end
                                -- Optionally, you can still pivot for instant visual collection effect
                                item:PivotTo(hrp.CFrame) 
                            end
                        end
                    end
                end)
                task.wait(0.5) -- Delay entre as varreduras de coletáveis
            end
        end)
    end
end)

--================= EGGS TAB =================--
local EggsSection = TabEggs:NewSection("Egg Hatching")

EggsSection:NewDropdown("Select Egg", EggsList, _G.SelectedEgg, function(Option)
    _G.SelectedEgg = Option
end)

EggsSection:NewSlider("Amount to Open", 1, 100, _G.EggAmount, function(Value)
    _G.EggAmount = Value
end)

EggsSection:NewToggle("Auto Hatch", false, function(Value)
    _G.AutoEgg = Value
    if Value then
        task.spawn(function()
            while _G.AutoEgg and LocalPlayer.Character do
                pcall(function()
                    local eggFolder = Workspace:FindFirstChild("_") and Workspace._:FindFirstChild("Eggs")
                    if eggFolder and eggFolder:FindFirstChild(_G.SelectedEgg) then
                        local eggInstance = eggFolder[_G.SelectedEgg]
                        Functions.BuyEgg:InvokeServer(eggInstance, _G.EggAmount)
                    end
                end)
                task.wait(0.05) -- Pequeno delay para evitar spam excessivo no server
            end
        end)
    end
end)

--================= SHOP & UPGRADES TAB =================--
local ShopSection = TabShop:NewSection("Merchant")

ShopSection:NewToggle("Auto Buy Merchant (All Items)", false, function(Value)
    _G.AutoMerchant = Value
    if Value then
        task.spawn(function()
            while _G.AutoMerchant do
                pcall(function()
                    -- Compra todos os 15 slots baseados no MerchantData
                    for i = 1, 15 do
                        Functions.BuyMerchant:InvokeServer("Merchant", i)
                    end
                end)
                task.wait(2) -- Delay de 2s para não dar spam excessivo no server
            end
        end)
    end
end)

local UpgradeSection = TabShop:NewSection("Upgrades")

UpgradeSection:NewDropdown("Select Upgrade", UpgradesList, _G.SelectedUpgrade, function(Option)
    _G.SelectedUpgrade = Option
end)

UpgradeSection:NewToggle("Auto Buy Upgrade", false, function(Value)
    _G.AutoUpgrade = Value
    if Value then
        task.spawn(function()
            while _G.AutoUpgrade do
                pcall(function()
                    Functions.BuyUpgrade:InvokeServer(_G.SelectedUpgrade)
                end)
                task.wait(1) -- Delay de 1s para comprar upgrades
            end
        end)
    end
end)

--================= PLAYER TAB =================--
local PlayerStatsSection = TabPlayer:NewSection("Player Stats")

PlayerStatsSection:NewSlider("WalkSpeed", 16, 200, _G.WalkSpeed, function(Value)
    _G.WalkSpeed = Value
    UpdatePlayerStats()
end)

PlayerStatsSection:NewSlider("JumpPower", 50, 300, _G.JumpPower, function(Value)
    _G.JumpPower = Value
    UpdatePlayerStats()
end)

local AntiAFKSection = TabPlayer:NewSection("Anti-AFK")

AntiAFKSection:NewToggle("Anti-AFK (Jump a cada 5 minutos)", false, function(Value)
    _G.AntiAFKMovement = Value
    if Value then
        task.spawn(function()
            while _G.AntiAFKMovement do
                task.wait(300) -- Espera 5 minutos (300 segundos)
                if _G.AntiAFKMovement and LocalPlayer.Character then -- Verifica novamente caso o toggle tenha sido desativado durante a espera
                    local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                    if hum and hum.Health > 0 then
                        -- Simula um pequeno pulo para manter a atividade
                        hum.Jump = true
                        task.wait(0.1) -- Mantém o pulo por um breve momento
                        hum.Jump = false
                    end
                end
            end
        end)
    end
end)

-- Initial stat update
UpdatePlayerStats()

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Espera o jogo carregar
repeat task.wait() until game:IsLoaded()

-- Serviços do Roblox
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer

-- Variáveis de Controle globais (getgenv)
local getgenv = getgenv or function() return _G end
getgenv().AutoClick = false
getgenv().AutoEgg = false
getgenv().SelectedEgg = "Common Egg"
getgenv().EggAmount = 100
getgenv().AutoMerchant = false
getgenv().AutoCollect = false
getgenv().AutoUpgrade = false
getgenv().SelectedUpgrade = "Coins1"
getgenv().AntiAFKMovement = false
getgenv().AutoCreateClan = false
getgenv().ClanNameToCreate = "SlenderHub Clan" -- Nome de clã padrão
getgenv().AutoAcceptInvites = false
getgenv().AutoLeaveClan = false
getgenv().WalkSpeed = 16 -- Adicionado para armazenar o valor do WalkSpeed
getgenv().JumpPower = 50  -- Adicionado para armazenar o valor do JumpPower

-- Anti-AFK padrão (desabilita o evento de ociosidade do jogador)
for _, con in pairs(getconnections(LocalPlayer.Idled)) do
    con:Disable()
end

-- Espera pelos remotes necessários ANTES de criar a GUI para evitar que a GUI não apareça devido a yield
local Remotes = ReplicatedStorage:WaitForChild("Remotes", 10)
local Functions = Remotes:WaitForChild("Functions", 10)
local Events = Remotes:WaitForChild("Events", 10)

-- Remotes específicos
local ClickRemote = Functions:WaitForChild("Click", 10)
local CollectCollectibleRemote = Functions:WaitForChild("CollectCollectible", 10)
local BuyEggRemote = Functions:WaitForChild("BuyEgg", 10)
local BuyMerchantRemote = Functions:WaitForChild("BuyMerchant", 10)
local BuyUpgradeRemote = Functions:WaitForChild("BuyUpgrade", 10)
local ClanRemote = Functions:WaitForChild("ClanInvoke", 10) -- Remote para operações de clã

-- Eventos específicos
local LoadCollectiblesEvent = Events:WaitForChild("LoadCollectibles", 10)
local UpdateClansEvent = Events:WaitForChild("UpdateClans", 10) -- Evento para atualizações de clãs, incluindo convites

-- Tabelas de Dados extraídas da sua Dex (ATUALIZADAS)
local AllEggs = {
    "Common Egg", "Spotted Egg", "Rocky Egg", "Mushroom Egg", "Leaf Egg",
    "Arctic Egg", "Icy Egg", "Release Egg", "Lovely Egg", "Valentines Egg",
    "100K Egg", "Desert Egg", "Fiery Egg", "Magma Egg", "500K Egg",
    "Crystal Egg", "Floral Egg", "Mystical Egg", "Season 1 Egg",
    "Bounty Pets", "Exclusive Pets"
}

local AllUpgrades = {
    "Coins1", "EggHatch1", "Gems1", "HatchSpeed1", "Coins2", "Luck1",
    "Shiny1", "HatchSpeed2", "Coins3", "Gems2", "Luck2", "Shiny2",
    "Hatcher1", "Shiny3", "Coins4", "Luck3", "EggHatch2", "Shiny4",
    "Coins5", "Luck4", "EggHatch3", "HiddenLuck", "HiddenShinyLuck", "HiddenHatchSpeed"
}

--========================================================--
--                  CARREGANDO RAYFIELD UI                --
--========================================================--
local Window = Rayfield:CreateWindow({
   Name = "SlenderHub | Royal Hatchers",
   LoadingTitle = "Inicializando Interface...",
   LoadingSubtitle = "Por SlenderHub Architect",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "SlenderHubConfig", -- Cria uma pasta no workspace do executor
      FileName = "MainConfig"
   },
   Discord = {
      Enabled = false,
      Invite = "noinvite",
      RememberJoins = true 
   },
   KeySystem = false,
   KeySettings = {
      Title = "Verificação de Segurança",
      Subtitle = "Sistema de Chaves",
      Note = "Entre no Discord para obter a chave.",
      FileName = "Key", 
      SaveKey = true, 
      GrabKeyFromSite = false,
      Key = {"Hello"} -- Chaves aceitas (placeholder)
   }
})

--================= TABS =================--
local FarmingTab = Window:CreateTab("Farming")
local EggsTab = Window:CreateTab("Eggs")
local ShopUpgradesTab = Window:CreateTab("Shop & Upgrades")
local ClansTab = Window:CreateTab("Clans")
local PlayerTab = Window:CreateTab("Player")

--================= FARMING TAB =================--
FarmingTab:CreateToggle({
    Name = "Auto Click",
    CurrentValue = getgenv().AutoClick,
    Flag = "AutoClickToggle", -- Para salvar a configuração
    Callback = function(Value)
        getgenv().AutoClick = Value
        print("SlenderHub: Auto Click Toggled:", Value)
        if Value then
            task.spawn(function()
                while getgenv().AutoClick do
                    local success, err = pcall(function()
                        ClickRemote:InvokeServer()
                    end)
                    if not success then
                        warn("SlenderHub: Auto Click failed:", err)
                    end
                    task.wait() -- Sem delay para máxima velocidade de click
                end
            end)
        end
    end,
})

-- Implementação melhorada do Auto Collectibles, usando o Remote "CollectCollectible"
local collectibleIdsToCollect = {} -- Armazena os IDs dos coletáveis para coleta

-- Escuta o evento LoadCollectibles para popular a lista de IDs
LoadCollectiblesEvent.OnClientEvent:Connect(function(collectiblesData)
    -- Limpa a lista existente antes de popular com novos dados, se necessário
    collectibleIdsToCollect = {} 
    for _, data in pairs(collectiblesData) do
        table.insert(collectibleIdsToCollect, data.ID)
    end
    print("SlenderHub: Loaded", #collectibleIdsToCollect, "collectibles.")
end)

FarmingTab:CreateToggle({
    Name = "Auto Collectibles (Gems/Drops)",
    CurrentValue = getgenv().AutoCollect,
    Flag = "AutoCollectToggle",
    Callback = function(Value)
        getgenv().AutoCollect = Value
        print("SlenderHub: Auto Collectibles Toggled:", Value)
        if Value then
            task.spawn(function()
                while getgenv().AutoCollect do
                    for _, collectibleId in ipairs(collectibleIdsToCollect) do
                        local success, err = pcall(function()
                            CollectCollectibleRemote:InvokeServer(collectibleId)
                        end)
                        if not success then
                            warn("SlenderHub: Auto Collectible failed for ID", collectibleId, ":", err)
                        end
                        task.wait(0.1) -- Pequeno delay para evitar flood
                    end
                    task.wait(1) -- Espera antes de re-checar
                end
            end)
        end
    end,
})

FarmingTab:CreateSection("Collectibles") -- Rayfield section

FarmingTab:CreateButton({
    Name = "Force Collect Now",
    Callback = function()
        warn("SlenderHub: Attempting to force collect", #collectibleIdsToCollect, "collectibles...")
        for _, collectibleId in ipairs(collectibleIdsToCollect) do
            local success, err = pcall(function()
                CollectCollectibleRemote:InvokeServer(collectibleId)
            end)
            if not success then
                warn("SlenderHub: Force Collectible failed for ID", collectibleId, ":", err)
            end
            task.wait(0.05) -- Pequeno delay
        end
        warn("SlenderHub: Force collection attempt finished.")
    end,
})

FarmingTab:CreateToggle({
    Name = "Auto Buy Merchant",
    CurrentValue = getgenv().AutoMerchant,
    Flag = "AutoMerchantToggle",
    Callback = function(Value)
        getgenv().AutoMerchant = Value
        print("SlenderHub: Auto Buy Merchant Toggled:", Value)
        if Value then
            task.spawn(function()
                while getgenv().AutoMerchant do
                    local success, result = pcall(function()
                        return BuyMerchantRemote:InvokeServer()
                    end)
                    if not success then
                        warn("SlenderHub: Auto Buy Merchant failed:", result)
                    else
                        if result == true then
                            print("SlenderHub: Merchant bought successfully!")
                        else
                            warn("SlenderHub: Failed to buy merchant:", result)
                        end
                    end
                    task.wait(30) -- Wait 30 seconds before trying again (adjust as needed)
                end
            end)
        end
    end,
})

--================= EGGS TAB =================--
EggsTab:CreateToggle({
    Name = "Auto Hatch Eggs",
    CurrentValue = getgenv().AutoEgg,
    Flag = "AutoEggToggle",
    Callback = function(Value)
        getgenv().AutoEgg = Value
        print("SlenderHub: Auto Hatch Eggs Toggled:", Value)
        if Value then
            task.spawn(function()
                while getgenv().AutoEgg do
                    local success, result = pcall(function()
                        return BuyEggRemote:InvokeServer(getgenv().SelectedEgg, getgenv().EggAmount)
                    end)
                    if not success then
                        warn("SlenderHub: Auto Egg failed:", result)
                    else
                        if result == true then
                            print("SlenderHub: Successfully bought and hatched", getgenv().EggAmount, getgenv().SelectedEgg, "(s).")
                        elseif type(result) == "string" then
                            warn("SlenderHub: Failed to auto hatch egg:", result)
                        else
                            warn("SlenderHub: Failed to auto hatch egg: Unknown error (returned type:", type(result), ")")
                        end
                    end
                    task.wait(0.5) -- Small delay between attempts
                end
            end)
        end
    end,
})

EggsTab:CreateDropdown({
    Name = "Select Egg",
    Options = AllEggs,
    CurrentOption = {getgenv().SelectedEgg}, -- Rayfield espera uma tabela para CurrentOption
    MultipleOptions = false,
    Flag = "SelectedEggDD",
    Callback = function(Option)
        getgenv().SelectedEgg = Option[1] -- Rayfield retorna uma tabela com as seleções
        print("SlenderHub: Selected Egg:", getgenv().SelectedEgg)
    end,
})

EggsTab:CreateSlider({
    Name = "Egg Amount",
    Range = {1, 1000},
    Increment = 1,
    Suffix = " Eggs",
    CurrentValue = getgenv().EggAmount,
    Flag = "EggAmountSlider",
    Callback = function(Value)
        getgenv().EggAmount = Value
        print("SlenderHub: Egg Amount set to:", Value)
    end,
})

EggsTab:CreateButton({
    Name = "Buy Eggs Once",
    Callback = function()
        local success, result = pcall(function()
            return BuyEggRemote:InvokeServer(getgenv().SelectedEgg, getgenv().EggAmount)
        end)
        if not success then
            warn("SlenderHub: Manual Buy Egg failed:", result)
        else
            if result == true then
                warn("SlenderHub: Manually bought and hatched", getgenv().EggAmount, getgenv().SelectedEgg, "(s).")
            elseif type(result) == "string" then
                warn("SlenderHub: Failed to buy egg manually:", result)
            else
                warn("SlenderHub: Failed to buy egg manually: Unknown error (returned type:", type(result), ")")
            end
        end
    end,
})

--================= SHOP & UPGRADES TAB =================--
ShopUpgradesTab:CreateToggle({
    Name = "Auto Upgrade",
    CurrentValue = getgenv().AutoUpgrade,
    Flag = "AutoUpgradeToggle",
    Callback = function(Value)
        getgenv().AutoUpgrade = Value
        print("SlenderHub: Auto Upgrade Toggled:", Value)
        if Value then
            task.spawn(function()
                while getgenv().AutoUpgrade do
                    local success, result = pcall(function()
                        return BuyUpgradeRemote:InvokeServer(getgenv().SelectedUpgrade)
                    end)
                    if not success then
                        warn("SlenderHub: Auto Upgrade failed:", result)
                    else
                        if result == true then
                            print("SlenderHub: Successfully bought upgrade:", getgenv().SelectedUpgrade)
                        elseif type(result) == "string" then
                            warn("SlenderHub: Failed to auto upgrade:", result)
                        else
                            warn("SlenderHub: Failed to auto upgrade: Unknown error (returned type:", type(result), ")")
                        end
                    end
                    task.wait(1) -- Small delay between attempts
                end
            end)
        end
    end,
})

ShopUpgradesTab:CreateDropdown({
    Name = "Select Upgrade",
    Options = AllUpgrades,
    CurrentOption = {getgenv().SelectedUpgrade},
    MultipleOptions = false,
    Flag = "SelectedUpgradeDD",
    Callback = function(Option)
        getgenv().SelectedUpgrade = Option[1]
        print("SlenderHub: Selected Upgrade:", getgenv().SelectedUpgrade)
    end,
})

ShopUpgradesTab:CreateButton({
    Name = "Buy Upgrade Once",
    Callback = function()
        local success, result = pcall(function()
            return BuyUpgradeRemote:InvokeServer(getgenv().SelectedUpgrade)
        end)
        if not success then
            warn("SlenderHub: Manual Buy Upgrade failed:", result)
        else
            if result == true then
                warn("SlenderHub: Manually bought upgrade:", getgenv().SelectedUpgrade)
            elseif type(result) == "string" then
                warn("SlenderHub: Failed to buy upgrade manually:", result)
            else
                warn("SlenderHub: Failed to buy upgrade manually: Unknown error (returned type:", type(result), ")")
            end
        end
    end,
})

--================= CLANS TAB =================--
ClansTab:CreateToggle({
    Name = "Auto Create Clan",
    CurrentValue = getgenv().AutoCreateClan,
    Flag = "AutoCreateClanToggle",
    Callback = function(Value)
        getgenv().AutoCreateClan = Value
        print("SlenderHub: Auto Create Clan Toggled:", Value)
        if Value then
            task.spawn(function()
                while getgenv().AutoCreateClan do
                    task.wait(1)
                    -- Verifica se o jogador já está em um clã
                    if not LocalPlayer:GetAttribute("Clan") then
                        local success, result = pcall(function()
                            return ClanRemote:InvokeServer("CreateClan", getgenv().ClanNameToCreate)
                        end)
                        if success then
                            if result == true then
                                warn("SlenderHub: Clã '" .. getgenv().ClanNameToCreate .. "' criado com sucesso!")
                                getgenv().AutoCreateClan = false -- Para o auto-criar após o sucesso
                                -- Opcional: Atualizar o estado do toggle na UI
                            elseif type(result) == "string" then
                                warn("SlenderHub: Falha ao criar clã:", result)
                            else
                                warn("SlenderHub: Falha ao criar clã: Unknown error (returned type:", type(result), ")")
                            end
                        else
                            warn("SlenderHub: pcall failed for CreateClan:", result)
                        end
                    else
                        -- print("SlenderHub: Já está em um clã, parando auto-criar.")
                        getgenv().AutoCreateClan = false
                        -- Opcional: Atualizar o estado do toggle na UI
                    end
                    task.wait(5) -- Espera antes da próxima tentativa se não for bem-sucedido
                end
            end)
        end
    end,
})

ClansTab:CreateInput({
    Name = "Clan Name to Create",
    PlaceholderText = "SlenderHub Clan",
    CurrentValue = getgenv().ClanNameToCreate,
    RemoveTextAfterFocusLost = false,
    Flag = "ClanNameInput",
    Callback = function(Text)
        getgenv().ClanNameToCreate = Text
        print("SlenderHub: Clan Name for creation set to:", Text)
    end,
})

-- Listener para aceitar convites automaticamente
UpdateClansEvent.OnClientEvent:Connect(function(clansTable)
    if not getgenv().AutoAcceptInvites then return end

    for clanName, clanData in pairs(clansTable) do
        -- Assumindo que `clanData.Invited` indica um convite para o LocalPlayer
        if clanData.Invited and not LocalPlayer:GetAttribute("Clan") then
            warn("SlenderHub: Auto-accepting invite for clan:", clanName)
            local success, result = pcall(function()
                return ClanRemote:InvokeServer("JoinClan", clanName)
            end)
            if success then
                if result == true then
                    warn("SlenderHub: Convite para o clã '" .. clanName .. "' aceito com sucesso!")
                elseif type(result) == "string" then
                    warn("SlenderHub: Falha ao aceitar convite para o clã '" .. clanName .. "':", result)
                else
                    warn("SlenderHub: Falha ao aceitar convite para o clã '" .. clanName .. "': Unknown error (returned type:", type(result), ")")
                end
            else
                warn("SlenderHub: pcall failed for JoinClan:", result)
            end
            task.wait(0.5) -- Pequeno delay entre aceitar convites
        end
    end
end)

ClansTab:CreateToggle({
    Name = "Auto Accept Clan Invites",
    CurrentValue = getgenv().AutoAcceptInvites,
    Flag = "AutoAcceptInvitesToggle",
    Callback = function(Value)
        getgenv().AutoAcceptInvites = Value
        print("SlenderHub: Auto Accept Clan Invites Toggled:", Value)
    end,
})

ClansTab:CreateToggle({
    Name = "Auto Leave/Delete Clan",
    CurrentValue = getgenv().AutoLeaveClan,
    Flag = "AutoLeaveClanToggle",
    Callback = function(Value)
        getgenv().AutoLeaveClan = Value
        print("SlenderHub: Auto Leave/Delete Clan Toggled:", Value)
        if Value then
            task.spawn(function()
                while getgenv().AutoLeaveClan do
                    task.wait(1)
                    -- Verifica se o jogador está em um clã
                    if LocalPlayer:GetAttribute("Clan") then
                        local success, result = pcall(function()
                            return ClanRemote:InvokeServer("LeaveClan")
                        end)
                        if success then
                            if result == true then
                                warn("SlenderHub: Clã deixado/deletado com sucesso.")
                            elseif type(result) == "string" then
                                warn("SlenderHub: Falha ao deixar/deletar clã:", result)
                            else
                                warn("SlenderHub: Falha ao deixar/deletar clã: Unknown error (returned type:", type(result), ")")
                            end
                        else
                            warn("SlenderHub: pcall failed for LeaveClan:", result)
                        end
                    else
                        -- print("SlenderHub: Not in a clan to leave.") -- Descomente para debug
                    end
                end
            end)
        end
    end,
})

--================= PLAYER TAB =================--
PlayerTab:CreateSlider({
    Name = "WalkSpeed",
    Range = {16, 200},
    Increment = 1,
    Suffix = " WS",
    CurrentValue = getgenv().WalkSpeed,
    Flag = "WalkSpeedSlider",
    Callback = function(Value)
        getgenv().WalkSpeed = Value -- Armazena o valor globalmente
        local char = LocalPlayer.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.WalkSpeed = Value
            print("SlenderHub: WalkSpeed set to:", Value)
        end
    end,
})

PlayerTab:CreateSlider({
    Name = "JumpPower",
    Range = {50, 300},
    Increment = 1,
    Suffix = " JP",
    CurrentValue = getgenv().JumpPower,
    Flag = "JumpPowerSlider",
    Callback = function(Value)
        getgenv().JumpPower = Value -- Armazena o valor globalmente
        local char = LocalPlayer.Character
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.JumpPower = Value
            hum.UseJumpPower = true -- Garante que o JumpPower seja usado
            print("SlenderHub: JumpPower set to:", Value)
        end
    end,
})

PlayerTab:CreateToggle({
    Name = "Anti-AFK (Jump a cada 5 minutos)",
    CurrentValue = getgenv().AntiAFKMovement,
    Flag = "AntiAFKMovementToggle",
    Callback = function(Value)
        getgenv().AntiAFKMovement = Value
        print("SlenderHub: Anti-AFK (Jump) Toggled:", Value)
        if Value then
            task.spawn(function()
                while getgenv().AntiAFKMovement do
                    task.wait(300) -- Espera 5 minutos (300 segundos)
                    if getgenv().AntiAFKMovement then
                        local char = LocalPlayer.Character
                        local hum = char and char:FindFirstChildOfClass("Humanoid")
                        if hum and hum.Health > 0 then
                            -- Simula um pequeno pulo para manter a atividade
                            hum.Jump = true
                            task.wait(0.1)
                            hum.Jump = false
                            print("SlenderHub: Performed Anti-AFK jump.")
                        end
                    end
                end
            end)
        end
    end,
})

-- Função para aplicar WalkSpeed e JumpPower ao Humanoid
local function applyPlayerStats(character)
    local humanoid = character:WaitForChild("Humanoid", 5)
    if humanoid then
        humanoid.WalkSpeed = getgenv().WalkSpeed
        humanoid.JumpPower = getgenv().JumpPower
        humanoid.UseJumpPower = true
        print("SlenderHub: Applied WalkSpeed", getgenv().WalkSpeed, "and JumpPower", getgenv().JumpPower, "to new character.")
    else
        warn("SlenderHub: Humanoid not found in new character for stat application.")
    end
end

-- Conecta para aplicar WalkSpeed/JumpPower sempre que o personagem for adicionado/respawna
LocalPlayer.CharacterAdded:Connect(applyPlayerStats)

-- Aplica as stats se o personagem já existir no momento da execução do script
if LocalPlayer.Character then
    applyPlayerStats(LocalPlayer.Character)
end

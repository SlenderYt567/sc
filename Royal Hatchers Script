-- Espera o jogo carregar
repeat task.wait() until game:IsLoaded()

-- Serviços do Roblox
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Remotes = ReplicatedStorage:WaitForChild("Remotes")
local Functions = Remotes:WaitForChild("Functions")

-- Tabelas de Dados extraídas da sua Dex
local EggsList = {
    "Common Egg", "Spotted Egg", "Rocky Egg", "Mushroom Egg", "Leaf Egg", 
    "Arctic Egg", "Icy Egg", "Release Egg", "Lovely Egg", "Valentines Egg", 
    "100K Egg", "Desert Egg", "Fiery Egg", "Magma Egg", "500K Egg"
}

local UpgradesList = {
    "Coins1", "EggHatch1", "Gems1", "HatchSpeed1", "Coins2", "Luck1", 
    "Shiny1", "HatchSpeed2", "Coins3", "Gems2", "Luck2", "Shiny2", 
    "Hatcher1", "Shiny3", "Coins4", "Luck3", "EggHatch2", "HiddenLuck", 
    "HiddenShinyLuck", "HiddenHatchSpeed"
}

-- Variáveis de Controle
local getgenv = getgenv or function() return _G end
getgenv().AutoClick = false
getgenv().AutoEgg = false
getgenv().SelectedEgg = "Common Egg"
getgenv().EggAmount = 100
getgenv().AutoMerchant = false
getgenv().AutoCollect = false
getgenv().AutoUpgrade = false
getgenv().SelectedUpgrade = "Coins1"
getgenv().AntiAFKMovement = false -- Nova variável de controle para o Anti-AFK

-- Anti-AFK padrão (desabilita o evento de ociosidade do jogador)
for _, con in pairs(getconnections(LocalPlayer.Idled)) do
    con:Disable()
end

--========================================================--
--                  CARREGANDO RAYFIELD UI                --
--========================================================--
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "SlenderHub | Royal Hatchers",
    LoadingTitle = "SlenderHub Loading...",
    LoadingSubtitle = "by Slender",
    ConfigurationSaving = {
        Enabled = false,
        FolderName = nil,
        FileName = "SlenderHub"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink",
        RememberJoins = true
    },
    KeySystem = false
})

--================= TABS =================--
local TabFarming = Window:CreateTab("Farming", 4483362458)
local TabEggs = Window:CreateTab("Eggs", 4483362458)
local TabShop = Window:CreateTab("Shop & Upgrades", 4483362458)
local TabPlayer = Window:CreateTab("Player", 4483362458)

--================= FARMING TAB =================--
TabFarming:CreateToggle({
    Name = "Auto Click",
    CurrentValue = false,
    Flag = "ToggleAutoClick",
    Callback = function(Value)
        getgenv().AutoClick = Value
        task.spawn(function()
            while getgenv().AutoClick do
                pcall(function()
                    Functions.Click:InvokeServer()
                end)
                task.wait() -- Sem delay para máxima velocidade
            end
        end)
    end
})

TabFarming:CreateToggle({
    Name = "Auto Collectibles (Gems/Drops)",
    CurrentValue = false,
    Flag = "ToggleAutoCollect",
    Callback = function(Value)
        getgenv().AutoCollect = Value
        task.spawn(function()
            while getgenv().AutoCollect do
                pcall(function()
                    local colFolder = Workspace:FindFirstChild("_") and Workspace._:FindFirstChild("CollectiblesClient")
                    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                    
                    -- Teleporta os coletáveis para o jogador (baseado na Dex de Collectibles)
                    if colFolder and hrp then
                        for _, item in pairs(colFolder:GetChildren()) do
                            if item:IsA("BasePart") or item:IsA("Model") then
                                item:PivotTo(hrp.CFrame)
                            end
                        end
                    end
                end)
                task.wait(0.5)
            end
        end)
    end
})

--================= EGGS TAB =================--
TabEggs:CreateDropdown({
    Name = "Select Egg",
    Options = EggsList,
    CurrentOption = {"Common Egg"},
    MultipleOptions = false,
    Flag = "DropdownEgg",
    Callback = function(Option)
        -- O Rayfield retorna uma tabela, então pegamos o primeiro item selecionado
        getgenv().SelectedEgg = Option[1]
    end
})

TabEggs:CreateSlider({
    Name = "Amount to Open",
    Range = {1, 100},
    Increment = 1,
    Suffix = " Eggs",
    CurrentValue = 100,
    Flag = "SliderEggAmount",
    Callback = function(Value)
        getgenv().EggAmount = Value
    end
})

TabEggs:CreateToggle({
    Name = "Auto Hatch",
    CurrentValue = false,
    Flag = "ToggleAutoHatch",
    Callback = function(Value)
        getgenv().AutoEgg = Value
        task.spawn(function()
            while getgenv().AutoEgg do
                pcall(function()
                    local eggFolder = Workspace:FindFirstChild("_") and Workspace._:FindFirstChild("Eggs")
                    if eggFolder and eggFolder:FindFirstChild(getgenv().SelectedEgg) then
                        local args = {
                            eggFolder[getgenv().SelectedEgg],
                            getgenv().EggAmount
                        }
                        Functions.BuyEgg:InvokeServer(unpack(args))
                    end
                end)
                task.wait(0.1)
            end
        end)
    end
})

--================= SHOP & UPGRADES TAB =================--
TabShop:CreateToggle({
    Name = "Auto Buy Merchant (All Items)",
    CurrentValue = false,
    Flag = "ToggleMerchant",
    Callback = function(Value)
        getgenv().AutoMerchant = Value
        task.spawn(function()
            while getgenv().AutoMerchant do
                pcall(function()
                    -- Compra todos os 15 slots baseados no MerchantData
                    for i = 1, 15 do
                        Functions.BuyMerchant:InvokeServer("Merchant", i)
                    end
                end)
                task.wait(2) -- Delay de 2s para não dar spam excessivo no server
            end
        end)
    end
})

TabShop:CreateDropdown({
    Name = "Select Upgrade",
    Options = UpgradesList,
    CurrentOption = {"Coins1"},
    MultipleOptions = false,
    Flag = "DropdownUpgrade",
    Callback = function(Option)
        getgenv().SelectedUpgrade = Option[1]
    end
})

TabShop:CreateToggle({
    Name = "Auto Buy Upgrade",
    CurrentValue = false,
    Flag = "ToggleUpgrade",
    Callback = function(Value)
        getgenv().AutoUpgrade = Value
        task.spawn(function()
            while getgenv().AutoUpgrade do
                pcall(function()
                    Functions.BuyUpgrade:InvokeServer(getgenv().SelectedUpgrade)
                end)
                task.wait(1)
            end
        end)
    end
})

--================= PLAYER TAB =================--
TabPlayer:CreateSlider({
    Name = "WalkSpeed",
    Range = {16, 200},
    Increment = 1,
    Suffix = " WS",
    CurrentValue = 16,
    Flag = "SliderWS",
    Callback = function(Value)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = Value
        end
    end
})

TabPlayer:CreateSlider({
    Name = "JumpPower",
    Range = {50, 300},
    Increment = 1,
    Suffix = " JP",
    CurrentValue = 50,
    Flag = "SliderJP",
    Callback = function(Value)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.JumpPower = Value
            LocalPlayer.Character.Humanoid.UseJumpPower = true
        end
    end
})

TabPlayer:CreateToggle({
    Name = "Anti-AFK (Jump a cada 5 minutos)",
    CurrentValue = false,
    Flag = "ToggleAntiAFK",
    Callback = function(Value)
        getgenv().AntiAFKMovement = Value
        if Value then
            task.spawn(function()
                while getgenv().AntiAFKMovement do
                    task.wait(300) -- Espera 5 minutos (300 segundos)
                    if getgenv().AntiAFKMovement then -- Verifica novamente caso o toggle tenha sido desativado durante a espera
                        local char = LocalPlayer.Character
                        local hum = char and char:FindFirstChildOfClass("Humanoid")
                        if hum and hum.Health > 0 then
                            -- Simula um pequeno pulo para manter a atividade
                            hum.Jump = true
                            task.wait(0.1) -- Mantém o pulo por um breve momento
                            hum.Jump = false
                        end
                    end
                end
            end)
        end
    end
})

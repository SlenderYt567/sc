-- Espera o jogo carregar
repeat task.wait() until game:IsLoaded()

-- Serviços do Roblox
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Remotes = ReplicatedStorage:WaitForChild("Remotes")
local Functions = Remotes:WaitForChild("Functions")

-- Tabelas de Dados extraídas da sua Dex (ATUALIZADAS)
local EggsList = {
    "Common Egg", "Spotted Egg", "Rocky Egg", "Mushroom Egg", "Leaf Egg",
    "Arctic Egg", "Icy Egg", "Release Egg", "Lovely Egg", "Valentines Egg",
    "100K Egg", "Desert Egg", "Fiery Egg", "Magma Egg", "500K Egg",
    "Crystal Egg", "Floral Egg", "Mystical Egg", "Season 1 Egg", "Bounty Pets", "Exclusive Pets"
}

local UpgradesList = {
    "Coins1", "EggHatch1", "Gems1", "HatchSpeed1", "Coins2", "Luck1",
    "Shiny1", "HatchSpeed2", "Coins3", "Gems2", "Luck2", "Shiny2",
    "Hatcher1", "Shiny3", "Coins4", "Luck3", "EggHatch2",
    "Shiny4", "Coins5", "Luck4", "EggHatch3", -- Novas adições
    "HiddenLuck", "HiddenShinyLuck", "HiddenHatchSpeed" -- Upgrades "escondidos"
}

-- Variáveis de Controle Global (usando _G para compatibilidade)
getgenv().AutoClick = false
getgenv().AutoEgg = false
getgenv().SelectedEgg = "Common Egg"
getgenv().EggAmount = 100
getgenv().AutoMerchant = false
getgenv().AutoCollect = false
getgenv().AutoUpgrade = false
getgenv().SelectedUpgrade = "Coins1"
getgenv().AntiAFKMovement = false
getgenv().WalkSpeed = 16 -- Valor inicial para WalkSpeed
getgenv().JumpPower = 50 -- Valor inicial para JumpPower

-- Anti-AFK padrão (desabilita o evento de ociosidade do jogador)
for _, con in pairs(getconnections(LocalPlayer.Idled)) do
    con:Disable()
end

-- Função para atualizar WalkSpeed/JumpPower no personagem atual e futuros
local function UpdatePlayerStats()
    local character = LocalPlayer.Character
    if character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = getgenv().WalkSpeed
            humanoid.JumpPower = getgenv().JumpPower
            humanoid.UseJumpPower = true -- Garante que JumpPower seja usado
        end
    end
end

-- Conecta a um evento para aplicar WalkSpeed/JumpPower quando o personagem for adicionado
LocalPlayer.CharacterAdded:Connect(function(character)
    -- Espera o Humanoid estar presente no novo personagem
    character:WaitForChild("Humanoid").WalkSpeed = getgenv().WalkSpeed
    character:WaitForChild("Humanoid").JumpPower = getgenv().JumpPower
    character:WaitForChild("Humanoid").UseJumpPower = true
end)

--========================================================--
--                  CARREGANDO RAYFIELD UI                --
--========================================================--
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "SlenderHub | Royal Hatchers",
    LoadingTitle = "SlenderHub Loading...",
    LoadingSubtitle = "by Slender",
    ConfigurationSaving = {
        Enabled = false, -- Desabilitado para garantir que as configurações sejam resetadas a cada injeção
        FolderName = nil,
        FileName = "SlenderHub"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink", -- Adicione um convite de Discord real se desejar
        RememberJoins = true
    },
    KeySystem = false
})

--================= TABS =================--
local TabFarming = Window:CreateTab("Farming", 4483362458)
local TabEggs = Window:CreateTab("Eggs", 4483362458)
local TabShop = Window:CreateTab("Shop & Upgrades", 4483362458)
local TabPlayer = Window:CreateTab("Player", 4483362458)

--================= FARMING TAB =================--
TabFarming:CreateToggle({
    Name = "Auto Click",
    CurrentValue = false,
    Flag = "ToggleAutoClick",
    Callback = function(Value)
        getgenv().AutoClick = Value
        if Value then
            task.spawn(function()
                while getgenv().AutoClick and LocalPlayer.Character do -- Garante que o personagem existe
                    pcall(function()
                        Functions.Click:InvokeServer()
                    end)
                    task.wait(0.05) -- Delay de 0.05s para evitar spam excessivo no server e detecção
                end
            end)
        end
    end
})

TabFarming:CreateToggle({
    Name = "Auto Collectibles (Gems/Drops)",
    CurrentValue = false,
    Flag = "ToggleAutoCollect",
    Callback = function(Value)
        getgenv().AutoCollect = Value
        if Value then
            task.spawn(function()
                -- O remote de coleta revelado é Functions.CollectCollectible
                local collectRemoteFunction = Functions.CollectCollectible

                while getgenv().AutoCollect and LocalPlayer.Character do
                    pcall(function()
                        local colFolder = Workspace:FindFirstChild("_") and Workspace._:FindFirstChild("CollectiblesClient")
                        local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")

                        if colFolder and hrp then
                            for _, item in pairs(colFolder:GetChildren()) do
                                if item:IsA("BasePart") and item.Parent == colFolder then -- Verifica se é um item válido no container
                                    local collectibleID = item:GetAttribute("ID") -- Tenta pegar o ID como atributo (comum para UUIDs)
                                    if not collectibleID then
                                        -- Fallback: Se não for atributo, verifica se é um StringValue filho
                                        local idValue = item:FindFirstChild("ID")
                                        if idValue and idValue:IsA("StringValue") then
                                            collectibleID = idValue.Value
                                        end
                                    end

                                    if collectibleID then
                                        -- Invoca o servidor com o ID do coletável para que ele seja efetivamente coletado
                                        collectRemoteFunction:InvokeServer(collectibleID)
                                        
                                        -- Opcional: Ainda faz o PivotTo para um efeito visual de coleta instantânea no cliente
                                        item:PivotTo(hrp.CFrame)
                                    end
                                end
                            end
                        end
                    end)
                    task.wait(0.5) -- Delay entre as varreduras de coletáveis
                end
            end)
        end
    end
})

--================= EGGS TAB =================--
TabEggs:CreateDropdown({
    Name = "Select Egg",
    Options = EggsList,
    CurrentOption = {"Common Egg"},
    MultipleOptions = false,
    Flag = "DropdownEgg",
    Callback = function(Option)
        -- O Rayfield retorna uma tabela, então pegamos o primeiro item selecionado
        getgenv().SelectedEgg = Option[1]
    end
})

TabEggs:CreateSlider({
    Name = "Amount to Open",
    Range = {1, 100},
    Increment = 1,
    Suffix = " Eggs",
    CurrentValue = 100,
    Flag = "SliderEggAmount",
    Callback = function(Value)
        getgenv().EggAmount = Value
    end
})

TabEggs:CreateToggle({
    Name = "Auto Hatch",
    CurrentValue = false,
    Flag = "ToggleAutoHatch",
    Callback = function(Value)
        getgenv().AutoEgg = Value
        if Value then
            task.spawn(function()
                while getgenv().AutoEgg and LocalPlayer.Character do -- Garante que o personagem existe
                    pcall(function()
                        local eggFolder = Workspace:FindFirstChild("_") and Workspace._:FindFirstChild("Eggs")
                        if eggFolder and eggFolder:FindFirstChild(getgenv().SelectedEgg) then
                            local eggInstance = eggFolder[getgenv().SelectedEgg]
                            -- A lógica de chamada do BuyEgg foi confirmada pela Dex
                            Functions.BuyEgg:InvokeServer(eggInstance, getgenv().EggAmount)
                        end
                    end)
                    task.wait(0.05) -- Delay de 0.05s para evitar spam excessivo no server
                end
            end)
        end
    end
})

--================= SHOP & UPGRADES TAB =================--
TabShop:CreateToggle({
    Name = "Auto Buy Merchant (All Items)",
    CurrentValue = false,
    Flag = "ToggleMerchant",
    Callback = function(Value)
        getgenv().AutoMerchant = Value
        if Value then
            task.spawn(function()
                while getgenv().AutoMerchant do
                    pcall(function()
                        -- Compra todos os 15 slots baseados no MerchantData
                        for i = 1, 15 do
                            Functions.BuyMerchant:InvokeServer("Merchant", i)
                        end
                    end)
                    task.wait(2) -- Delay de 2s para não dar spam excessivo no server
                end
            end)
        end
    end
})

TabShop:CreateDropdown({
    Name = "Select Upgrade",
    Options = UpgradesList,
    CurrentOption = {"Coins1"},
    MultipleOptions = false,
    Flag = "DropdownUpgrade",
    Callback = function(Option)
        getgenv().SelectedUpgrade = Option[1]
    end
})

TabShop:CreateToggle({
    Name = "Auto Buy Upgrade",
    CurrentValue = false,
    Flag = "ToggleUpgrade",
    Callback = function(Value)
        getgenv().AutoUpgrade = Value
        if Value then
            task.spawn(function()
                while getgenv().AutoUpgrade do
                    pcall(function()
                        Functions.BuyUpgrade:InvokeServer(getgenv().SelectedUpgrade)
                    end)
                    task.wait(1) -- Delay de 1s entre as tentativas de compra
                end
            end)
        end
    end
})

--================= PLAYER TAB =================--
TabPlayer:CreateSlider({
    Name = "WalkSpeed",
    Range = {16, 200},
    Increment = 1,
    Suffix = " WS",
    CurrentValue = getgenv().WalkSpeed, -- Define o valor inicial do slider
    Flag = "SliderWS",
    Callback = function(Value)
        getgenv().WalkSpeed = Value
        UpdatePlayerStats() -- Chama a função para aplicar ao personagem
    end
})

TabPlayer:CreateSlider({
    Name = "JumpPower",
    Range = {50, 300},
    Increment = 1,
    Suffix = " JP",
    CurrentValue = getgenv().JumpPower, -- Define o valor inicial do slider
    Flag = "SliderJP",
    Callback = function(Value)
        getgenv().JumpPower = Value
        UpdatePlayerStats() -- Chama a função para aplicar ao personagem
    end
})

TabPlayer:CreateToggle({
    Name = "Anti-AFK (Jump a cada 5 minutos)",
    CurrentValue = false,
    Flag = "ToggleAntiAFK",
    Callback = function(Value)
        getgenv().AntiAFKMovement = Value
        if Value then
            task.spawn(function()
                while getgenv().AntiAFKMovement do
                    task.wait(300) -- Espera 5 minutos (300 segundos)
                    if getgenv().AntiAFKMovement and LocalPlayer.Character then -- Verifica novamente e se o personagem existe
                        local hum = LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                        if hum and hum.Health > 0 then
                            -- Simula um pequeno pulo para manter a atividade
                            hum.Jump = true
                            task.wait(0.1) -- Mantém o pulo por um breve momento
                            hum.Jump = false
                        end
                    end
                end
            end)
        end
    end
})

-- Aplica os stats iniciais ao carregar o script
UpdatePlayerStats()
